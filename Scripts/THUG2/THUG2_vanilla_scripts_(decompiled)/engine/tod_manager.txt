
:i $tod_manager_inactive$ = %i(0,00000000)
:i $tod_manager_num_prefixes$ = %i(10,0000000a)
:i $tod_manager_levels_using_new_system$ = :s{
	:i $load_bo$ = %i(1,00000001)
	:i $load_ba$ = %i(1,00000001)
	:i $load_be$ = %i(1,00000001)
	:i $load_au$ = %i(1,00000001)
	:i $load_no$ = %i(1,00000001)
:i :s}
:i $tod_manager_default_morning$ = :s{
	:i $state_length$ = %i(90000,00015f90)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(-10.000000)
	:i $sun_red$ = %f(255.000000)
	:i $sun_green$ = %f(210.000000)
	:i $sun_blue$ = %f(172.000000)
	:i $lev_red$ = %i(64,00000040)
	:i $lev_green$ = %i(77,0000004d)
	:i $lev_blue$ = %i(81,00000051)
	:i $sky_red$ = %i(128,00000080)
	:i $sky_green$ = %i(128,00000080)
	:i $sky_blue$ = %i(128,00000080)
	:i $fog_on$ = %i(1,00000001)
	:i $fog_red$ = %i(85,00000055)
	:i $fog_green$ = %i(100,00000064)
	:i $fog_blue$ = %i(105,00000069)
	:i $fog_alpha$ = %i(108,0000006c)
	:i $fog_dist$ = %i(2500,000009c4)
	:i $ambient_red$ = %i(41,00000029)
	:i $ambient_green$ = %i(42,0000002a)
	:i $ambient_blue$ = %i(45,0000002d)
	:i $ambient_mod_factor_lo$ = %f(0.180000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(188,000000bc)
	:i $pitch_0$ = %i(351,0000015f)
	:i $red_0$ = %i(16,00000010)
	:i $green_0$ = %i(19,00000013)
	:i $blue_0$ = %i(29,0000001d)
	:i $mod_factor_0_lo$ = %f(0.120000)
	:i $mod_factor_0_hi$ = %f(0.000000)
	:i $heading_1$ = %i(0,00000000)
	:i $pitch_1$ = %i(0,00000000)
	:i $red_1$ = %i(34,00000022)
	:i $green_1$ = %i(42,0000002a)
	:i $blue_1$ = %i(49,00000031)
	:i $mod_factor_1_lo$ = %f(0.100000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(0,00000000)
	:i $bloom_on$ = %i(1,00000001)
	:i $bloom_color$ = :a{%i(150,00000096)%i(100,00000064)%i(200,000000c8):a}
	:i $bloom1$ = %i(30,0000001e)
	:i $bloom2$ = %i(100,00000064)
	:i $bloom_strength$ = :a{%i(48,00000030)%i(64,00000040)%i(76,0000004c):a}
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_morning_sky$ = :s{
	:i $state_length$ = %i(110000,0001adb0)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(-10.000000)
	:i $sun_red$ = %f(255.000000)
	:i $sun_green$ = %f(255.000000)
	:i $sun_blue$ = %f(255.000000)
	:i $lev_red$ = %i(64,00000040)
	:i $lev_green$ = %i(77,0000004d)
	:i $lev_blue$ = %i(81,00000051)
	:i $sky_red$ = %i(128,00000080)
	:i $sky_green$ = %i(128,00000080)
	:i $sky_blue$ = %i(128,00000080)
	:i $fog_on$ = %i(1,00000001)
	:i $fog_red$ = %i(85,00000055)
	:i $fog_green$ = %i(100,00000064)
	:i $fog_blue$ = %i(105,00000069)
	:i $fog_alpha$ = %i(108,0000006c)
	:i $fog_dist$ = %i(2500,000009c4)
	:i $ambient_red$ = %i(41,00000029)
	:i $ambient_green$ = %i(42,0000002a)
	:i $ambient_blue$ = %i(45,0000002d)
	:i $ambient_mod_factor_lo$ = %f(0.180000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(188,000000bc)
	:i $pitch_0$ = %i(351,0000015f)
	:i $red_0$ = %i(16,00000010)
	:i $green_0$ = %i(19,00000013)
	:i $blue_0$ = %i(29,0000001d)
	:i $mod_factor_0_lo$ = %f(0.120000)
	:i $mod_factor_0_hi$ = %f(0.000000)
	:i $heading_1$ = %i(0,00000000)
	:i $pitch_1$ = %i(0,00000000)
	:i $red_1$ = %i(34,00000022)
	:i $green_1$ = %i(42,0000002a)
	:i $blue_1$ = %i(49,00000031)
	:i $mod_factor_1_lo$ = %f(0.100000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(0,00000000)
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_afternoon$ = :s{
	:i $state_length$ = %i(400000,00061a80)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(20.000000)
	:i $sun_red$ = %f(255.000000)
	:i $sun_green$ = %f(255.000000)
	:i $sun_blue$ = %f(255.000000)
	:i $lev_red$ = %i(128,00000080)
	:i $lev_green$ = %i(128,00000080)
	:i $lev_blue$ = %i(128,00000080)
	:i $sky_red$ = %i(128,00000080)
	:i $sky_green$ = %i(128,00000080)
	:i $sky_blue$ = %i(128,00000080)
	:i $fog_red$ = %i(128,00000080)
	:i $fog_green$ = %i(128,00000080)
	:i $fog_blue$ = %i(128,00000080)
	:i $fog_alpha$ = %i(0,00000000)
	:i $fog_dist$ = %i(200000,00030d40)
	:i $ambient_red$ = %i(50,00000032)
	:i $ambient_green$ = %i(50,00000032)
	:i $ambient_blue$ = %i(50,00000032)
	:i $ambient_mod_factor_lo$ = %f(0.300000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(60,0000003c)
	:i $pitch_0$ = %i(330,0000014a)
	:i $red_0$ = %i(136,00000088)
	:i $green_0$ = %i(120,00000078)
	:i $blue_0$ = %i(110,0000006e)
	:i $mod_factor_0_lo$ = %f(0.750000)
	:i $mod_factor_0_hi$ = %f(0.000000)
	:i $heading_1$ = %i(245,000000f5)
	:i $pitch_1$ = %i(330,0000014a)
	:i $red_1$ = %i(72,00000048)
	:i $green_1$ = %i(70,00000046)
	:i $blue_1$ = %i(66,00000042)
	:i $mod_factor_1_lo$ = %f(0.750000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(0,00000000)
	:i $bloom_on$ = %i(1,00000001)
	:i $bloom_color$ = :a{%i(120,00000078)%i(120,00000078)%i(120,00000078):a}
	:i $bloom1$ = %i(20,00000014)
	:i $bloom2$ = %i(80,00000050)
	:i $bloom_strength$ = :a{%i(35,00000023)%i(35,00000023)%i(35,00000023):a}
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_afternoon_sky$ = :s{
	:i $state_length$ = %i(400000,00061a80)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(20.000000)
	:i $sun_red$ = %f(255.000000)
	:i $sun_green$ = %f(255.000000)
	:i $sun_blue$ = %f(255.000000)
	:i $lev_red$ = %i(128,00000080)
	:i $lev_green$ = %i(128,00000080)
	:i $lev_blue$ = %i(128,00000080)
	:i $sky_red$ = %i(128,00000080)
	:i $sky_green$ = %i(128,00000080)
	:i $sky_blue$ = %i(128,00000080)
	:i $fog_red$ = %i(128,00000080)
	:i $fog_green$ = %i(128,00000080)
	:i $fog_blue$ = %i(128,00000080)
	:i $fog_alpha$ = %i(0,00000000)
	:i $fog_dist$ = %i(200000,00030d40)
	:i $ambient_red$ = %i(50,00000032)
	:i $ambient_green$ = %i(50,00000032)
	:i $ambient_blue$ = %i(50,00000032)
	:i $ambient_mod_factor_lo$ = %f(0.300000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(60,0000003c)
	:i $pitch_0$ = %i(330,0000014a)
	:i $red_0$ = %i(136,00000088)
	:i $green_0$ = %i(120,00000078)
	:i $blue_0$ = %i(110,0000006e)
	:i $mod_factor_0_lo$ = %f(0.750000)
	:i $mod_factor_0_hi$ = %f(0.000000)
	:i $heading_1$ = %i(245,000000f5)
	:i $pitch_1$ = %i(330,0000014a)
	:i $red_1$ = %i(72,00000048)
	:i $green_1$ = %i(70,00000046)
	:i $blue_1$ = %i(66,00000042)
	:i $mod_factor_1_lo$ = %f(0.750000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(0,00000000)
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_evening$ = :s{
	:i $state_length$ = %i(90000,00015f90)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(180.000000)
	:i $sun_red$ = %f(255.000000)
	:i $sun_green$ = %i(128,00000080)
	:i $sun_blue$ = %i(64,00000040)
	:i $lev_red$ = %i(100,00000064)
	:i $lev_green$ = %i(95,0000005f)
	:i $lev_blue$ = %i(74,0000004a)
	:i $sky_red$ = %i(76,0000004c)
	:i $sky_green$ = %i(66,00000042)
	:i $sky_blue$ = %i(50,00000032)
	:i $fog_red$ = %i(100,00000064)
	:i $fog_green$ = %i(86,00000056)
	:i $fog_blue$ = %i(29,0000001d)
	:i $fog_alpha$ = %i(30,0000001e)
	:i $fog_dist$ = %i(5000,00001388)
	:i $ambient_red$ = %i(39,00000027)
	:i $ambient_green$ = %i(38,00000026)
	:i $ambient_blue$ = %i(32,00000020)
	:i $ambient_mod_factor_lo$ = %f(0.300000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(50,00000032)
	:i $pitch_0$ = %i(330,0000014a)
	:i $red_0$ = %i(104,00000068)
	:i $green_0$ = %i(101,00000065)
	:i $blue_0$ = %i(60,0000003c)
	:i $mod_factor_0_lo$ = %f(0.750000)
	:i $mod_factor_0_hi$ = %f(0.000000)
	:i $heading_1$ = %i(240,000000f0)
	:i $pitch_1$ = %i(330,0000014a)
	:i $red_1$ = %i(45,0000002d)
	:i $green_1$ = %i(42,0000002a)
	:i $blue_1$ = %i(38,00000026)
	:i $mod_factor_1_lo$ = %f(0.400000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(0,00000000)
	:i $bloom_on$ = %i(1,00000001)
	:i $bloom_color$ = :a{%i(120,00000078)%i(120,00000078)%i(120,00000078):a}
	:i $bloom1$ = %i(20,00000014)
	:i $bloom2$ = %i(80,00000050)
	:i $bloom_strength$ = :a{%i(35,00000023)%i(35,00000023)%i(35,00000023):a}
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_evening_sky$ = :s{
	:i $state_length$ = %i(110000,0001adb0)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(180.000000)
	:i $sun_red$ = %f(0.000000)
	:i $sun_green$ = %f(0.000000)
	:i $sun_blue$ = %f(0.000000)
	:i $lev_red$ = %i(100,00000064)
	:i $lev_green$ = %i(95,0000005f)
	:i $lev_blue$ = %i(74,0000004a)
	:i $sky_red$ = %i(76,0000004c)
	:i $sky_green$ = %i(66,00000042)
	:i $sky_blue$ = %i(50,00000032)
	:i $fog_red$ = %i(100,00000064)
	:i $fog_green$ = %i(86,00000056)
	:i $fog_blue$ = %i(29,0000001d)
	:i $fog_alpha$ = %i(30,0000001e)
	:i $fog_dist$ = %i(5000,00001388)
	:i $ambient_red$ = %i(39,00000027)
	:i $ambient_green$ = %i(38,00000026)
	:i $ambient_blue$ = %i(32,00000020)
	:i $ambient_mod_factor_lo$ = %f(0.300000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(50,00000032)
	:i $pitch_0$ = %i(330,0000014a)
	:i $red_0$ = %i(104,00000068)
	:i $green_0$ = %i(101,00000065)
	:i $blue_0$ = %i(60,0000003c)
	:i $mod_factor_0_lo$ = %f(0.750000)
	:i $mod_factor_0_hi$ = %f(0.000000)
	:i $heading_1$ = %i(240,000000f0)
	:i $pitch_1$ = %i(330,0000014a)
	:i $red_1$ = %i(45,0000002d)
	:i $green_1$ = %i(42,0000002a)
	:i $blue_1$ = %i(38,00000026)
	:i $mod_factor_1_lo$ = %f(0.400000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(0,00000000)
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_night$ = :s{
	:i $state_length$ = %i(140000,000222e0)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(200.000000)
	:i $sun_red$ = %f(0.000000)
	:i $sun_green$ = %f(0.000000)
	:i $sun_blue$ = %f(0.000000)
	:i $lev_red$ = %i(50,00000032)
	:i $lev_green$ = %i(65,00000041)
	:i $lev_blue$ = %i(75,0000004b)
	:i $sky_red$ = %i(18,00000012)
	:i $sky_green$ = %i(22,00000016)
	:i $sky_blue$ = %i(24,00000018)
	:i $fog_red$ = %i(5,00000005)
	:i $fog_green$ = %i(16,00000010)
	:i $fog_blue$ = %i(22,00000016)
	:i $fog_alpha$ = %i(63,0000003f)
	:i $fog_dist$ = %i(8000,00001f40)
	:i $ambient_red$ = %i(26,0000001a)
	:i $ambient_green$ = %i(36,00000024)
	:i $ambient_blue$ = %i(40,00000028)
	:i $ambient_mod_factor_lo$ = %f(0.300000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(330,0000014a)
	:i $pitch_0$ = %i(330,0000014a)
	:i $red_0$ = %i(70,00000046)
	:i $green_0$ = %i(100,00000064)
	:i $blue_0$ = %i(106,0000006a)
	:i $mod_factor_0_lo$ = %f(0.800000)
	:i $mod_factor_0_hi$ = %f(0.800000)
	:i $heading_1$ = %i(151,00000097)
	:i $pitch_1$ = %i(330,0000014a)
	:i $red_1$ = %i(15,0000000f)
	:i $green_1$ = %i(30,0000001e)
	:i $blue_1$ = %i(30,0000001e)
	:i $mod_factor_1_lo$ = %f(0.100000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(1,00000001)
	:i $bloom_on$ = %i(1,00000001)
	:i $bloom_color$ = :a{%i(150,00000096)%i(100,00000064)%i(200,000000c8):a}
	:i $bloom1$ = %i(30,0000001e)
	:i $bloom2$ = %i(100,00000064)
	:i $bloom_strength$ = :a{%i(48,00000030)%i(64,00000040)%i(76,0000004c):a}
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_manager_default_night_sky$ = :s{
	:i $state_length$ = %i(100000,000186a0)
	:i $sun_theta$ = %f(0.000000)
	:i $sun_phi$ = %f(200.000000)
	:i $sun_red$ = %f(255.000000)
	:i $sun_green$ = %f(255.000000)
	:i $sun_blue$ = %f(255.000000)
	:i $lev_red$ = %i(50,00000032)
	:i $lev_green$ = %i(65,00000041)
	:i $lev_blue$ = %i(75,0000004b)
	:i $sky_red$ = %i(18,00000012)
	:i $sky_green$ = %i(22,00000016)
	:i $sky_blue$ = %i(24,00000018)
	:i $fog_red$ = %i(5,00000005)
	:i $fog_green$ = %i(16,00000010)
	:i $fog_blue$ = %i(22,00000016)
	:i $fog_alpha$ = %i(63,0000003f)
	:i $fog_dist$ = %i(8000,00001f40)
	:i $ambient_red$ = %i(26,0000001a)
	:i $ambient_green$ = %i(36,00000024)
	:i $ambient_blue$ = %i(40,00000028)
	:i $ambient_mod_factor_lo$ = %f(0.300000)
	:i $ambient_mod_factor_hi$ = %f(0.000000)
	:i $heading_0$ = %i(330,0000014a)
	:i $pitch_0$ = %i(330,0000014a)
	:i $red_0$ = %i(70,00000046)
	:i $green_0$ = %i(100,00000064)
	:i $blue_0$ = %i(106,0000006a)
	:i $mod_factor_0_lo$ = %f(0.800000)
	:i $mod_factor_0_hi$ = %f(0.800000)
	:i $heading_1$ = %i(151,00000097)
	:i $pitch_1$ = %i(330,0000014a)
	:i $red_1$ = %i(15,0000000f)
	:i $green_1$ = %i(30,0000001e)
	:i $blue_1$ = %i(30,0000001e)
	:i $mod_factor_1_lo$ = %f(0.100000)
	:i $mod_factor_1_hi$ = %f(0.000000)
	:i $headlights_on$ = %i(1,00000001)
	:i $entry_script$ = $nullscript$
:i :s}
:i $tod_morning_light_prefixes$ = :a{
	:i %s(22,"TRG_Morning_LevelLight")
	:i :a}
:i $tod_afternoon_light_prefixes$ = :a{
	:i %s(24,"TRG_Afternoon_LevelLight")
	:i :a}
:i $tod_evening_light_prefixes$ = :a{
	:i %s(22,"TRG_Evening_LevelLight")
	:i :a}
:i $tod_night_light_prefixes$ = :a{
	:i %s(20,"TRG_Night_LevelLight")
	:i :a}
:i function $tod_manager_set_default_params$
	:i $TODManager_SetParams$:s{
		:i $system$ = %i(1,00000001)
		:i $current_state$ = $afternoon$
		:i $transition_length$ = %i(90000,00015f90)
		:i $groups$ = :a{
			:i :s{$parts$ = %i(6,00000006)$wait_frames$ = %i(3,00000003)$light_group$ = $outdoor$:s}
			:i :s{$parts$ = %i(2,00000002)$wait_frames$ = %i(3,00000003)$light_group$ = $nolevellights$$reset_light_group$ = $indoor$:s}
			:i :a}
		:i $morning$ = $tod_manager_default_morning$
		:i $afternoon$ = $tod_manager_default_afternoon$
		:i $evening$ = $tod_manager_default_evening$
		:i $night$ = $tod_manager_default_night$
	:i :s}
	:i $TODManager_SetParams$:s{
		:i $sky$
		:i $system$ = %i(2,00000002)
		:i $current_state$ = $afternoon$
		:i $transition_length$ = %i(90000,00015f90)
		:i $groups$ = :a{
			:i :s{$parts$ = %i(6,00000006)$wait_frames$ = %i(3,00000003)$light_group$ = $outdoor$:s}
			:i :s{$parts$ = %i(2,00000002)$wait_frames$ = %i(3,00000003)$light_group$ = $nolevellights$$reset_light_group$ = $indoor$:s}
			:i :a}
		:i $morning$ = $tod_manager_default_morning_sky$
		:i $afternoon$ = $tod_manager_default_afternoon_sky$
		:i $evening$ = $tod_manager_default_evening_sky$
		:i $night$ = $tod_manager_default_night_sky$
	:i :s}
:i endfunction
:i function $tod_manager_state_transition$
	:i $GetCurrentLevel$
	:i $tod_manager_update_car_textures$ isNull 
	:i if $StructureContains$$structure$ = $tod_manager_levels_using_new_system$%GLOBAL%$level$
		:i $KillSpawnedScript$$name$ = $tod_manager_instant_fakelights_and_geo$
		:i $KillSpawnedScript$$name$ = $tod_manager_update_fakelights_and_geo$
	:i else 
		:i $KillSpawnedScript$$name$ = $tod_manager_update_fakelights$
		:i $KillSpawnedScript$$name$ = $tod_manager_update_geo$
	:i endif
	:i $KillSpawnedScript$$name$ = $tod_manager_update_car_textures$
	:i if $StructureContains$$structure$ = $tod_manager_levels_using_new_system$%GLOBAL%$level$
		:i if $GotParam$$instant_change$
			:i $tod_manager_instant_fakelights_and_geo$ isNull 
		:i else 
			:i $tod_manager_update_fakelights_and_geo$ isNull 
		:i endif
	:i else 
		:i $tod_manager_update_fakelights$ isNull 
		:i $tod_manager_update_geo$ isNull 
	:i endif
	:i if $GotParam$$level_specific_transition_script$
		:i %GLOBAL%$level_specific_transition_script$ isNull 
	:i endif
	:i if $GotParam$$set_inactive$
		:i $TODManager_SetActive$%i(0,00000000)
	:i endif
:i endfunction
:i function $tod_manager_update_fakelights_and_geo$$wait_time$ = %i(60,0000003c)
	:i $tod_manager_get_tod_strings$$current_tod$ = %GLOBAL%$current_tod$
	:i %GLOBAL%$tod_struct$ =  (%GLOBAL%$tod_state_params$->%GLOBAL%$next_tod$) 
	:i %GLOBAL%$headlights_on$ =  (%GLOBAL%$tod_struct$->$headlights_on$) 
	:i if  (%GLOBAL%$headlights_on$ = %i(1,00000001)) 
		:i $CarTOD_TurnOnHeadlights$
	:i else 
		:i $CarTOD_TurnOffHeadlights$
	:i endif
	:i %GLOBAL%$index$ = %i(1,00000001)
	:i while
		
		:i if  (%GLOBAL%$index$ < %i(10,0000000a)) 
			:i $FormatText$$TextName$ = $current_light_prefix$%s(21,"TRG_%s_LevelLight_0%i")$s$ = %GLOBAL%$current_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $current_geo_on_prefix$%s(8,"%sOn_0%i")$s$ = %GLOBAL%$current_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $current_geo_off_prefix$%s(9,"%sOff_0%i")$s$ = %GLOBAL%$current_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $next_light_prefix$%s(21,"TRG_%s_LevelLight_0%i")$s$ = %GLOBAL%$next_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $next_geo_on_prefix$%s(8,"%sOn_0%i")$s$ = %GLOBAL%$next_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $next_geo_off_prefix$%s(9,"%sOff_0%i")$s$ = %GLOBAL%$next_tod_string$$i$ = %GLOBAL%$index$
		:i else 
			:i $FormatText$$TextName$ = $current_light_prefix$%s(20,"TRG_%s_LevelLight_%i")$s$ = %GLOBAL%$current_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $current_geo_on_prefix$%s(7,"%sOn_%i")$s$ = %GLOBAL%$current_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $current_geo_off_prefix$%s(8,"%sOff_%i")$s$ = %GLOBAL%$current_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $next_light_prefix$%s(20,"TRG_%s_LevelLight_%i")$s$ = %GLOBAL%$next_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $next_geo_on_prefix$%s(7,"%sOn_%i")$s$ = %GLOBAL%$next_tod_string$$i$ = %GLOBAL%$index$
			:i $FormatText$$TextName$ = $next_geo_off_prefix$%s(8,"%sOff_%i")$s$ = %GLOBAL%$next_tod_string$$i$ = %GLOBAL%$index$
		:i endif
		:i $FakeLights$$percent$ = %i(0,00000000)$time$ = %GLOBAL%$wait_time$$prefix$ = %GLOBAL%$current_light_prefix$$NoPrefixWarning$
		:i $wait$ (%GLOBAL%$wait_time$ + %i(1,00000001)) $gameframe$
		:i $kill$$prefix$ = %GLOBAL%$current_geo_on_prefix$$NoPrefixWarning$
		:i $TODManager_Create$$prefix$ = %GLOBAL%$current_geo_off_prefix$$NoPrefixWarning$
		:i $FakeLights$$percent$ = %i(100,00000064)$time$ = %GLOBAL%$wait_time$$prefix$ = %GLOBAL%$next_light_prefix$$NoPrefixWarning$
		:i $wait$ (%GLOBAL%$wait_time$ + %i(1,00000001)) $gameframe$
		:i $TODManager_Create$$prefix$ = %GLOBAL%$next_geo_on_prefix$$NoPrefixWarning$
		:i $kill$$prefix$ = %GLOBAL%$next_geo_off_prefix$$NoPrefixWarning$
		:i %GLOBAL%$index$ =  (%GLOBAL%$index$ + %i(1,00000001)) 
	:i loop_to $tod_manager_num_prefixes$
	:i $UpdateFxLighting$
	:i if  (%GLOBAL%$next_tod$ = $night$) 
		:i $printf$%s(63," ++++++++++++++++++ setting NIGHT sound boxes +++++++++++++++++")
		:i $kill$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")$NoPrefixWarning$
		:i $kill$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")$NoPrefixWarning$
		:i $TODManager_Create$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")$NoPrefixWarning$
	:i else 
		:i $printf$%s(81," ++++++++++++++++++++++ setting day/morning/evening sound boxes +++++++++++++++++")
		:i $kill$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")$NoPrefixWarning$
		:i $kill$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")$NoPrefixWarning$
		:i $TODManager_Create$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")$NoPrefixWarning$
	:i endif
:i endfunction
:i function $tod_manager_get_tod_strings$
	:i switch %GLOBAL%$current_tod$
		:i case $morning$
			:i return
			$current_tod_string$ = %s(7,"morning")$next_tod_string$ = %s(9,"afternoon")
			:i endcase
		case $afternoon$
			:i return
			$current_tod_string$ = %s(9,"afternoon")$next_tod_string$ = %s(7,"evening")
			:i endcase
		case $evening$
			:i return
			$current_tod_string$ = %s(7,"evening")$next_tod_string$ = %s(5,"night")
			:i endcase
		case $night$
			:i return
			$current_tod_string$ = %s(5,"night")$next_tod_string$ = %s(7,"morning")
			:i endcase
		default 
			:i $script_assert$%s(22,"Unrecognized tod state")
			:i end_switch
	
:i endfunction
:i function $tod_manager_instant_fakelights_and_geo$
	:i $tod_manager_get_tod_strings$$current_tod$ = %GLOBAL%$current_tod$
	:i $FormatText$$TextName$ = $next_light_prefix$%s(17,"TRG_%s_LevelLight")$s$ = %GLOBAL%$next_tod_string$
	:i $FormatText$$TextName$ = $next_geo_on_prefix$%s(4,"%sOn")$s$ = %GLOBAL%$next_tod_string$
	:i $FormatText$$TextName$ = $next_geo_off_prefix$%s(5,"%sOff")$s$ = %GLOBAL%$next_tod_string$
	:i $tod_state_names$ = :a{
		:i %s(7,"morning")
		:i %s(9,"afternoon")
		:i %s(7,"evening")
		:i %s(5,"night")
		:i :a}
	:i $GetArraySize$%GLOBAL%$tod_state_names$
	:i %GLOBAL%$index$ = %i(0,00000000)
	:i while
		
		:i if  ( (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a})  = %GLOBAL%$next_tod_string$) 
			:i $FormatText$$TextName$ = $light_prefix$%s(17,"TRG_%s_LevelLight")$s$ =  (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a}) 
			:i $FormatText$$TextName$ = $geo_on_prefix$%s(4,"%sOn")$s$ =  (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a}) 
			:i $FakeLights$$percent$ = %i(0,00000000)$time$ = %i(0,00000000)$prefix$ = %GLOBAL%$light_prefix$$NoPrefixWarning$
			:i $wait$%i(1,00000001)$gameframe$
			:i $kill$$prefix$ = %GLOBAL%$geo_on_prefix$$NoPrefixWarning$
		:i endif
		:i %GLOBAL%$index$ =  (%GLOBAL%$index$ + %i(1,00000001)) 
	:i loop_to %GLOBAL%$array_size$
	:i if $GotParam$$temp_state$
		:i $next_tod_string$ = %s(10,"temp_state")
	:i else 
		:i $FakeLights$$percent$ = %i(100,00000064)$time$ = %i(0,00000000)$prefix$ = %GLOBAL%$next_light_prefix$$NoPrefixWarning$
		:i $wait$%i(1,00000001)$gameframe$
		:i $TODManager_Create$$prefix$ = %GLOBAL%$next_geo_on_prefix$$NoPrefixWarning$
		:i $kill$$prefix$ = %GLOBAL%$next_geo_off_prefix$$NoPrefixWarning$
	:i endif
	:i %GLOBAL%$index$ = %i(0,00000000)
	:i while
		
		:i if NOT  ( (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a})  = %GLOBAL%$next_tod_string$) 
			:i $FormatText$$TextName$ = $light_prefix$%s(17,"TRG_%s_LevelLight")$s$ =  (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a}) 
			:i $FormatText$$TextName$ = $geo_on_prefix$%s(4,"%sOn")$s$ =  (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a}) 
			:i $FormatText$$TextName$ = $geo_off_prefix$%s(5,"%sOff")$s$ =  (%GLOBAL%$tod_state_names$:a{%GLOBAL%$index$:a}) 
			:i $FakeLights$$percent$ = %i(0,00000000)$time$ = %i(0,00000000)$prefix$ = %GLOBAL%$light_prefix$$NoPrefixWarning$
			:i $wait$%i(1,00000001)$gameframe$
			:i $kill$$prefix$ = %GLOBAL%$geo_on_prefix$$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %GLOBAL%$geo_off_prefix$$NoPrefixWarning$
		:i endif
		:i %GLOBAL%$index$ =  (%GLOBAL%$index$ + %i(1,00000001)) 
	:i loop_to %GLOBAL%$array_size$
	:i $UpdateFxLighting$
	:i if  (%GLOBAL%$next_tod$ = $night$) 
		:i $kill$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")$NoPrefixWarning$
		:i $kill$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")$NoPrefixWarning$
		:i $TODManager_Create$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")$NoPrefixWarning$
	:i else 
		:i $kill$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")$NoPrefixWarning$
		:i $kill$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")$NoPrefixWarning$
		:i $TODManager_Create$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")$NoPrefixWarning$
	:i endif
	:i %GLOBAL%$tod_struct$ =  (%GLOBAL%$tod_state_params$->%GLOBAL%$next_tod$) 
	:i %GLOBAL%$headlights_on$ =  (%GLOBAL%$tod_struct$->$headlights_on$) 
	:i if  (%GLOBAL%$headlights_on$ = %i(1,00000001)) 
		:i $CarTOD_TurnOnHeadlights$
	:i else 
		:i $CarTOD_TurnOffHeadlights$
	:i endif
:i endfunction
:i function $tod_manager_update_fakelights$$wait_time$ = %i(120,00000078)
	:i switch %GLOBAL%$current_tod$
		:i case $morning$
			:i $current_prefixes$ = $tod_afternoon_light_prefixes$
			:i $old_prefixes$ = $tod_morning_light_prefixes$
			:i endcase
		case $afternoon$
			:i $current_prefixes$ = $tod_evening_light_prefixes$
			:i $old_prefixes$ = $tod_afternoon_light_prefixes$
			:i endcase
		case $evening$
			:i $current_prefixes$ = $tod_night_light_prefixes$
			:i $old_prefixes$ = $tod_evening_light_prefixes$
			:i endcase
		case $night$
			:i $current_prefixes$ = $tod_morning_light_prefixes$
			:i $old_prefixes$ = $tod_night_light_prefixes$
			:i endcase
		default 
			:i $script_assert$%s(22,"Unrecognized tod state")
			:i end_switch
	
	:i $GetArraySize$%GLOBAL%$old_prefixes$
	:i %GLOBAL%$index$ = %i(0,00000000)
	:i while
		
		:i $FakeLights$$percent$ = %i(0,00000000)$time$ = %GLOBAL%$wait_time$$prefix$ =  (%GLOBAL%$old_prefixes$:a{%GLOBAL%$index$:a}) $NoPrefixWarning$
		:i $wait$ (%GLOBAL%$wait_time$ + %i(1,00000001)) $gameframe$
		:i %GLOBAL%$index$ =  (%GLOBAL%$index$ + %i(1,00000001)) 
	:i loop_to %GLOBAL%$array_size$
	:i $GetArraySize$%GLOBAL%$current_prefixes$
	:i %GLOBAL%$index$ = %i(0,00000000)
	:i while
		
		:i $FakeLights$$percent$ = %i(100,00000064)$time$ = %GLOBAL%$wait_time$$prefix$ =  (%GLOBAL%$current_prefixes$:a{%GLOBAL%$index$:a}) $NoPrefixWarning$
		:i $wait$ (%GLOBAL%$wait_time$ + %i(1,00000001)) $gameframe$
		:i %GLOBAL%$index$ =  (%GLOBAL%$index$ + %i(1,00000001)) 
	:i loop_to %GLOBAL%$array_size$
	:i %GLOBAL%$tod_struct$ =  (%GLOBAL%$tod_state_params$->%GLOBAL%$next_tod$) 
	:i %GLOBAL%$headlights_on$ =  (%GLOBAL%$tod_struct$->$headlights_on$) 
	:i if  (%GLOBAL%$headlights_on$ = %i(1,00000001)) 
		:i $CarTOD_TurnOnHeadlights$
	:i else 
		:i $CarTOD_TurnOffHeadlights$
	:i endif
	:i $UpdateFxLighting$
:i endfunction
:i function $tod_manager_update_car_textures$
	:i switch %GLOBAL%$next_tod$
		:i case $morning$
			:i $ReplaceCarTextures$:s{
				:i $array$ = :a{
					:i :s{
						:i $src$ = %s(31,"JKU_LightCircle_Transparent.png")$dest$ = %s(41,"textures/cars/JKU_LightCircle_Transparent")
					:i :s}
					:i :s{
						:i $src$ = %s(33,"JKU_HeadlightGlow_Transparent.png")$dest$ = %s(31,"textures/cars/JKU_HeadlightGlow")
					:i :s}
					:i :a}
			:i :s}
			:i endcase
		case $afternoon$
			:i $ReplaceCarTextures$:s{
				:i $array$ = :a{
					:i :s{
						:i $src$ = %s(31,"JKU_LightCircle_Transparent.png")$dest$ = %s(41,"textures/cars/JKU_LightCircle_Transparent")
					:i :s}
					:i :s{
						:i $src$ = %s(33,"JKU_HeadlightGlow_Transparent.png")$dest$ = %s(43,"textures/cars/JKU_HeadlightGlow_Transparent")
					:i :s}
					:i :a}
			:i :s}
			:i endcase
		case $evening$
			:i $ReplaceCarTextures$:s{
				:i $array$ = :a{
					:i :s{
						:i $src$ = %s(31,"JKU_LightCircle_Transparent.png")$dest$ = %s(41,"textures/cars/JKU_LightCircle_Transparent")
					:i :s}
					:i :s{
						:i $src$ = %s(33,"JKU_HeadlightGlow_Transparent.png")$dest$ = %s(31,"textures/cars/JKU_HeadlightGlow")
					:i :s}
					:i :a}
			:i :s}
			:i endcase
		case $night$
			:i $ReplaceCarTextures$:s{
				:i $array$ = :a{
					:i :s{
						:i $src$ = %s(31,"JKU_LightCircle_Transparent.png")$dest$ = %s(29,"textures/cars/JKU_LightCircle")
					:i :s}
					:i :s{
						:i $src$ = %s(33,"JKU_HeadlightGlow_Transparent.png")$dest$ = %s(31,"textures/cars/JKU_HeadlightGlow")
					:i :s}
					:i :a}
			:i :s}
			:i endcase
		default 
			:i $printf$%s(18,"### no tod set ###")
			:i end_switch
	
:i endfunction
:i function $tod_manager_update_geo$
	:i switch %GLOBAL%$next_tod$
		:i case $morning$
			:i $TODManager_Create$$prefix$ = %s(9,"MorningOn")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(12,"AfternoonOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(10,"EveningOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(8,"NightOff")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(10,"MorningOff")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(11,"AfternoonOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"EveningOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(7,"NightOn")$NoPrefixWarning$
			:i endcase
		case $afternoon$
			:i $TODManager_Create$$prefix$ = %s(10,"MorningOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(10,"EveningOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(8,"NightOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(11,"AfternoonOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(12,"AfternoonOff")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"MorningOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"EveningOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(7,"NightOn")$NoPrefixWarning$
			:i endcase
		case $evening$
			:i $TODManager_Create$$prefix$ = %s(10,"MorningOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(12,"AfternoonOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(8,"NightOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(9,"EveningOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(10,"EveningOff")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(11,"AfternoonOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"MorningOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(7,"NightOn")$NoPrefixWarning$
			:i endcase
		case $night$
			:i $TODManager_Create$$prefix$ = %s(10,"MorningOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(10,"DefaultOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(10,"EveningOff")$NoPrefixWarning$
			:i $TODManager_Create$$prefix$ = %s(7,"NightOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(8,"NightOff")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"DefaultOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"MorningOn")$NoPrefixWarning$
			:i $kill$$prefix$ = %s(9,"EveningOn")$NoPrefixWarning$
			:i endcase
		default 
			:i $printf$%s(18,"### no tod set ###")
			:i end_switch
	
	:i if  (%GLOBAL%$next_tod$ = $night$) 
		:i $printf$%s(63," ++++++++++++++++++ setting NIGHT sound boxes +++++++++++++++++")
		:i $kill$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")
		:i $kill$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")
		:i $TODManager_Create$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")
	:i else 
		:i $printf$%s(81," ++++++++++++++++++++++ setting day/morning/evening sound boxes +++++++++++++++++")
		:i $kill$$prefix$ = %s(21,"TRG_SFX_TrigBox_Night")
		:i $TODManager_Create$$prefix$ = %s(19,"TRG_SFX_TrigBox_Day")
	:i endif
:i endfunction
:i :end
