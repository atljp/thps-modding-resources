generic_pro_name = 'peds/PedPros/PedPro_Neversoft/PedPro_Neversoft.skin'
generic_pro_first_name = 'Neversoft'
generic_pro_full_name = 'Neversoft Skater'
goal_want_to_save_volume = 0
goal_bind_retry_to_select = 0
max_number_of_special_trickslots = 11
goal_utility_last_goal_activated = null
goal_utilities_temp_goal_cam = {
    LockTo = skater
    Pos = (-29.799999237060547, 93.80000305175781, -152.89999389648438)
    Quat = (-0.09068500250577927, -0.09591200202703476, 0.010188000276684761)
    FOV = 72.0
    frames = 200
    skippable = 1
}
cash_goals_ped_floater = {
    icon = HUD_comp_cash
    icon_rgba = [ 10 113 17 38 ]
    text = [
        str_g_u_01
        str_g_u_02
        str_g_u_03
        str_g_u_04
        str_g_u_05
        str_g_u_06
        str_g_u_07
        str_g_u_08
        str_g_u_09
        str_g_u_10
        str_g_u_11
    ]
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 58 98 58 48 ]
}
story_goals_ped_floater = {
    icon = hud_comp_goal
    icon_rgba = [ 128 28 88 38 ]
    text = [
        str_g_u_13
        str_g_u_14
        str_g_u_15
        str_g_u_16
        str_g_u_17
        str_g_u_18
        str_g_u_19
        str_g_u_20
        str_g_u_21
        str_g_u_22
        str_g_u_23
        str_g_u_24
        str_g_u_25
        str_g_u_26
    ]
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 98 58 78 48 ]
}
bonus_goals_ped_floater = {
    icon = hud_comp_goal
    icon_rgba = [ 88 28 128 128 ]
    text = [ str_g_u_27 ]
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 78 58 98 48 ]
}
graffiti_goals_ped_floater = {
    icon = HUD_comp_graf
    icon_rgba = [ 121 82 9 38 ]
    text = [
        str_g_u_28
        str_g_u_29
        str_g_u_30
        str_g_u_31
        str_g_u_32
        str_g_u_33
    ]
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 94 74 24 44 ]
}
bike_goals_ped_floater = {
    icon = HUD_comp_bike
    icon_rgba = [ 60 60 110 70 ]
    text = [
        str_g_u_34
        str_g_u_35
        str_g_u_36
        str_g_u_37
        str_g_u_38
        str_g_u_39
    ]
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 40 40 70 48 ]
}
in_game_cat_floater = {
    icon = HUD_comp_bulb
    icon_rgba = [ 123 119 4 38 ]
    text = str_g_u_40
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 78 78 12 48 ]
}
in_game_skateshop_floater = {
    icon = HUD_comp_skateshop
    icon_rgba = [ 90 90 90 90 ]
    text = str_g_u_41
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 60 60 60 90 ]
}
in_game_clothingshop_floater = {
    icon = HUD_comp_cas
    icon_rgba = [ 90 90 90 90 ]
    text = str_g_u_42
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 60 60 60 90 ]
}
in_game_barbershop_floater = {
    icon = HUD_comp_cas
    icon_rgba = [ 30 40 113 90 ]
    text = str_g_u_43
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 20 30 80 80 ]
}
in_game_accshop_floater = {
    icon = HUD_comp_cas
    icon_rgba = [ 80 40 9 90 ]
    text = str_g_u_44
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 54 12 3 90 ]
}
in_game_tattooshop_floater = {
    icon = HUD_comp_cas
    icon_rgba = [ 55 10 70 90 ]
    text = str_g_u_45
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 40 7 50 90 ]
}
in_game_bus_floater = {
    icon = HUD_comp_bus
    icon_rgba = [ 90 90 90 90 ]
    text = str_g_u_46
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 60 60 60 90 ]
}
in_game_bike_floater = {
    icon = HUD_comp_bike
    icon_rgba = [ 60 60 80 70 ]
    text = str_g_u_47
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 68 68 68 48 ]
}
kickin_it_floater = {
    icon = hud_comp_kickin
    icon_rgba = [ 60 60 110 38 ]
    text = [
        str_g_u_48
        str_g_u_49
        str_g_u_50
        str_g_u_51
        str_g_u_52
    ]
    text_rgba = [ 0 0 0 128 ]
    text_font = small
    text_scale = (0.800000011920929, 0.800000011920929)
    bubble_rgba = [ 45 45 80 48 ]
}

script goal_init 
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam trigger_obj_id
        GoalManager_InitGoalTrigger name = <goal_id>
        if NOT GotParam not_in_nodearray
            if GotParam ped_floater
                goal_create_ped_floater parent_id = <trigger_obj_id> goal_id = <goal_id> <ped_floater>
            endif
        endif
    endif
    if GotParam init_geo_prefix
        Create prefix = <init_geo_prefix>
    else
        if GotParam init_geo_prefixes
            GetArraySize init_geo_prefixes
            <index> = 0
            begin 
            Create prefix = (<init_geo_prefixes> [ <index> ])
            <index> = (<index> + 1)
            repeat <array_size>
        endif
    endif
    if GotParam init_script
        <init_script> <init_script_params>
    endif
    if GotParam goal_init_script
        <goal_init_script> <goal_init_params>
    endif
endscript
cur_tod_cur_action = set_tod_day

script goal_passive_start 
    GoalManager_GetGoalParams name = <goal_id>
    change goal_utility_last_goal_activated = <goal_id>
    if ((GotParam bike_training_goal)|| (GotParam bike_goal))
        skater ::ClearTrickQueue
    endif
    if NOT GameModeEquals is_classic
        if NOT GotParam dont_reset_special
            skater ::SetSpecialValue value = 0
        endif
    endif
    if GotParam flatland_mode
        GoalManager_enable_flatland_mode goal_id = <goal_id>
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            <trigger_exists> = 1
        endif
    endif
    GetCurrentLevel
    if ChecksumEquals a = <level> b = load_sk5ed
        GoalManager_EditGoal name = <goal_id> params = { testing_goal }
    endif
    if NOT GameModeEquals is_classic
        if GotParam reset_score
            ResetScore
        endif
        if ((GotParam start_cam_anim)|| (GotParam start_cam_anims))
            skater ::vibrate Off
            KillTextureSplats all
            PreAllocSplats
        endif
        destroy_goal_panel_messages
    endif
    KillSpawnedScript name = goal_wait_and_show_key_combo_text
    KillSpawnedScript name = SK3_Killskater_Finish use_proper_version
    if (<trigger_exists> = 1)
        if NOT IsCreated <trigger_obj_id>
            GoalManager_EditGoal name = <goal_id> params = { force_create_trigger = 1 }
            GoalManager_InitializeGoal name = <goal_id>
            GoalManager_EditGoal name = <goal_id> params = { force_create_trigger = 0 }
            GoalManager_GetGoalParams name = <goal_id>
        endif
    endif
    if InNetGame
        GoalManager_AnnounceGoalStarted name = <goal_id>
    endif
    if (<trigger_exists> = 1)
        <trigger_obj_id> ::Obj_ClearExceptions
        TerminateObjectsScripts id = <trigger_obj_id> script_name = goal_pro_wait_and_reset_avoid_exception
        TerminateObjectsScripts id = <trigger_obj_id> script_name = goal_set_trigger_exceptions
    endif
    if GotParam custom_score_record
        GoalManager_EditGoal name = <goal_id> params = { custom_score_record = 0 }
    endif
    if ScreenElementExists id = goal_start_dialog
        speech_box_exit anchor_id = goal_start_dialog
    endif
    if ScreenElementExists id = goal_retry_anchor
        DestroyScreenElement id = goal_retry_anchor
    endif
    FormatText checksumname = arrow_id '%s_ped_arrow' s = <goal_name>
    if ScreenElementExists id = <arrow_id>
        DestroyScreenElement id = <arrow_id>
    endif
    KillSpawnedScript name = goal_init_after_end_of_run
    if NOT IsObserving
        GetSkaterId
        KillSkaterCamAnim skaterid = <ObjID> all
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam geo_prefix
        goal_create_geo_prefix geo_prefix = <geo_prefix>
    else
        if GotParam geo_prefixes
            GetArraySize geo_prefixes
            <index> = 0
            begin 
            goal_create_geo_prefix geo_prefix = (<geo_prefixes> [ <index> ])
            <index> = (<index> + 1)
            repeat <array_size>
        endif
    endif
    if NOT GameModeEquals is_classic
        if NOT IsObserving
            skater ::runstarted
        endif
        if NOT GotParam bike_training_goal
            if NOT GotParam bike_goal
                if GotParam quick_start
                    Debounce x time = 0.3000
                else
                    if GotParam dont_move_skater_on_start
                        <no_reset> = 1
                    endif
                endif
                goal_initialize_skater <...> 
            endif
        endif
    endif
    if GotParam goal_intro_script
        <goal_intro_script> <goal_intro_script_params>
    endif
    if GotParam goal_pre_start_script
        <goal_pre_start_script> <goal_pre_start_params>
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if NOT InNetGame
        goal_create_proset_geom <...> 
    endif
    if (Inside_Light_Rain = 1)
        if issoundplaying TestLight01
            setsoundparams TestLight01 vol = LightRainVolume
        endif
        change Paused_Light_Rain = 0
        change Inside_Light_Rain = 0
    endif
    if (Inside_Heavy_Rain = 1)
        if issoundplaying TestLight02
            setsoundparams TestLight02 vol = LightRainVolume
        endif
        if issoundplaying TestMedium02
            setsoundparams TestMedium02 vol = MediumRainVolume
        endif
        change Paused_Heavy_Rain = 0
        change Inside_Heavy_Rain = 0
    endif
    if GotParam trigger_prefix
        Create prefix = <trigger_prefix>
    endif
    if (<trigger_exists> = 1)
        if GotParam hide_goal_pro
            <trigger_obj_id> ::obj_invisible
        endif
    endif
    if GotParam use_hud_counter
        goal_create_counter goal_id = <goal_id> hud_counter_caption = <hud_counter_caption>
    endif
    if NOT GotParam dont_show_goal_text
        create_panel_block id = current_goal text = <goal_text> style = panel_message_goal parent = root_window font_face = dialog
        if GotParam key_combo_text
            SpawnScriptLater goal_wait_and_show_key_combo_text params = { text = <key_combo_text> }
        endif
    endif
    if GotParam goal_start_script
        <goal_start_script> <goal_start_params> <goal_start_script_params>
    endif
    if GotParam goal_quick_start_script
        <goal_quick_start_script> <goal_quick_start_params>
    endif
    if NOT GoalManager_HasWonGoal name = <goal_id>
        SpawnScriptLater goal_show_tips params = { goal_id = <goal_id> }
    endif
    if (<trigger_exists> = 1)
        goal_pro_stop_anim_scripts <...> 
    endif
    if (<trigger_exists> = 1)
        if NOT GotParam trigger_wait_script
            <trigger_wait_script> = GenericProWaiting
        endif
        <trigger_obj_id> ::obj_spawnscriptlater <trigger_wait_script> params = {type = 'midgoal' goal_id = <goal_id> pro = <pro>}
    endif
    if (<trigger_exists> = 1)
        if GotParam kill_radius
            if GotParam quick_start
                goal_set_kill_radius trigger_obj_id = <trigger_obj_id> kill_radius = <kill_radius> goal_id = <goal_id>
            else
                SpawnScriptLater goal_wait_set_kill_radius params = {trigger_obj_id = <trigger_obj_id> kill_radius = <kill_radius> goal_id = <goal_id>}
            endif
        endif
    endif
    if GotParam float_tips
        goal_create_float_tips float_tips = <float_tips> goal_id = <goal_id> key_combos = <key_combos>
    endif
    if GotParam ped_floater_id
        goal_kill_ped_floater ped_floater_id = <ped_floater_id> ped_floater_element = <ped_floater_element> goal_id = <goal_id>
    endif
    if GotParam goal_gameplay_start_script
        if GotParam pak_info
            if StructureContains structure = <pak_info> gameplay
                <wait_for_gameplay_pak_load> = 1
            else
                <wait_for_gameplay_pak_load> = 0
            endif
        else
            <wait_for_gameplay_pak_load> = 0
        endif
        <wait_for_intro> = 0
        spawnscriptnow goal_wait_run_gameplay_start_script params = {wait_for_intro = <wait_for_intro> wait_for_gameplay_pak_load = <wait_for_gameplay_pak_load> goal_gameplay_start_script = <goal_gameplay_start_script> goal_gameplay_start_params = <goal_gameplay_start_params>}
    endif
    FireEvent broadcast type = goal_cam_anim_post_start_done
    if GotParam pak_info
        if StructureContains structure = <pak_info> gameplay
            SpawnScriptLater goal_load_pak params = {prefix = (<pak_info>.prefix)suffix = 'gameplay'}
        endif
    endif
endscript

script goal_start 
    skater_exists = 1
    if InNetGame
        if IsObserving
            <skater_exists> = 0
        endif
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if NOT ChecksumEquals a = (current_progress_audio_clip)b = null
        StopStream (current_progress_audio_clip)
    endif
    if GotParam passive_start
        goal_passive_start goal_id = <goal_id>
        return 
    endif
    change goal_utility_last_goal_activated = <goal_id>
    if GotParam play_goal_start_sound
        ALL_Levels_SFX_Start_Goal
    endif
    if NOT GameModeEquals is_classic
        if NOT GotParam dont_reset_special
            if (<skater_exists> = 1)
                skater ::SetSpecialValue value = 0
            endif
        endif
    endif
    if GotParam flatland_mode
        GoalManager_enable_flatland_mode goal_id = <goal_id>
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            <trigger_exists> = 1
        endif
    endif
    GetCurrentLevel
    if ChecksumEquals a = <level> b = load_sk5ed
        GoalManager_EditGoal name = <goal_id> params = { testing_goal }
    endif
    if NOT GameModeEquals is_classic
        if GotParam reset_score
            ResetScore
        endif
        if ((GotParam start_cam_anim)|| (GotParam start_cam_anims))
            if (<skater_exists> = 1)
                skater ::vibrate Off
            endif
            KillTextureSplats all
            PreAllocSplats
        endif
        destroy_goal_panel_messages
    endif
    KillSpawnedScript name = goal_wait_and_show_key_combo_text
    KillSpawnedScript name = SK3_Killskater_Finish use_proper_version
    if (<trigger_exists> = 1)
        if NOT GotParam quick_start
            kill_start_key_binding
        endif
    endif
    if (<trigger_exists> = 1)
        if NOT IsCreated <trigger_obj_id>
            GoalManager_EditGoal name = <goal_id> params = { force_create_trigger = 1 }
            GoalManager_InitializeGoal name = <goal_id>
            GoalManager_EditGoal name = <goal_id> params = { force_create_trigger = 0 }
            GoalManager_GetGoalParams name = <goal_id>
        endif
    endif
    if InNetGame
        GoalManager_AnnounceGoalStarted name = <goal_id>
    endif
    if (<trigger_exists> = 1)
        <trigger_obj_id> ::Obj_ClearExceptions
        TerminateObjectsScripts id = <trigger_obj_id> script_name = goal_pro_wait_and_reset_avoid_exception
        TerminateObjectsScripts id = <trigger_obj_id> script_name = goal_set_trigger_exceptions
    endif
    if GotParam custom_score_record
        GoalManager_EditGoal name = <goal_id> params = { custom_score_record = 0 }
    endif
    if ScreenElementExists id = goal_start_dialog
        speech_box_exit anchor_id = goal_start_dialog
    endif
    if ScreenElementExists id = goal_retry_anchor
        DestroyScreenElement id = goal_retry_anchor
    endif
    FormatText checksumname = arrow_id '%s_ped_arrow' s = <goal_name>
    if ScreenElementExists id = <arrow_id>
        DestroyScreenElement id = <arrow_id>
    endif
    KillSpawnedScript name = goal_init_after_end_of_run
    if NOT IsObserving
        GetSkaterId
        KillSkaterCamAnim skaterid = <ObjID> all
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam geo_prefix
        goal_create_geo_prefix geo_prefix = <geo_prefix>
    else
        if GotParam geo_prefixes
            GetArraySize geo_prefixes
            <index> = 0
            begin 
            goal_create_geo_prefix geo_prefix = (<geo_prefixes> [ <index> ])
            <index> = (<index> + 1)
            repeat <array_size>
        endif
    endif
    if NOT GameModeEquals is_classic
        if NOT GameModeEquals is_goal_attack
            if NOT IsObserving
                skater ::runstarted
            endif
            if GotParam quick_start
                Debounce x time = 0.3000
            else
                if GotParam dont_move_skater_on_start
                    <no_reset> = 1
                endif
            endif
            if NOT GotParam intro_scene
                goal_initialize_skater <...> 
            endif
        endif
    endif
    if GotParam goal_intro_script
        <goal_intro_script> <goal_intro_script_params>
    endif
    if GotParam goal_pre_start_script
        <goal_pre_start_script> <goal_pre_start_params>
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if NOT InNetGame
        goal_create_proset_geom <...> 
    endif
    if (Inside_Light_Rain = 1)
        if issoundplaying TestLight01
            setsoundparams TestLight01 vol = LightRainVolume
        endif
        change Paused_Light_Rain = 0
        change Inside_Light_Rain = 0
    endif
    if (Inside_Heavy_Rain = 1)
        if issoundplaying TestLight02
            setsoundparams TestLight02 vol = LightRainVolume
        endif
        if issoundplaying TestMedium02
            setsoundparams TestMedium02 vol = MediumRainVolume
        endif
        change Paused_Heavy_Rain = 0
        change Inside_Heavy_Rain = 0
    endif
    if GotParam trigger_prefix
        Create prefix = <trigger_prefix>
    endif
    if GotParam float_tips
        goal_create_float_tips float_tips = <float_tips> goal_id = <goal_id> key_combos = <key_combos>
    endif
    if GotParam ped_floater_id
        goal_kill_ped_floater ped_floater_id = <ped_floater_id> ped_floater_element = <ped_floater_element> goal_id = <goal_id>
    endif
    if GotParam quick_start
        if (<trigger_exists> = 1)
            if GotParam hide_goal_pro
                <trigger_obj_id> ::obj_invisible
            endif
        endif
        goal_initialize_skater <...> 
        if GotParam use_hud_counter
            goal_create_counter goal_id = <goal_id> hud_counter_caption = <hud_counter_caption>
        endif
        if NOT GotParam dont_show_goal_text
            create_panel_block id = current_goal text = <goal_text> style = panel_message_goal parent = root_window font_face = dialog
            if GotParam key_combo_text
                SpawnScriptLater goal_wait_and_show_key_combo_text params = { text = <key_combo_text> }
            endif
        endif
        if GotParam goal_start_script
            <goal_start_script> <goal_start_params> <goal_start_script_params>
        endif
        if GotParam goal_quick_start_script
            <goal_quick_start_script> <goal_quick_start_params>
        endif
        if NOT GoalManager_HasWonGoal name = <goal_id>
            SpawnScriptLater goal_show_tips params = { goal_id = <goal_id> }
        endif
        if (<trigger_exists> = 1)
            goal_pro_stop_anim_scripts <...> 
        endif
        if (<trigger_exists> = 1)
            if NOT GotParam trigger_wait_script
                <trigger_wait_script> = GenericProWaiting
            endif
            <trigger_obj_id> ::obj_spawnscriptlater <trigger_wait_script> params = {type = 'midgoal' goal_id = <goal_id> pro = <pro>}
        endif
        FireEvent broadcast type = goal_cam_anim_post_start_done
        if GotParam pak_info
            if StructureContains structure = <pak_info> gameplay
                SpawnScriptLater goal_load_pak params = {prefix = (<pak_info>.prefix)suffix = 'gameplay'}
            endif
        endif
    else
        if (<trigger_exists> = 1)
            if GotParam pak_info
                if StructureContains structure = <pak_info> start
                    SpawnScriptLater goal_load_pak params = {prefix = (<pak_info>.prefix)suffix = 'start'}
                    <wait_pak_load> = 1
                endif
            endif
            goal_pro_stop_anim_scripts <...> 
            if GotParam trigger_start_script
                <trigger_obj_id> ::obj_spawnscriptlater <trigger_start_script> params = {goal_id = <goal_id> type = 'talking' pro = <pro>}
            else
                if NOT GotParam intro_scene
                    <trigger_obj_id> ::obj_spawnscriptlater GenericProTalking params = {goal_id = <goal_id> type = 'talking' pro = <pro>}
                endif
            endif
            if NOT GotParam trigger_wait_script
                <trigger_wait_script> = GenericProWaiting
            endif
            if GotParam goal_start_movie_script
                <goal_start_movie_script> <goal_start_movie_script_params>
            endif
            if GotParam no_play_hold
                <no_play_hold> = no_play_hold
            endif
            if GotParam intro_scene
                <use_igc> = use_igc
            endif
            SpawnScriptLater goal_cam_anim_play id = new_goal_cam_anim params = {goal_id = <goal_id>
                next_trigger_script = <trigger_wait_script>
                type = 'midgoal'
                <no_play_hold>
                dont_unpause = <dont_unpause>
                <use_igc>
                wait_pak_load = <wait_pak_load>
            }
            if GotParam pak_info
                if StructureContains structure = <pak_info> gameplay
                    SpawnScriptLater goal_wait_load_pak params = {prefix = (<pak_info>.prefix)suffix = 'gameplay'}
                else
                    if StructureContains structure = <pak_info> start
                        SpawnScriptLater goal_wait_unload_pak
                    endif
                endif
            endif
        else
            if GotParam goal_start_script
                <goal_start_script> <goal_start_params> <goal_start_script_params>
            endif
        endif
    endif
    if (<trigger_exists> = 1)
        if GotParam kill_radius
            if GotParam quick_start
                goal_set_kill_radius trigger_obj_id = <trigger_obj_id> kill_radius = <kill_radius> goal_id = <goal_id>
            else
                SpawnScriptLater goal_wait_set_kill_radius params = {trigger_obj_id = <trigger_obj_id> kill_radius = <kill_radius> goal_id = <goal_id>}
            endif
        endif
    endif
    if GotParam goal_gameplay_start_script
        if GotParam pak_info
            if StructureContains structure = <pak_info> gameplay
                <wait_for_gameplay_pak_load> = 1
            else
                <wait_for_gameplay_pak_load> = 0
            endif
        else
            <wait_for_gameplay_pak_load> = 0
        endif
        if GotParam intro_scene
            <wait_for_intro> = 1
            if GotParam quick_start
                <wait_for_intro> = 0
            endif
        else
            <wait_for_intro> = 0
        endif
        spawnscriptnow goal_wait_run_gameplay_start_script params = {wait_for_intro = <wait_for_intro> wait_for_gameplay_pak_load = <wait_for_gameplay_pak_load> goal_gameplay_start_script = <goal_gameplay_start_script> goal_gameplay_start_params = <goal_gameplay_start_params>}
    endif
    if globalexists name = dump_coim_on_goal_start type = integer
        if (dump_coim_on_goal_start = 1)
            if NOT cd
                DumpCoimEntries dumptofile name = <goal_id>
            endif
        endif
    endif
endscript

script goal_wait_run_gameplay_start_script 
    if (<wait_for_intro> = 1)
        Block \{ untilevent = goal_cam_anim_post_start_done }
    endif
    if (<wait_for_gameplay_pak_load> = 1)
        Block \{ untilevent = goal_load_pak_done }
    endif
    <goal_gameplay_start_script> <goal_gameplay_start_params>
endscript

script goal_wait_set_kill_radius 
    Block \{ untilevent = goal_cam_anim_post_start_done }
    goal_set_kill_radius trigger_obj_id = <trigger_obj_id> kill_radius = <kill_radius> goal_id = <goal_id>
endscript

script goal_wait_load_pak 
    Block \{ untilevent = goal_cam_anim_post_start_done }
    goal_load_pak prefix = <prefix> suffix = <suffix>
endscript

script goal_wait_unload_pak 
    Block \{ untilevent = goal_cam_anim_post_start_done }
    goal_unload_pak
endscript
g_goal_current_pak_name_noext = ''
g_goal_current_pak_short_name = ''
g_goal_current_pak_editable_list = ''
g_goal_loading_mission_pak = 0

script goal_load_pak 
    goal_unload_pak
    FlushPedsFromHeap heap = GoalHeap
    FormatText textname = pak_short_name '%p_%s' p = <prefix> s = <suffix>
    change g_goal_current_pak_short_name = <pak_short_name>
    FormatText textname = pak_name_noext 'missions/worldzones/%p/%p_%s/%p_%s' p = <prefix> s = <suffix>
    change g_goal_current_pak_name_noext = <pak_name_noext>
    change g_goal_loading_mission_pak = 1
    LoadPak (<pak_name_noext> + '.pak')heap = GoalHeap
    change g_goal_loading_mission_pak = 0
    FormatText checksumname = editable_list '%p_%s_editable_list' p = <prefix> s = <suffix>
    FormatText textname = editable_list_string '%p_%s_editable_list' p = <prefix> s = <suffix>
    if globalexists name = <editable_list> type = array
        AddEditableList <editable_list>
        change g_goal_current_pak_editable_list = <editable_list_string>
    endif
    FormatText checksumname = array_name '%p_%s_NodeArray' p = <prefix> s = <suffix>
    FormatText checksumname = zone_name '%p_%s' p = <prefix> s = <suffix>
    ParseNodeArray array_name = <array_name> zone_name = <zone_name> no_vclight_buffers heap = GoalHeap
    LoadPak (<pak_name_noext> + '_text.pak')heap = GoalHeap localized
    if IsNGC
        igc_temporarily_disable_rendering 5 gameframes
    endif
    FireEvent broadcast type = goal_load_pak_done
endscript
goal_unload_pak_in_progress = 0

script goal_unload_pak 
    if IsTrue igc_playing
        Block type = igc_scene_finished
    endif
    StopAnimSave
    begin 
    if ((goal_unload_pak_in_progress)= 0)
        break 
    endif
    printf 'goal_unload_pak - waiting for goal_unload_pak to finish'
    wait 1 frame
    repeat 
    if NOT ((g_goal_current_pak_name_noext)= '')
        if ((goal_unload_pak_in_progress)= 0)
            StartDelaySystemUI
            spawnscriptnow TemporarilyDisableInput params = { time = 150 }id = goal_input_toggle
            igc_temporarily_disable_rendering 4 gameframes
            change goal_unload_pak_in_progress = 1
            BeginUnloadPak ((g_goal_current_pak_name_noext)+ '.pak')
            wait 2 frames
            GoalManager_RemoveOrphanRails
            EndUnloadPak ((g_goal_current_pak_name_noext)+ '.pak')
            BeginUnloadPak ((g_goal_current_pak_name_noext)+ '_text.pak')localized
            EndUnloadPak ((g_goal_current_pak_name_noext)+ '_text.pak')localized
            StopDelaySystemUI
            change g_goal_current_pak_name_noext = ''
            change goal_unload_pak_in_progress = 0
        endif
    endif
    if NOT ((g_goal_current_pak_editable_list)= '')
        FormatText checksumname = editable_list '%c' c = g_goal_current_pak_editable_list
        RemoveEditableList <editable_list>
        change g_goal_current_pak_editable_list = ''
    endif
    FireEvent broadcast type = goal_unload_pak_done
    if GotParam fire_finished_success_sequence
        FireEvent broadcast type = goal_finished_success_sequence
    endif
    change g_goal_current_pak_short_name = ''
endscript

script goal_hide_all_floaters 
    if ((is_changing_levels)= 0)
        GoalManager_HideFloatTips
        GoalManager_HidePedFloaters
        GoalManager_HidePoiFloaters
    endif
endscript

script goal_unhide_all_floaters 
    if ((is_changing_levels)= 0)
        GoalManager_UnHideFloatTips
        GoalManager_UnHidePedFloaters
        GoalManager_UnHidePoiFloaters
    endif
endscript

script goal_wait_create_float_tips 
    Block \{ untilevent = goal_cam_anim_post_start_done }
    goal_create_float_tips float_tips = <float_tips> goal_id = <goal_id> key_combos = <key_combos>
endscript

script goal_create_float_tips bg_rgba = [ 72 72 88 65 ] arrow_rgba = [ 128 84 0 80 ] text_rgba = [ 60 90 60 128 ]
    SetScreenElementLock id = root_window Off
    if GotParam key_combos
        <replace_trick_text> = 1
    else
        <replace_trick_text> = 0
    endif
    GetArraySize float_tips
    <index> = 0
    begin 
    if NOT StructureContains structure = (<float_tips> [ <index> ])text
        scriptassert 'Float_tips structure array passed to goal without text member.'
    endif
    if NOT StructureContains structure = (<float_tips> [ <index> ])obj_id
        if NOT StructureContains structure = (<float_tips> [ <index> ])Pos
            scriptassert 'Float_tips structure array passed to goal without obj_id or pos member.'
        endif
    endif
    FormatText checksumname = id 'float_tip%a' a = <index>
    if (<replace_trick_text> = 1)
        ReplaceTrickText name = <goal_id> text = (<float_tips> [ <index> ].text)
    else
        <TrickText> = (<float_tips> [ <index> ].text)
    endif
    CreateScreenElement {
        type = ContainerElement
        parent = root_window
        id = <id>
        just = [ center center ]
        Pos = (-100.0, -100.0)
        dims = (10.0, 10.0)
    }
    <parent_id> = <id>
    CreateScreenElement {
        type = TextElement
        parent = <parent_id>
        local_id = text
        font = newtrickfont
        rgba = <text_rgba>
        just = [ center center ]
        text = <TrickText>
        Pos = (0.0, 0.0)
        Scale = 1.500
    }
    GetScreenElementDims id = <id>
    CreateScreenElement {
        type = SpriteElement
        parent = <parent_id>
        local_id = arrow
        texture = down_arrow
        rgba = <arrow_rgba>
        just = [ center center ]
        Pos = (0.0, 0.0)
        Scale = (3.0, 3.0)
    }
    CreateScreenElement {
        type = SpriteElement
        parent = <parent_id>
        local_id = bG
        texture = level_swatch
        rgba = <bg_rgba>
        just = [ center center ]
        Pos = (0.0, 0.0)
        Scale = (1.0, 1.0)
    }
    DoScreenElementMorph {
        id = {<parent_id> child = bG}
        Scale = (((1.0, 0.0) * ((<width> + 16.0)/ 128.0))+ ((0.0, 1.0) * ((<height> + 8.0)/ 32.0)))
        time = 0.0
    }
    SetScreenElementProps {
        id = {<parent_id> child = arrow}
        Pos = ((0.0, 0.0) + ((0.0, 1.0) * (<height> / 2.0)))
    }
    <index> = (<index> + 1)
    repeat <array_size>
endscript

script goal_spawn_update_float_tips 
    SpawnScriptLater goal_update_float_tips params = {index = <index> pos_3d = <pos_3d> alpha = <alpha>}
endscript

script goal_update_float_tips 
    FormatText checksumname = id 'float_tip%a' a = <index>
    if ScreenElementExists id = <id>
        SetScreenElementProps {
            id = <id>
            pos3d = <pos_3d>
        }
        if GotParam alpha
            DoScreenElementMorph id = {<id> child = bG}alpha = <alpha> time = 0.0
            DoScreenElementMorph id = {<id> child = arrow}alpha = <alpha> time = 0.0
            DoScreenElementMorph id = {<id> child = text}alpha = <alpha> time = 0.0
        endif
    endif
endscript

script goal_hide_float_tips 
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam float_tips
        <float_tips_pre_pause_states> = []
        GetArraySize float_tips
        <index> = 0
        begin 
        FormatText checksumname = id 'float_tip%a' a = <index>
        if ScreenElementExists id = <id>
            GetScreenElementProps id = <id>
            <tmp_array> = [
                {
                    id = <id>
                    alpha = <alpha>
                }
            ]
            <float_tips_pre_pause_states> = (<float_tips_pre_pause_states> + <tmp_array>)
            <id> ::DoMorph alpha = 0
        endif
        <index> = (<index> + 1)
        repeat <array_size>
        GoalManager_EditGoal name = <goal_id> params = { float_tips_pre_pause_states = <float_tips_pre_pause_states> }
    endif
endscript

script goal_unhide_float_tips 
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam float_tips_pre_pause_states
        GetArraySize float_tips_pre_pause_states
        if (<array_size> > 0)
            <index> = 0
            begin 
            if ScreenElementExists id = (<float_tips_pre_pause_states> [ <index> ].id)
                (<float_tips_pre_pause_states> [ <index> ].id)::DoMorph alpha = (<float_tips_pre_pause_states> [ <index> ].alpha)
            endif
            <index> = (<index> + 1)
            repeat <array_size>
            GoalManager_EditGoal name = <goal_id> params = {float_tips_pre_pause_states = []}
        endif
    endif
endscript
marker_hide_distance = 3000
marker_switch_distance = 800

script goal_create_ped_floater {
        icon = HUD_comp_transition
        icon_rgba = [ 90 90 90 90 ]
        text = [ 'GOAL PED' ]
        text_rgba = [ 60 60 60 112 ]
        text_font = newtrickfont
        text_scale = (1.0, 1.0)
        bubble_rgba = [ 100 100 120 80 ]
    }
    GoalManager_GetGoalParams name = <goal_id>
    <create_floater> = 1
    if GotParam ped_floater_alive
        if (<ped_floater_alive> = 1)
            <create_floater> = 0
        endif
    endif
    if (<create_floater> = 1)
        SetScreenElementLock id = root_window Off
        GetUniqueCompositeObjectID preferredid = marker
        CreateScreenElement {
            type = ContainerElement
            parent = root_window
            pos3d = (0.0, 0.0, 0.0)
            just = [ center bottom ]
        }
        <anchor_id> = <id>
        CreateScreenElement {
            type = ContainerElement
            parent = <anchor_id>
            just = [ center bottom ]
            alpha = 0
            Pos = (0.0, 0.0)
            local_id = goal_sub_anchor
        }
        <goal_sub_anchor> = <id>
        CreateScreenElement {
            type = SpriteElement
            parent = <goal_sub_anchor>
            texture = <icon>
            rgba = <icon_rgba>
            Scale = (4.0, 4.0)
            just = [ center , bottom ]
            Pos = (0.0, -50.0)
            local_id = icon
            alpha = 0
        }
        if GotParam ped_floater_text
            <floater_text> = <ped_floater_text>
        else
            GetArraySize text
            getrandomvalue name = text_index a = 0 b = (<array_size> -1)integer
            <floater_text> = (<text> [ <text_index> ])
        endif
        CreateScreenElement {
            type = TextElement
            parent = <goal_sub_anchor>
            font = <text_font>
            text = <floater_text>
            Pos = (0.0, -12.0)
            just = [ center bottom ]
            rgba = <text_rgba>
            Scale = <text_scale>
            local_id = text
            alpha = 0
        }
        GetScreenElementDims id = <id>
        CreateScreenElement {
            type = SpriteElement
            parent = <goal_sub_anchor>
            texture = ped_bubble
            rgba = <bubble_rgba>
            Scale = (1.0, 1.0)
            just = [ center , bottom ]
            Pos = (0.0, 0.0)
            local_id = bubble
            alpha = 0
        }
        DoScreenElementMorph {
            id = <id>
            Scale = (((1.0, 0.0) * ((<width> + 20.0)/ 64.0))+ ((0.0, 1.0) * ((<height> + 20.0)/ 16.0)))
            time = 0.0
        }
        CreateCompositeObject {
            Components = [
                {Component = marker
                    parent_id = <parent_id>
                    element_id = <anchor_id>
                    type = ped
                }
            ]
            params = {
                name = <uniqueid>
            }
        }
        GoalManager_EditGoal name = <goal_id> params = {ped_floater_alive = 1 ped_floater_id = <uniqueid> ped_floater_element = <anchor_id>}
    endif
endscript

script goal_show_ped_floater 
    obj_getid
    DoScreenElementMorph id = {<ObjID> child = goal_sub_anchor}alpha = 1 time = 0.2000
endscript

script goal_hide_ped_floater 
    obj_getid
    DoScreenElementMorph id = {<ObjID> child = goal_sub_anchor}alpha = 0 time = 0.2000
endscript

script goal_switch_ped_floater_icon 
    obj_getid
    GetScreenElementChildren id = {<ObjID> child = goal_sub_anchor}
    DoScreenElementMorph id = (<children> [ 0 ])alpha = 1 time = 0.5000
    DoScreenElementMorph id = (<children> [ 1 ])alpha = 0 time = 0.5000
    DoScreenElementMorph id = (<children> [ 2 ])alpha = 0 time = 0.5000
endscript

script goal_switch_ped_floater_textbubble 
    obj_getid
    GetScreenElementChildren id = {<ObjID> child = goal_sub_anchor}
    DoScreenElementMorph id = (<children> [ 0 ])alpha = 0 time = 0.5000
    DoScreenElementMorph id = (<children> [ 1 ])alpha = 1 time = 0.5000
    DoScreenElementMorph id = (<children> [ 2 ])alpha = 1 time = 0.5000
endscript

script goal_kill_ped_floater 
    if IsCreated <ped_floater_id>
        <ped_floater_id> ::Die
    endif
    if ScreenElementExists id = <ped_floater_element>
        DestroyScreenElement id = <ped_floater_element>
    endif
    GoalManager_EditGoal name = <goal_id> params = { ped_floater_alive = 0 }
endscript

script goal_add_poi_floaters 
    if NOT InSplitScreenGame
        if GameModeEquals is_career
            <poi_infos> = [
                {
                    suffix = '_TRG_skateshop'
                    struct = (in_game_skateshop_floater)
                }
                {
                    suffix = '_TRG_ClothingShop'
                    struct = (in_game_clothingshop_floater)
                }
                {
                    suffix = '_TRG_BarberShop'
                    struct = (in_game_barbershop_floater)
                }
                {
                    suffix = '_TRG_AccShop'
                    struct = (in_game_accshop_floater)
                }
                {
                    suffix = '_TRG_TattooShop'
                    struct = (in_game_tattooshop_floater)
                }
                {
                    suffix = '_TRG_Bus'
                    struct = (in_game_bus_floater)
                }
                {
                    suffix = '_TRG_Sleep00'
                    struct = (kickin_it_floater)
                }
                {
                    suffix = '_TRG_Sleep01'
                    struct = (kickin_it_floater)
                }
                {
                    suffix = '_TRG_Sleep02'
                    struct = (kickin_it_floater)
                }
                {
                    suffix = '_TRG_Sleep03'
                    struct = (kickin_it_floater)
                }
                {
                    suffix = '_TRG_Sleep04'
                    struct = (kickin_it_floater)
                }
                {
                    suffix = '_TRG_CreateATrick'
                    struct = (in_game_cat_floater)
                }
            ]
            GetArraySize poi_infos
            <index> = 0
            begin 
            goal_create_poi_floater zone = <zone> suffix = (<poi_infos> [ <index> ].suffix)(<poi_infos> [ <index> ].struct)
            <index> = (<index> + 1)
            repeat <array_size>
            goal_create_bike_spot_floaters zone_name = <zone>
        endif
    endif
endscript

script goal_create_poi_floater 
    <create_floater> = 0
    if (<icon> = HUD_comp_bulb)
        if NOT GetNodeFlag NODEFLAG_CAT_NODES
            return 
        endif
    endif
    FormatText checksumname = poi_node '%z%s' z = <zone> s = <suffix>
    if IsInNodeArray <poi_node>
        begin 
        if NOT IsCreated <poi_node>
            wait 10 gameframes
        else
            <create_floater> = 1
            <poi_node> ::gettags
            break 
        endif
        repeat 10
    else
    endif
    if GotParam poi_floater_alive
        if (<poi_floater_alive> = 1)
            <create_floater> = 0
        endif
    endif
    if (<create_floater> = 1)
        GetUniqueCompositeObjectID preferredid = marker
        SetScreenElementLock id = root_window Off
        CreateScreenElement {
            type = ContainerElement
            parent = root_window
            pos3d = (0.0, 0.0, 0.0)
            just = [ center bottom ]
        }
        <anchor_id> = <id>
        CreateScreenElement {
            type = ContainerElement
            parent = <anchor_id>
            just = [ center bottom ]
            alpha = 0
            Pos = (0.0, 0.0)
            local_id = goal_sub_anchor
        }
        <goal_sub_anchor> = <id>
        CreateScreenElement {
            type = SpriteElement
            parent = <goal_sub_anchor>
            texture = <icon>
            rgba = <icon_rgba>
            Scale = (4.0, 4.0)
            just = [ center , center ]
            Pos = (0.0, 0.0)
            local_id = icon
            alpha = 0
        }
        if IsArray <text>
            GetArraySize text
            getrandomvalue name = text_index a = 0 b = (<array_size> -1)integer
            <text> = (<text> [ <text_index> ])
        endif
        CreateScreenElement {
            type = TextElement
            parent = <goal_sub_anchor>
            font = <text_font>
            text = <text>
            Pos = (0.0, 80.0)
            just = [ center center ]
            rgba = <text_rgba>
            Scale = <text_scale>
            local_id = text
            alpha = 0
        }
        GetScreenElementDims id = <id>
        CreateScreenElement {
            type = SpriteElement
            parent = <goal_sub_anchor>
            texture = ped_bubble
            rgba = <bubble_rgba>
            Scale = (1.0, 1.0)
            just = [ center , center ]
            Pos = (0.0, 80.0)
            local_id = bubble
            alpha = 0
        }
        DoScreenElementMorph {
            id = <id>
            Scale = (((1.0, 0.0) * ((<width> + 20.0)/ 64.0))+ ((0.0, 1.0) * ((<height> + 20.0)/ 16.0)))
            time = 0.0
        }
        CreateCompositeObject {
            Components = [
                {Component = marker
                    parent_id = <poi_node>
                    element_id = <anchor_id>
                    type = POI
                }
            ]
            params = {
                name = <uniqueid>
            }
        }
        <poi_node> ::settags poi_floater_alive = 1 poi_floater_id = <uniqueid> poi_floater_element = <anchor_id>
    endif
endscript

script goal_remove_poi_floaters 
    <poi_suffixes> = [
        '_TRG_skateshop'
        '_TRG_ClothingShop'
        '_TRG_BarberShop'
        '_TRG_AccShop'
        '_TRG_TattooShop'
        '_TRG_Bus'
        '_TRG_Sleep00'
        '_TRG_Sleep01'
        '_TRG_Sleep02'
        '_TRG_Sleep03'
        '_TRG_Sleep04'
        '_TRG_CreateATrick'
    ]
    GetArraySize poi_suffixes
    <index> = 0
    begin 
    goal_kill_poi_floater zone = <zone> suffix = (<poi_suffixes> [ <index> ])
    <index> = (<index> + 1)
    repeat <array_size>
    goal_kill_bike_spot_floaters
endscript

script goal_kill_poi_floater 
    FormatText checksumname = poi_node '%z%s' z = <zone> s = <suffix>
    if IsInNodeArray <poi_node>
        if IsCreated <poi_node>
            <poi_node> ::gettags
            if GotParam poi_floater_id
                if IsCreated <poi_floater_id>
                    <poi_floater_id> ::Die
                endif
            endif
            if GotParam poi_floater_element
                if ScreenElementExists id = <poi_floater_element>
                    KillSpawnedScript name = goal_show_ped_floater
                    KillSpawnedScript name = goal_hide_ped_floater
                    KillSpawnedScript name = goal_switch_ped_floater_icon
                    KillSpawnedScript name = goal_switch_ped_floater_textbubble
                    DestroyScreenElement id = <poi_floater_element>
                endif
            endif
            <poi_node> ::settags poi_floater_alive = 0
        endif
    endif
endscript

script goal_create_bike_spot_floaters (in_game_bike_floater)
    if NOT InSplitScreenGame
        if GameModeEquals is_career
            if NOT GotParam zone_name
                if NOT GetCurrentZoneName
                    printf 'goal_create_bike_spot_floaters: no current zone?'
                    return 
                endif
            endif
            <index> = 0
            begin 
            <create_floater> = 0
            if (<index> = 0)
                FormatText checksumname = poi_node '%z_TRG_Ped_BikeGuy' z = <zone_name>
                if IsInNodeArray <poi_node>
                    begin 
                    if NOT IsCreated <poi_node>
                        wait 10 gameframes
                    else
                        <create_floater> = 1
                        break 
                    endif
                    repeat 10
                endif
            else
                if IsCreated bikespot
                    <poi_node> = bikespot
                    <create_floater> = 1
                endif
            endif
            if (<create_floater> = 1)
                GetUniqueCompositeObjectID preferredid = marker
                SetScreenElementLock id = root_window Off
                CreateScreenElement {
                    type = ContainerElement
                    parent = root_window
                    pos3d = (0.0, 0.0, 0.0)
                    just = [ center bottom ]
                }
                <anchor_id> = <id>
                CreateScreenElement {
                    type = ContainerElement
                    parent = <anchor_id>
                    just = [ center bottom ]
                    alpha = 0
                    Pos = (0.0, 0.0)
                    local_id = goal_sub_anchor
                }
                <goal_sub_anchor> = <id>
                CreateScreenElement {
                    type = SpriteElement
                    parent = <goal_sub_anchor>
                    texture = <icon>
                    rgba = <icon_rgba>
                    Scale = (4.0, 4.0)
                    just = [ center , center ]
                    Pos = (0.0, 0.0)
                    local_id = icon
                    alpha = 0
                }
                CreateScreenElement {
                    type = TextElement
                    parent = <goal_sub_anchor>
                    font = <text_font>
                    text = <text>
                    Pos = (0.0, 80.0)
                    just = [ center center ]
                    rgba = <text_rgba>
                    Scale = <text_scale>
                    local_id = text
                    alpha = 0
                }
                GetScreenElementDims id = <id>
                CreateScreenElement {
                    type = SpriteElement
                    parent = <goal_sub_anchor>
                    texture = ped_bubble
                    rgba = <bubble_rgba>
                    Scale = (1.0, 1.0)
                    just = [ center , center ]
                    Pos = (0.0, 80.0)
                    local_id = bubble
                    alpha = 0
                }
                DoScreenElementMorph {
                    id = <id>
                    Scale = (((1.0, 0.0) * ((<width> + 20.0)/ 64.0))+ ((0.0, 1.0) * ((<height> + 20.0)/ 16.0)))
                    time = 0.0
                }
                CreateCompositeObject {
                    Components = [
                        {Component = marker
                            parent_id = <poi_node>
                            element_id = <anchor_id>
                            type = bike
                        }
                    ]
                    params = {
                        name = <uniqueid>
                    }
                }
                <poi_node> ::settags poi_floater_id = <uniqueid> poi_floater_element = <anchor_id>
            endif
            <index> = (<index> + 1)
            repeat 2
        endif
    endif
endscript

script goal_kill_bike_spot_floaters 
    if NOT GetCurrentZoneName
        printf 'no current zone?'
        return 
    endif
    <index> = 0
    begin 
    if (<index> = 0)
        FormatText checksumname = poi_node '%z_TRG_Ped_BikeGuy' z = <zone_name>
    else
        <poi_node> = bikespot
    endif
    if IsCreated <poi_node>
        <poi_node> ::gettags
        if GotParam poi_floater_id
            if IsCreated <poi_floater_id>
                <poi_floater_id> ::Die
            endif
        endif
        if GotParam poi_floater_element
            if ScreenElementExists id = <poi_floater_element>
                DestroyScreenElement id = <poi_floater_element>
            endif
        endif
    endif
    <index> = (<index> + 1)
    repeat 2
endscript

script goal_create_geo_prefix 
    Create prefix = <geo_prefix>
    FormatText textname = geo_trigger_prefix 'TRG_%p' p = <geo_prefix>
    Create prefix = <geo_trigger_prefix>
    GoalManager_GetProsetNotPrefix <geo_prefix>
    Kill prefix = <proset_not_prefix>
    FormatText textname = geo_not_trigger_prefix 'TRG_%p' p = <proset_not_prefix>
    Kill prefix = <geo_not_trigger_prefix>
endscript

script goal_kill_geo_prefix 
    Kill prefix = <geo_prefix>
    FormatText textname = geo_trigger_prefix 'TRG_%p' p = <geo_prefix>
    Kill prefix = <geo_trigger_prefix>
    GoalManager_GetProsetNotPrefix <geo_prefix>
    Create prefix = <proset_not_prefix>
    FormatText textname = geo_not_trigger_prefix 'TRG_%p' p = <proset_not_prefix>
    Create prefix = <geo_not_trigger_prefix>
endscript

script goal_create_proset_geom 
    if GotParam proset_prefix
        FormatText checksumname = proset_flag 'FLAG_%pGEO_ON' p = <proset_prefix>
        SetFlag flag = <proset_flag>
        Create prefix = <proset_prefix>
        FormatText textname = proset_trigger_prefix 'TRG_%p' p = <proset_prefix>
        Create prefix = <proset_trigger_prefix>
        GoalManager_GetProsetNotPrefix <proset_prefix>
        Kill prefix = <proset_not_prefix>
        FormatText textname = proset_not_trigger_prefix 'TRG_%p' p = <proset_not_prefix>
        Kill prefix = <proset_not_trigger_prefix>
    endif
endscript

script goal_kill_proset_geom 
    if GotParam proset_prefix
        FormatText checksumname = proset_flag 'FLAG_%pGEO_ON' p = <proset_prefix>
        UnSetFlag flag = <proset_flag>
        Kill prefix = <proset_prefix>
        FormatText textname = proset_trigger_prefix 'TRG_%p' p = <proset_prefix>
        Kill prefix = <proset_trigger_prefix>
        GoalManager_GetProsetNotPrefix <proset_prefix>
        Create prefix = <proset_not_prefix>
        FormatText textname = proset_not_trigger_prefix 'TRG_%p' p = <proset_not_prefix>
        Create prefix = <proset_not_trigger_prefix>
    endif
endscript

script goal_set_kill_radius 
    <trigger_obj_id> ::Obj_ClearException objectoutofradius
    <trigger_obj_id> ::obj_setouterradius <kill_radius>
    <trigger_obj_id> ::Obj_SetException Ex = objectoutofradius scr = goal_crossed_kill_radius params = { goal_id = <goal_id> }
endscript

script goal_crossed_kill_radius 
    create_panel_message \{ id = goal_message text = str_g_u_52 style = panel_message_generic_loss }
    <trigger_obj_id> ::Obj_ClearException objectoutofradius
    GoalManager_LoseGoal name = <goal_id>
endscript

script goal_expire 
    printf \{ 'goal_expire' }
    destroy_goal_panel_messages
    create_panel_message \{ id = goal_message text = str_g_u_53 style = panel_message_generic_loss }
    if GoalManager_EndRunCalled name = <goal_id>
        if GoalManager_StartedEndOfRun name = <goal_id>
            SpawnSkaterScript goal_init_after_end_of_run params = { goal_id = <goal_id> }
        else
            GoalManager_ClearEndRun name = <goal_id>
        endif
    endif
endscript

script goal_success goal_text = str_g_u_54
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam safe_restart_node
        RemoveParameter restart_node
        <restart_node> = <safe_restart_node>
        goal_initialize_skater <...> 
    endif
    if GotParam goal_pre_success_script
        <goal_pre_success_script> <goal_pre_success_params>
    endif
    if NOT InNetGame
        kill_start_key_binding
    endif
    goal_destroy_counter
    if GotParam pak_info
        if StructureContains structure = <pak_info> success
            SpawnScriptLater goal_load_pak params = {prefix = (<pak_info>.prefix)suffix = 'success'}
            <wait_pak_load> = 1
        else
            spawnscriptnow goal_unload_pak
        endif
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            <trigger_exists> = 1
        endif
    endif
    if GotParam goal_outro_script
        <goal_outro_script> <goal_outro_script_params>
    endif
    if ScreenElementExists id = goal_message
        RunScriptOnScreenElement id = goal_message kill_panel_message
    endif
    if (<trigger_exists> = 1)
        goal_pro_stop_anim_scripts <...> 
        if IsCreated <trigger_obj_id>
            if GotParam trigger_success_script
                <trigger_obj_id> ::obj_spawnscriptlater <trigger_success_script> params = {goal_id = <goal_id> pro = <pro> type = 'Success'}
            else
                if NOT GotParam success_scene
                    <trigger_obj_id> ::obj_spawnscriptlater GenericProSuccess params = {goal_id = <goal_id> pro = <pro> type = 'Success'}
                endif
            endif
        endif
        if NOT GotParam trigger_wait_script
            <trigger_wait_script> = GenericProWaiting
        endif
    endif
    <already_beat_goal> = 0
    if GoalManager_HasWonGoal name = <goal_id>
        <already_beat_goal> = 1
    endif
    if NOT (<already_beat_goal> = 1)
        if GotParam reward_trickslot
            if NOT GotParam already_added_trickslot
                GoalManager_EditGoal name = <goal_id> params = { just_added_trickslot = 1 }
                GetCurrentSkaterProfileIndex
                GetSkaterProfileInfo player = <currentSkaterProfileIndex>
                if (<max_specials> < max_number_of_special_trickslots)
                    AwardSpecialTrickslot
                endif
            endif
        endif
    endif
    if NOT InMultiPlayerGame
        if ((GotParam success_cam_anim)|| (GotParam success_cam_anims)|| (GotParam success_scene))
            change check_for_unplugged_controllers = 0
            if GotParam success_scene
                <use_igc> = use_igc
            endif
            SpawnScriptLater goal_cam_anim_play params = {
                goal_id = <goal_id>
                just_won_goal = 1
                gonna_show_message
                already_beat_goal = <already_beat_goal>
                use_igc = <use_igc>
                wait_pak_load = <wait_pak_load>
            }
            <wait_for_success_scene_end> = 1
        else
            SpawnScriptLater goal_success_no_anims params = <...> 
        endif
    else
        if NOT InNetGame
            restore_start_key_binding
        endif
        if GotParam goal_success_script
            <goal_success_script> <goal_success_params>
        endif
    endif
    if GotParam cash_goal
        CareerFunc func = AddCash params = { cash = <cash_reward> }
        SpawnScriptLater cash_goals_add_next_goal params = { zone = <zone> }
    endif
    if GotParam graffiti_goal
        CareerFunc func = AddCash params = { cash = <cash_reward> }
        SpawnScriptLater graffiti_goals_add_next_goal params = { zone = <zone> }
    endif
    if GotParam bike_training_goal
        CareerFunc func = AddCash params = { cash = <cash_reward> }
        SpawnScriptLater goal_bike_goals_add_next_goal params = { zone = <zone> }
    endif
    if GotParam test_skateranch_piece_goal
        SpawnScriptLater goal_piece_goals_add_next_goal params = { zone = <zone> }
    endif
    if NOT GotParam no_success_messages
        SpawnScriptLater goal_success_messages params = <...> 
    endif
    if GameModeEquals is_classic
        SpawnScriptLater classic_mode_check_for_all_complete_message
    endif
    if GotParam goal_post_success_script
        spawnscriptnow goal_wait_post_success_script params = <...> 
    endif
endscript

script goal_wait_post_success_script 
    if GameModeEquals \{ is_career }
        CareerFunc func = PushIncidentalAtom params = {
            name = <goal_id>
            atom_script = <goal_post_success_script>
            atom_params = <goal_post_success_params>
        }
    else
        Block \{ untilevent = goal_finished_success_sequence }
        <goal_post_success_script> <goal_post_success_params>
    endif
endscript

script goal_success_no_anims 
    goal_cam_anim_post_cleanup <...> 
    goal_cam_anim_post_success dont_kill_messages <...> 
endscript
goal_panel_total_messages_queued = 0
goal_panel_current_message = 1
goal_panel_queue_size = 0

script goal_panel_wait_and_reset_queue 
    wait \{ 2 seconds }
    change goal_panel_current_message = (goal_panel_current_message + 1)
    change goal_panel_queue_size = (goal_panel_queue_size -1)
    wait \{ 5 seconds }
    goal_panel_reset_queue
endscript

script goal_panel_reset_queue 
    change \{ goal_panel_queue_size = 0 }
    change \{ goal_panel_total_messages_queued = 0 }
    change \{ goal_panel_current_message = 1 }
    KillSpawnedScript \{ name = goal_panel_wait_for_my_turn }
endscript

script goal_panel_wait_for_my_turn 
    if (goal_panel_queue_size > 9)
        goto \{ NullScript }
    endif
    change goal_panel_total_messages_queued = (goal_panel_total_messages_queued + 1)
    change goal_panel_queue_size = (goal_panel_queue_size + 1)
    my_turn = (goal_panel_total_messages_queued)
    begin 
    if (<my_turn> = goal_panel_current_message)
        break 
    endif
    wait \{ 1 gameframes }
    repeat 
    KillSpawnedScript \{ name = goal_panel_wait_and_reset_queue }
    SpawnScriptLater \{ goal_panel_wait_and_reset_queue }
endscript

script goal_get_goal_info_text 
    if StructureContains structure = story_mode_goal_info <goal_id>
        return goal_info_text = ((story_mode_goal_info.<goal_id>).view_goals_text)
    endif
endscript

script goal_success_messages 
    if GotParam wait_for_success_scene_end
        Block untilevent = goal_cam_anim_done
    endif
    goal_panel_wait_for_my_turn
    SpawnScriptLater Goal_Success_Message_Sound
    if GameModeEquals is_career
    else
        if GotParam view_goals_text
            create_panel_block id = goal_complete text = <view_goals_text> style = panel_message_goalcomplete
        else
            create_panel_block id = goal_complete text = <goal_text> style = panel_message_goalcomplete
        endif
    endif
    create_panel_sprite id = goal_complete_sprite texture = go_done style = panel_sprite_goalcomplete
    create_panel_message id = goal_complete_line2 text = str_g_u_55 style = panel_message_goalcompleteline2
    if GotParam reward_trickslot
        if GotParam just_added_trickslot
            if (<just_added_trickslot> = 1)
                GoalManager_EditGoal name = <goal_id> params = { just_added_trickslot = 0 }
                goal_got_trickslot
            endif
        endif
    endif
    if GotParam cash_goal
        goal_got_cash amount = <cash_reward>
    endif
    if GotParam bike_training_goal
        goal_got_cash amount = <cash_reward>
    endif
    if GotParam graffiti_goal
        if GotParam goal_success_script
            <announce_unlocked> = 1
        endif
        goal_got_graffiti cash_reward = <cash_reward> zone = <zone> announce_unlocked = <announce_unlocked>
    endif
    if GoalManager_GoalExists name = <goal_id>
        if GoalManager_GetGoalRewardPoints name = <goal_id>
            SpawnScriptLater points_total params = { points = <reward_points> }
        endif
    endif
endscript

script goal_got_abilities index = 0
    wait 2 gameframes
    if (<index> = 0)
        kill_start_key_binding
        wait 60 gameframes
        PauseSkaters
        GoalManager_HidePedFloaters
        restore_start_key_binding
    else
        Debounce Circle time = 0.3000
        dialog_box_exit
    endif
    GetArraySize got_abilities
    if (<index> = <array_size>)
        GoalManager_UnHidePedFloaters
        UnpauseSkaters
    else
        FormatText textname = Title '%s: %a' s = str_g_u_56 a = (<got_abilities> [ <index> ].ability)
        goal_got_abilities_box_create {
            Title = <Title>
            Body = (<got_abilities> [ <index> ].control)
            next_index = (<index> + 1)
            got_abilities = <got_abilities>
        }
    endif
endscript

script goal_got_abilities_box_create 
    <button_text> = [str_g_u_107 str_g_u_108 str_g_u_109 str_g_u_110 str_g_u_111 str_g_u_112 str_g_u_113 str_g_u_114 str_g_u_115 str_g_u_116]
    GetArraySize button_text
    getrandomvalue name = button_text_index a = 0 b = (<array_size> - 1)integer
    create_snazzy_dialog_box {
        Title = <Title>
        text = <Body>
        text_dims = (400.0, 0.0)
        no_bg
        buttons = [
            {
                text = (<button_text> [ <button_text_index> ])
                pad_choose_script = goal_got_abilities
                pad_choose_params = {
                    index = <next_index>
                    got_abilities = <got_abilities>
                }
            }
        ]
    }
endscript

script goal_got_pro 
    if GotParam \{ dont_wait }
        <frames> = 2
    else
        <frames> = 60
    endif
    kill_start_key_binding
    wait <frames> gameframes
    PauseSkaters
    GoalManager_HidePedFloaters
    restore_start_key_binding
    goal_got_pro_box_create {
        pro = <pro>
        special_trick_name = <special_trick_name>
        special_trick_text = <special_trick_text>
        special_trick_buttons = <special_trick_buttons>
        special_trick_key_combo = <special_trick_key_combo>
        next_script = <next_script>
        next_params = <next_params>
    }
endscript

script goal_got_pro_box_create 
    <button_text> = [str_g_u_107 str_g_u_108 str_g_u_109 str_g_u_110 str_g_u_111 str_g_u_112 str_g_u_113 str_g_u_114 str_g_u_115 str_g_u_116]
    GetArraySize button_text
    getrandomvalue name = button_text_index a = 0 b = (<array_size> - 1)integer
    if GotParam pro
        FormatText textname = Title '%s: %p' s = str_g_u_57 p = <pro>
    else
        <Title> = str_g_u_58
    endif
    if GotParam special_trick_name
        if GotParam pro
            FormatText textname = Body '%p %j %u\n%r: %t\n\n%b\n\n' p = <pro> j = str_g_u_59 u = str_g_u_60 r = str_g_u_61 t = <special_trick_text> b = <special_trick_buttons>
        else
            FormatText textname = Body '%r: %t\n\n%b\n\n' r = str_g_u_61 t = <special_trick_text> b = <special_trick_buttons>
        endif
        if NOT ChecksumEquals a = <special_trick_name> b = Trick_The900
            AwardNewSpecialTrickToProfile {
                profile = custom_story
                Trick = <special_trick_name>
                key_combo = <special_trick_key_combo>
            }
        endif
    else
        FormatText textname = Body '%p %j  %u' p = <pro> j = str_g_u_59 u = str_g_u_60
    endif
    create_snazzy_dialog_box {
        Title = <Title>
        text = <Body>
        text_dims = (400.0, 0.0)
        no_bg
        buttons = [
            {
                text = (<button_text> [ <button_text_index> ])
                pad_choose_script = goal_got_pro_box_exit
                pad_choose_params = {
                    next_script = <next_script>
                    next_params = <next_params>
                }
            }
        ]
    }
endscript

script goal_got_pro_box_exit 
    Debounce \{ Circle time = 0.3000 }
    dialog_box_exit
    GoalManager_UnHidePedFloaters
    UnpauseSkaters
    if GotParam \{ next_script }
        <next_script> <next_params> dont_wait
    endif
endscript

script points_total 
    wait \{ 0.7500 seconds }
    FormatText textname = message '+%p POINTS' p = <points>
    create_panel_message {
        id = points_message
        text = <message>
        style = goal_points_animation
    }
    SpawnScriptLater \{ SK6_SFX_ShowPointsFromGoal }
    update_goal_points_display \{ refresh }
endscript

script goal_points_animation 
    setprops rgba = [ 128 109 9 128 ]
    DoMorph time = 0 Pos = (320.0, 85.0) Scale = 5 alpha = 0
    DoMorph time = 0.1000 Scale = 1.800 alpha = 1 rot_angle = 0
    DoMorph time = 0.06000 Pos = (322.0, 88.0) rot_angle = 3
    DoMorph time = 0.06000 Pos = (318.0, 82.0) rot_angle = -2
    DoMorph time = 0.06000 Pos = (322.0, 88.0) rot_angle = 4
    DoMorph time = 0.05000 Pos = (318.0, 82.0) rot_angle = -3
    DoMorph time = 0.05000 Pos = (322.0, 88.0) rot_angle = 2
    DoMorph time = 0.05000 Pos = (318.0, 82.0) rot_angle = 0
    wait 0.2000 second
    DoMorph time = 0.5000 Pos = (320.0, 30.0) alpha = 0
    Die
endscript

script goal_fail_messages 
    if NOT GameModeEquals is_coop
        style1 = panel_message_goalfail
        styel2 = panel_message_goalfailline2
        style3 = panel_sprite_goalfail
    else
        MangleChecksums a = 0 b = 0
        if (<skater_id> = <mangled_id>)
            style1 = panel_message_goalfail_0
            styel2 = panel_message_goalfailline2_0
            style3 = panel_sprite_goalfail_0
        else
            style1 = panel_message_goalfail_1
            styel2 = panel_message_goalfailline2_1
            style3 = panel_sprite_goalfail_1
        endif
    endif
    if GotParam wait_for_success_scene_end
        Block untilevent = goal_cam_anim_done
    endif
    goal_panel_wait_for_my_turn
    if NOT GoalManager_GoalExists name = <goal_id>
        return 
    endif
    playsound GoalFail vol = 200
    GoalManager_GetGoalParams name = <goal_id>
    create_panel_sprite id = goalfail_sprite texture = go_fail style = <style3>
    if GameModeEquals is_career
    else
        if GotParam view_goals_text
            create_panel_block dims = (640.0, 0.0) id = GoalFail text = <view_goals_text> style = <style1>
        else
            create_panel_block dims = (640.0, 0.0) id = GoalFail text = <goal_text> style = <style1>
        endif
    endif
    create_panel_message id = goalfailedline2 text = str_g_u_62 style = <style2>
    if ((IsXbox)|| (isPC))
        FormatText textname = retry '%p \b8 %r' p = str_g_u_63 r = str_g_u_65
        retry_text = <retry>
    else
        FormatText textname = retry '%p (\b8) %r' p = str_g_u_64 r = str_g_u_65
        retry_text = <retry>
    endif
endscript

script goal_lose_next_frame 
    wait \{ 1 frame }
    if GoalManager_GoalIsActive name = <goal_id>
        GoalManager_LoseGoal name = <goal_id>
    endif
endscript

script goal_fail 
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam safe_restart_node
        RemoveParameter restart_node
        <restart_node> = <safe_restart_node>
        goal_initialize_skater <...> 
    endif
    if GotParam goal_pre_fail_script
        <goal_pre_fail_script> <goal_pre_fail_params>
    endif
    if GotParam pak_info
        if StructureContains structure = <pak_info> fail
            SpawnScriptLater goal_load_pak params = {prefix = (<pak_info>.prefix)suffix = 'fail'}
            <wait_pak_load> = 1
        endif
    endif
    if NOT InMultiPlayerGame
        if GotParam fail_scene
            SpawnScriptLater goal_cam_anim_play params = {
                goal_id = <goal_id>
                gonna_show_message
                use_igc = use_igc
                just_won_goal = 0
                wait_pak_load = <wait_pak_load>
            }
            <wait_for_success_scene_end> = 1
        endif
    endif
    if NOT GotParam no_fail_messages
        SpawnScriptLater goal_fail_messages params = { <...>  }
    endif
    if GotParam goal_fail_script
        <goal_fail_script> <goal_fail_params> <goal_fail_script_params>
    endif
    if GotParam cash_goal
        SpawnScriptLater cash_goals_add_next_goal params = {zone = <zone> fail goal_id = <goal_id>}
    else
        if NOT GotParam classic_mode_goal
            spawnscriptnow goal_post_fail_ped_reset params = { <...>  }
            spawnscriptnow goal_post_fail_skater_reset params = { <...>  }
        endif
    endif
endscript

script goal_post_fail_ped_reset 
    if NOT GotParam trigger_obj_id
        return 
    endif
    if NOT IsInNodeArray <trigger_obj_id>
        return 
    endif
    if GotParam fail_scene
        Block untilevent = goal_cam_anim_done
    endif
    goal_get_root_parent goal_id = <goal_id>
    if GotParam parent_id
        if GotParam ped_floater_id
            goal_kill_ped_floater ped_floater_id = <ped_floater_id> ped_floater_element = <ped_floater_element> goal_id = <goal_id>
        endif
        if IsCreated <trigger_obj_id>
            GoalManager_StopLastStream name = <goal_id>
            GoalManager_UnloadLastFam name = <goal_id>
            Kill name = <trigger_obj_id>
        endif
        if GotParam fail_scene
            if GoalManager_GoalExists name = <parent_id>
                RemoveParameter ped_floater_id
                RemoveParameter ped_floater_element
                RemoveParameter ped_floter
                GoalManager_GetGoalParams name = <parent_id>
                if GotParam ped_floater_id
                    goal_kill_ped_floater ped_floater_id = <ped_floater_id> ped_floater_element = <ped_floater_element> goal_id = <parent_id>
                endif
                GoalManager_InitGoalTrigger name = <parent_id>
                if GotParam ped_floater
                    goal_create_ped_floater parent_id = <trigger_obj_id> goal_id = <parent_id> <ped_floater>
                endif
            endif
        endif
    else
        GoalManager_InitGoalTrigger name = <goal_id>
        if GotParam trigger_obj_fail_node
            <ped_move_to_node> = <trigger_obj_fail_node>
        else
            <ped_move_to_node> = <trigger_obj_id>
        endif
        <trigger_obj_id> ::obj_movetonode name = <ped_move_to_node> orient
        if GotParam ped_floater
            goal_create_ped_floater parent_id = <trigger_obj_id> goal_id = <goal_id> <ped_floater>
        endif
    endif
endscript

script goal_get_root_parent 
    if GoalManager_GoalHasParent name = <goal_id>
        begin 
        if NOT GoalManager_GoalHasParent name = <parent_id>
            break 
        endif
        repeat 
    endif
    return parent_id = <parent_id>
endscript

script goal_post_fail_skater_reset 
    if GotParam \{ fail_scene }
        Block \{ untilevent = goal_cam_anim_done }
    endif
    if GotParam \{ fail_restart_node }
        RemoveParameter \{ restart_node }
        <restart_node> = <fail_restart_node>
        goal_initialize_skater <...> orient
    endif
    skater ::UnPausePhysics
endscript

script goal_uninit 
    if GoalManager_GoalInitialized name = <goal_id>
        GoalManager_GetGoalParams name = <goal_id>
        goal_kill_proset_geom <...> 
        <trigger_exists> = 0
        if GotParam trigger_obj_id
            if IsInNodeArray <trigger_obj_id>
                <trigger_exists> = 1
            endif
        endif
        if NOT GotParam testing_goal
            if NOT GotParam dont_kill_trigger_on_success
                if GotParam ped_floater_id
                    goal_kill_ped_floater ped_floater_id = <ped_floater_id> ped_floater_element = <ped_floater_element> goal_id = <goal_id>
                endif
                if (<trigger_exists> = 1)
                    if IsCreated <trigger_obj_id>
                        GoalManager_StopLastStream name = <goal_id>
                        GoalManager_UnloadLastFam name = <goal_id>
                        Kill name = <trigger_obj_id>
                    endif
                endif
            endif
        endif
        if GotParam init_geo_prefix
            Kill prefix = <init_geo_prefix>
        else
            if GotParam init_geo_prefixes
                GetArraySize init_geo_prefixes
                <index> = 0
                begin 
                Kill prefix = (<init_geo_prefixes> [ <index> ])
                <index> = (<index> + 1)
                repeat <array_size>
            endif
        endif
    endif
endscript

script goal_kill_bail_bike 
    wait \{ 15 gameframes }
    skater ::kill_bail_bike
endscript

script goal_deactivate 
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam flatland_mode
        GoalManager_disable_flatland_mode goal_id = <goal_id>
    endif
    skater_exists = 1
    if InNetGame
        if IsObserving
            <skater_exists> = 0
        endif
    endif
    if (<skater_exists> = 1)
        if skater ::IsSkaterOnBike
            SpawnScriptLater goal_kill_bail_bike
        endif
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            if IsCreated <trigger_obj_id>
                <trigger_exists> = 1
            endif
        endif
    endif
    if GameModeEquals is_goal_attack
        KillSpawnedScript name = goal_cam_anim_play
        KillSpawnedScript name = goal_cam_anim_play_single_element
        KillSpawnedScript name = TemporarilyDisableInput
        KillSkaterCamAnim all
        restore_skater_camera
        speech_box_exit anchor_id = goal_description_anchor no_pad_start
        if NOT IsObserving
            skater ::netenableplayerinput
        endif
        SetButtonEventMappings unblock_menu_input
        restore_start_key_binding
        if NOT IsObserving
            if NOT GoalManager_CanStartGoal
                MakeSkaterGoto ongroundai
            endif
        endif
        GoalManager_SetCanStartGoal 1
    endif
    if GotParam float_tips
        goal_destroy_float_tips float_tips = <float_tips>
    endif
    KillTextureSplats all
    PreAllocSplats
    KillSpawnedScript name = goal_show_tips
    KillSpawnedScript name = goal_wait_and_show_key_combo_text
    goal_destroy_counter
    if GoalManager_EndRunCalled name = <goal_id>
        if GoalManager_StartedEndOfRun name = <goal_id>
            SpawnSkaterScript goal_init_after_end_of_run params = { goal_id = <goal_id> }
        else
            GoalManager_ClearEndRun name = <goal_id>
        endif
    endif
    GoalManager_StopLastStream name = <goal_id>
    GoalManager_UnloadLastFam name = <goal_id>
    if GotParam quick_start
        GoalManager_EditGoal name = <goal_id> params = { last_start_was_quick_start = 1 }
    else
        GoalManager_EditGoal name = <goal_id> params = { last_start_was_quick_start = 0 }
    endif
    if GotParam goal_intro_script
        KillSpawnedScript name = goal_intro_script
    endif
    if GotParam goal_deactivate_script
        if GotParam silent_deactivation
            printf 'Goal Manager Silently Deactivating: %s' s = <goal_id>
            <goal_deactivate_script> <goal_deactivate_params> <goal_deactivate_script_params>
        else
            spawnscriptnow {
                goal_wait_deactivate_script
                params = {
                    goal_deactivate_script = <goal_deactivate_script>
                    goal_deactivate_params = <goal_deactivate_params>
                    success_scene = <success_scene>
                    fail_scene = <fail_scene>
                    quit_goal = <quit_goal>
                    goal_id = <goal_id>
                    goal_deactivate_script_params = <goal_deactivate_script_params>
                }
            }
        endif
    endif
    KillSpawnedScript name = goal_description_and_speech
    KillSpawnedScript name = goal_wait_for_cam_anim
    if ScreenElementExists id = current_goal
        DestroyScreenElement id = current_goal
    endif
    if ScreenElementExists id = current_goal_key_combo_text
        DestroyScreenElement id = current_goal_key_combo_text
    endif
    if ScreenElementExists id = current_goal_description
        DestroyScreenElement id = current_goal_description
    endif
    if NOT GotParam quick_start
        if (<trigger_exists> = 1)
            if NOT GotParam just_won_goal
                goal_pro_stop_anim_scripts <...> 
                if GotParam trigger_wait_script
                    <trigger_obj_id> ::obj_spawnscriptlater <trigger_wait_script> params = {goal_id = <goal_id> pro = <pro>}
                else
                    <trigger_obj_id> ::obj_spawnscriptlater GenericProWaiting params = {goal_id = <goal_id> type = 'wait' pro = <pro>}
                endif
            endif
        endif
    endif
    if GotParam control_type
        if NOT ((<control_type> = skate)|| (<control_type> = walk)|| (<control_type> = bike))
            if GotParam exit_node
                ResetSkaters node_name = <exit_node>
            else
                ResetSkaters node_name = <restart_node>
            endif
            MakeSkaterGoto HandBrake
            if GameIsPaused
                skater ::Pause
            endif
            if GotParam edited_goal
                GetLevelPrefix
                FormatText checksumname = ReadyLevelScript '%l_CreateVehicles' l = <level_prefix>
                if ScriptExists <ReadyLevelScript>
                    <ReadyLevelScript>
                endif
            endif
        endif
    endif
    if GotParam geo_prefix
        goal_kill_geo_prefix geo_prefix = <geo_prefix>
    else
        if GotParam geo_prefixes
            GetArraySize geo_prefixes
            <index> = 0
            begin 
            goal_kill_geo_prefix geo_prefix = (<geo_prefixes> [ <index> ])
            <index> = (<index> + 1)
            repeat <array_size>
        endif
    endif
    if GotParam trigger_prefix
        Kill prefix = <trigger_prefix>
    endif
    if NOT GotParam quick_start
        if (<trigger_exists> = 1)
            <trigger_obj_id> ::obj_visible
        endif
        GoalManager_ShowGoalPoints
        if NOT IsTrue ALWAYSPLAYMUSIC
            if NOT GoalManager_HasWonGoal name = <goal_id>
                PauseMusic 1
            endif
        endif
    endif
    if (<trigger_exists> = 1)
        if NOT GotParam just_won_goal
            if NOT GotParam quick_start
                if NOT GoalManager_HasWonGoal name = <goal_id>
                    goal_add_ped_arrow goal_id = <goal_id>
                endif
            endif
        endif
    endif
    if GoalManager_HasWonGoal name = <goal_id>
        if NOT GotParam quick_start
            if GotParam just_won_goal
            else
                GoalManager_UninitializeGoal name = <goal_id>
            endif
        endif
    endif
    if NOT GotParam silent_deactivation
        if GotParam safe_restart_node
            RemoveParameter restart_node
            <restart_node> = <safe_restart_node>
            goal_initialize_skater <...> 
        endif
    endif
    if GotParam pak_info
        <unload> = 1
        if ((GotParam just_won_goal)& (StructureContains structure = <pak_info> success))
            <unload> = 0
        endif
        if ((GotParam just_failed)& (StructureContains structure = <pak_info> fail))
            <unload> = 0
        endif
        if ((GotParam just_expired)& (StructureContains structure = <pak_info> fail))
            <unload> = 0
        endif
        if (<unload> = 1)
            printf 'goal_deactivate - CALLING UNLOAD PAK'
            spawnscriptnow goal_unload_pak
        endif
    endif
    if GameModeEquals is_career
        MakeSkaterGoto SkaterInit
    endif
endscript

script goal_wait_deactivate_script 
    GoalManager_GetGoalParams name = <goal_id>
    <wait_scene_end> = 1
    if GotParam quit_goal
        if (<quit_goal> = 1)
            <wait_scene_end> = 0
        endif
    endif
    if GotParam quick_start
        <wait_scene_end> = 0
    endif
    if (<wait_scene_end> = 1)
        <wait_scene_end> = 0
        if ((GotParam fail_scene)& (GotParam just_failed))
            <wait_scene_end> = 1
        endif
        if GotParam success_scene
            if NOT GotParam just_failed
                <wait_scene_end> = 1
            endif
        endif
        if (<wait_scene_end> = 1)
            Block untilevent = goal_cam_anim_done
        endif
    endif
    <goal_deactivate_script> <goal_deactivate_params> <goal_deactivate_script_params>
endscript

script goal_destroy_float_tips 
    GetArraySize \{ float_tips }
    <index> = 0
    begin 
    FormatText checksumname = id 'float_tip%a' a = <index>
    if ScreenElementExists id = <id>
        DestroyScreenElement id = <id>
    endif
    <index> = (<index> + 1)
    repeat <array_size>
endscript

script goal_retry_select_handler 
    if (goal_bind_retry_to_select = 1)
        if GoalManager_CanStartGoal
            RetryCurrentGoal
        endif
    endif
endscript

script RetryCurrentGoal 
    if GoalManager_CanRetryGoal
        KillSkaterCamAnim \{ current }
        if GetCurrentZoneName
            if (<zone_name> = 'z_bh')
                z_bh_killallcams
            endif
        endif
        GoalManager_RestartCurrentGoal
    endif
endscript

script goal_quit_current_goal 
    wait \{ 1 gameframe }
    if ScreenElementExists \{ id = goal_message }
        RunScriptOnScreenElement \{ id = goal_message kill_panel_message }
    endif
    if GoalManager_GoalIsActive name = (goal_utility_last_goal_activated)
        GoalManager_EditGoal name = (goal_utility_last_goal_activated)params = { quit_goal = 1 }
        GoalManager_UninitializeGoal name = (goal_utility_last_goal_activated)
        wait \{ 2 gameframes }
        GoalManager_EditGoal name = (goal_utility_last_goal_activated)params = { quit_goal = 0 }
        GoalManager_Initializeallgoals
    endif
endscript

script goal_beat_current_goal 
    wait \{ 1 gameframe }
    if ScreenElementExists \{ id = goal_message }
        RunScriptOnScreenElement \{ id = goal_message kill_panel_message }
    endif
    if GoalManager_GoalIsActive name = (goal_utility_last_goal_activated)
        GoalManager_WinGoal name = (goal_utility_last_goal_activated)
    endif
endscript

script end_current_goal_run 
    wait \{ 1 gameframe }
    if ScreenElementExists \{ id = goal_message }
        RunScriptOnScreenElement \{ id = goal_message kill_panel_message }
    endif
    if GoalManager_HasActiveGoals
        GoalManager_DeactivateAllGoals \{ force_all }
    endif
endscript

script ready_skater_for_early_end_current_goal 
    if InNetGame
        if GotParam \{ net }
            return 
        endif
    endif
    if InSplitScreenGame
        return 
    endif
    if IsObserving
        return 
    endif
    if GameModeEquals \{ is_classic }
        return 
    endif
    if NOT IsCreated \{ skater }
        return 
    endif
    if skater ::IsInEndOfRun
        ResetSkaters node_name = <restart_node>
    endif
endscript
goal_cam_anim_offsets = [
    { targetOffset = (0.0, 46.79999923706055, 0.0) positionOffset = (9.600000381469727, 10.800000190734863, 75.5999984741211) }
    { targetOffset = (1.2000000476837158, 62.400001525878906, 0.0) positionOffset = (-2.4000000953674316, 0.0, 26.399999618530273) }
    { targetOffset = (3.5999999046325684, 57.599998474121094, 0.0) positionOffset = (-7.199999809265137, -31.200000762939453, 70.80000305175781) }
    { targetOffset = (8.399999618530273, 49.20000076293945, 1.2000000476837158) positionOffset = (-8.399999618530273, 30.0, 63.599998474121094) }
    { targetOffset = (-24.0, 58.79999923706055, 13.199999809265137) positionOffset = (51.599998474121094, -2.4000000953674316, 91.19999694824219) }
    { targetOffset = (30.0, 58.79999923706055, 20.399999618530273) positionOffset = (-56.400001525878906, -2.4000000953674316, 85.19999694824219) }
    { targetOffset = (30.0, 58.79999923706055, 20.399999618530273) positionOffset = (-56.400001525878906, -2.4000000953674316, 85.19999694824219) }
    { targetOffset = (-20.399999618530273, 43.20000076293945, 32.400001525878906) positionOffset = (100.80000305175781, 6.0, 63.599998474121094) }
    { targetOffset = (30.0, -14.399999618530273, 2.4000000953674316) positionOffset = (-36.0, 148.8000030517578, 446.3999938964844) }
    { targetOffset = (12.0, -25.200000762939453, -9.600000381469727) positionOffset = (312.0, 159.60000610351562, 366.0) }
    { targetOffset = (7.199999809265137, 4.800000190734863, 21.600000381469727) positionOffset = (-420.0, 128.39999389648438, 129.60000610351562) }
]

script goal_cam_anim_play 
    if GotParam wait_pak_load
        Block untilevent = goal_load_pak_done
    endif
    GoalManager_GetGoalParams name = <goal_id>
    goal_cam_anim_pre_cleanup <...> 
    if GotParam just_won_goal
        if (<just_won_goal> = 0)
            if GotParam use_igc
                <scene> = <fail_scene>
                <dont_hide_skater> = dont_hide_skater
                <next_trigger_script> = GenericProWaiting
                <type> = 'wait'
            endif
        else
            if GotParam success_cam_anim
                <anim> = <success_cam_anim>
            else
                if GotParam success_cam_anims
                    <anims> = <success_cam_anims>
                else
                    <virtual_cam> = virtual_cam
                endif
            endif
            if GotParam use_igc
                <scene> = <success_scene>
                <dont_hide_skater> = dont_hide_skater
            endif
        endif
        goal_cam_anim_pre_success <...> 
    else
        if GotParam start_cam_anim
            <anim> = <start_cam_anim>
        else
            if GotParam start_cam_anims
                <anims> = <start_cam_anims>
            else
                <virtual_cam> = virtual_cam
            endif
        endif
        goal_cam_anim_pre_start <...> 
        if GotParam use_igc
            <scene> = <intro_scene>
        endif
    endif
    hide_speech_boxes
    GetSkaterId
    <skaterid> = <ObjID>
    if NOT GotParam no_cam_anim
        if GotParam use_igc
            PlayIGCScene {
                <scene>
                goal_id = <goal_id>
            }
            if GotParam dont_show_goal_text
                <dont_show_goal_text> = dont_show_goal_text
            endif
            if NOT GotParam just_won_goal
                goal_create_tips_text_keys {
                    goal_id = <goal_id>
                    goal_text = <goal_text>
                    key_combo_text = <key_combo_text>
                    <dont_show_goal_text>
                }
            endif
        else
            if GotParam anims
                GetArraySize anims
                <index> = 0
                begin 
                if (<index> = (<array_size> - 1))
                    <last_anim> = 1
                else
                    <last_anim> = 0
                endif
                goal_cam_anim_play_single_element {(<anims> [ <index> ])
                    goal_id = <goal_id>
                    anim_index = <index>
                    last_anim = <last_anim>
                    just_won_goal = <just_won_goal>
                    cam_anim_index = <index>
                }
                <index> = (<index> + 1)
                repeat <array_size>
            else
                goal_cam_anim_play_single_element <...> last_anim = 1 cam_anim_index = 0
            endif
        endif
    endif
    goal_cam_anim_post_cleanup <...> 
    if GotParam just_won_goal
        if (<just_won_goal> = 1)
            goal_cam_anim_post_success <...> 
        else
            goal_cam_anim_post_fail <...> 
        endif
    else
        goal_cam_anim_post_start <...> 
    endif
endscript

script goal_create_tips_text_keys 
    SpawnScriptLater goal_show_tips params = { goal_id = <goal_id> }
    if NOT GotParam \{ dont_show_goal_text }
        create_panel_block id = current_goal text = <goal_text> style = panel_message_goal parent = root_window font_face = dialog
        if GotParam \{ key_combo_text }
            SpawnScriptLater goal_wait_and_show_key_combo_text params = { text = <key_combo_text> }
        endif
    endif
endscript

script goal_cam_anim_pre_cleanup 
    GoalManager_PauseAllGoals
    if GotParam TrickBeat
        PauseMusic 1
    endif
    if GotParam edited_goal
        skater ::PausePhysics
    endif
    change check_for_unplugged_controllers = 0
    skater ::StatsManager_Deactivate
    if InNetGame
        skater ::netdisableplayerinput
    else
        skater ::disableplayerinput
    endif
    GoalManager_SetCanStartGoal 0
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            <trigger_exists> = 1
        endif
    endif
    if (<trigger_exists> = 1)
        if GotParam trigger_obj_id
            if IsCreated <trigger_obj_id>
                TerminateObjectsScripts id = <trigger_obj_id> script_name = GenericPro_LookAtSkater use_proper_version
                TerminateObjectsScripts id = <trigger_obj_id> script_name = GenericProWaiting use_proper_version
                <trigger_obj_id> ::obj_stoprotating
                if NOT GotParam use_igc
                    <trigger_obj_id> ::Obj_LookAtObject type = skater anglethreshold = 15 Speed = 500 time = 0
                endif
            endif
        endif
    endif
    pause_trick_text
    if ScreenElementExists id = the_time
        SetScreenElementProps {
            id = the_time
            hide
        }
    endif
    if GotParam letterbox
        change last_screen_mode = (current_screen_mode)
        if NOT (current_screen_mode = letterbox_screen_mode)
            screen_setup_letterbox
        endif
    endif
    SetButtonEventMappings block_menu_input
    GetSkaterId
    if InNetGame
        <ObjID> ::netdisableplayerinput
    else
        <ObjID> ::disableplayerinput
    endif
    kill_start_key_binding
    SpawnScriptLater TemporarilyDisableInput
    return volume = <volume>
endscript

script goal_cam_anim_post_cleanup 
    change check_for_unplugged_controllers = 1
    restore_start_key_binding
    if GotParam edited_goal
        skater ::UnPausePhysics
    endif
    if InNetGame
        skater ::netenableplayerinput
    else
        skater ::enableplayerinput
    endif
    if NOT GotParam dont_unpause
        GoalManager_UnPauseAllGoals
    endif
    GoalManager_SetCanStartGoal
    skater ::StatsManager_Activate
    if NOT GotParam TrickBeat
        PauseMusic 0
    endif
    speech_box_exit
    if NOT skater ::driving
        UnpauseSkaters
    endif
    unpause_trick_text
    if ScreenElementExists id = the_time
        SetScreenElementProps {
            id = the_time
            unhide
        }
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            <trigger_exists> = 1
        endif
    endif
    if (<trigger_exists> = 1)
        if GotParam trigger_obj_id
            if IsCreated <trigger_obj_id>
                if NOT InNetGame
                    RunScriptOnObject {
                        id = <trigger_obj_id>
                        goal_trigger_reset_avoid_radius_exception
                        params = { goal_id = <goal_id> }
                    }
                endif
                GoalManager_StopLastStream name = <goal_id>
                GoalManager_UnloadLastFam name = <goal_id>
            endif
        endif
        if GotParam next_trigger_script
            goal_pro_stop_anim_scripts <...> 
            if IsCreated <trigger_obj_id>
                <trigger_obj_id> ::obj_spawnscriptlater <next_trigger_script> params = {type = <type> goal_id = <goal_id> pro = <pro>}
            endif
        endif
    endif
    restore_start_key_binding
    FireEvent broadcast type = goal_cam_anim_done
    unhide_speech_boxes
    if GotParam letterbox
        if NOT (last_screen_mode = current_screen_mode)
            switch (last_screen_mode)
                case standard_screen_mode
                screen_setup_standard
                case widescreen_screen_mode
                screen_setup_widescreen
                case letterbox_screen_mode
                screen_setup_letterbox
            endswitch
        endif
    endif
    if GotParam show_movie
        if (<show_movie> = 1)
            if GotParam movie_file
                ingame_play_movie <movie_file>
            endif
        endif
    endif
endscript

script goal_cam_anim_pre_success 
    if NOT InMultiPlayerGame
        SetButtonEventMappings block_menu_input
        GetSkaterId
        <ObjID> ::disableplayerinput
        SetScreenElementProps {
            id = root_window
            event_handlers = [{ pad_start NullScript }]
            replace_handlers
        }
        SpawnScriptLater TemporarilyDisableInput
        PauseSkaters
    endif
    skater ::obj_setflag FLAG_SKATER_INGOALINIT
    if GotParam success_node
        ResetSkaters node_name = <success_node>
    endif
    PauseSkaters
    if NOT GotParam dont_hide_skater
        skater ::RemoveSkaterFromWorld
    endif
    if GotParam success_movie_wait_frames
        wait <success_movie_wait_frames> gameframe
    endif
    root_window ::settags giving_rewards = 1
endscript

script goal_cam_anim_post_success 
    skater ::obj_clearflag FLAG_SKATER_INGOALINIT
    if NOT GotParam dont_hide_skater
        skater ::AddSkaterToWorld
    endif
    KillSpawnedScript name = TemporarilyDisableInput
    SetButtonEventMappings unblock_menu_input
    skater ::enableplayerinput
    root_window ::settags giving_rewards = 0
    if NOT GoalManager_GoalExists name = <goal_id>
        return 
    endif
    goal_uninit goal_id = <goal_id> <...> 
    if GotParam success_restart_node
        RemoveParameter restart_node
        <restart_node> = <success_restart_node>
        goal_initialize_skater <...> 
    endif
    if GotParam goal_success_script
        <goal_success_script> <goal_success_params>
    endif
    GoalManager_GetNumberOfGoalPoints total
    if (<goal_points> = 129)
        if NOT GetGlobalFlag flag = GOT_ALL_GOALS
        endif
    endif
    if GotParam create_a_trick
        goal_cat_create_menu goal_id = <goal_id>
    endif
    SpawnScriptLater goal_unload_pak params = { fire_finished_success_sequence }
endscript

script goal_cutscene_exit 
    FireEvent \{ broadcast type = goal_cutscene_done }
endscript

script goal_cam_anim_post_fail 
    skater ::obj_clearflag \{ FLAG_SKATER_INGOALINIT }
    if NOT GotParam \{ dont_hide_skater }
        skater ::AddSkaterToWorld
    endif
    KillSpawnedScript \{ name = TemporarilyDisableInput }
    SetButtonEventMappings \{ unblock_menu_input }
    skater ::enableplayerinput
    root_window ::settags \{ giving_rewards = 0 }
    if NOT GoalManager_GoalExists name = <goal_id>
        return 
    endif
    SpawnScriptLater \{ goal_unload_pak }
endscript

script show_all_goals_done_dlg 
    wait \{ 2 seconds }
    pausegame
    SetGlobalFlag \{ flag = GOT_ALL_GOALS }
    goal_got_all_goals
    Block \{ untilevent = goal_got_all_goals_done }
    UnPauseGame
    KillSpawnedScript \{ name = show_all_goals_done_dlg }
endscript

script goal_cam_anim_pre_start 
    if GotParam \{ use_igc }
        <use_igc> = use_igc
    endif
    MakeSkaterGoto Skater_GoalInit params = { use_igc = <use_igc> }
    KillSpawnedScript \{ name = goal_description_and_speech }
    KillSpawnedScript \{ name = goal_description_and_speech2 }
endscript

script goal_cam_anim_post_start 
    if NOT GoalManager_GoalIsActive name = <goal_id>
        FireEvent broadcast type = goal_cam_anim_post_start_done
        return 
    endif
    if GotParam use_hud_counter
        goal_create_counter goal_id = <goal_id> hud_counter_caption = <hud_counter_caption>
    endif
    if GotParam dont_move_skater_on_start
        <no_reset> = 1
    endif
    goal_initialize_skater <...> 
    if GotParam goal_start_script
        <goal_start_script> <goal_start_params> <goal_start_script_params>
    endif
    if GotParam hide_goal_pro
        <trigger_obj_id> ::obj_invisible
    endif
    Debounce x time = 0.3000
    FireEvent broadcast type = goal_cam_anim_post_start_done
    broadcastevent type = goal_cam_anim_post_start_done
endscript

script goal_cam_anim_play_single_element 
    GoalManager_GetGoalParams name = <goal_id>
    KillSpawnedScript name = TemporarilyDisableInput
    SpawnScriptLater TemporarilyDisableInput params = { time = 1000 }
    GetSkaterId
    <skaterid> = <ObjID>
    if GotParam pre_anim_script
        <pre_anim_script> <pre_anim_script_params>
    endif
    if GotParam skater_node
        ResetSkaters node_name = <skater_node>
        MakeSkaterGoto Skater_GoalInit
    endif
    if GotParam walk_into_frame
        if NOT GotParam walk_into_frame_distance
            <walk_into_frame_distance> = 120
        endif
        MakeSkaterGoto Skater_GoalInit params = {walk walk_distance = <walk_into_frame_distance>}
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            if IsCreated <trigger_obj_id>
                <trigger_exists> = 1
            endif
        endif
    endif
    if (<trigger_exists> = 1)
        if GotParam ped_node
            if GotParam trigger_obj_id
                <trigger_obj_id> ::obj_movetonode name = <ped_node> orient
            endif
        endif
        if GotParam trigger_obj_id
            <trigger_obj_id> ::obj_stoprotating
            <trigger_obj_id> ::Obj_LookAtObject type = skater anglethreshold = 15 Speed = 50600 time = 0
        endif
        if GotParam ped_script
            if GotParam trigger_obj_id
                goal_pro_stop_anim_scripts <...> 
                <trigger_obj_id> ::obj_spawnscriptlater <ped_script> params = { goal_id = <goal_id> }
            endif
        endif
    endif
    if NOT GotParam no_play_hold
        <Play_hold> = Play_hold
    endif
    if NOT GotParam skippable
        <skippable> = 1
    endif
    if (<last_anim> = 1)
        if NOT GotParam just_won_goal
            <skippable> = 0
        endif
        <Play_hold> = Play_hold
    endif
    if GotParam virtual_cam
        <anim> = <goal_id>
        <virtual_cam> = virtual_cam
        if (<trigger_exists> = 1)
            if NOT GotParam TargetID
                <trigger_obj_id> ::obj_getid
                <TargetID> = <ObjID>
            endif
        endif
        if NOT ((GotParam targetOffset)& (GotParam positionOffset))
            if GotParam use_view_goals_cameras_for_intro
                RemoveParameter skaterid
                TargetID = world
                element = (<view_goals_cameras> [ 0 ])
            else
                GetRandomArrayElement goal_cam_anim_offsets
            endif
            <targetOffset> = (<element>.targetOffset)
            <positionOffset> = (<element>.positionOffset)
        endif
        if NOT GotParam frames
            <frames> = 120
        endif
    else
        if NOT GotParam anim
            printstruct <...> 
            script_assert 'No anim specified and no virtual_cam flag present'
        endif
    endif
    DisplayLoadingScreen freeze
    PlaySkaterCamAnim {name = <anim>
        skaterid = <skaterid>
        TargetID = <TargetID>
        targetOffset = <targetOffset>
        positionOffset = <positionOffset>
        frames = <frames>
        <Play_hold>
        skippable = <skippable>
        <virtual_cam>
    }
    Debounce x time = 0.3000
    if GotParam null_goal
        if (<last_anim> = 1)
            <cam_anim_index> = -2
        endif
        <last_anim> = 0
        <skippable> = 1
    endif
    if ((GotParam edited_goal)& (GotParam just_won_goal))
        <last_anim> = 0
        <skippable> = 1
    endif
    <should_use_cam_anim_text> = 1
    if (<last_anim> = 1)
        if NOT GotParam just_won_goal
            <should_use_cam_anim_text> = 0
        endif
    endif
    if (<should_use_cam_anim_text> = 0)
        SpawnScriptLater goal_description_and_speech params = <...> 
    else
        if GotParam cam_anim_text
            if ((GotParam trigger_obj_id)|| (GotParam speaker_obj_id))
                if GotParam just_won_goal
                    GoalManager_PlayGoalWinStream {
                        name = <goal_id>
                        speaker_obj_id = <speaker_obj_id>
                        speaker_name = <speaker_name>
                        cam_anim_index = (<cam_anim_index> + 1)
                    }
                else
                    GoalManager_PlayGoalStartStream {
                        name = <goal_id>
                        speaker_obj_id = <speaker_obj_id>
                        speaker_name = <speaker_name>
                        cam_anim_index = (<cam_anim_index> + 1)
                    }
                endif
            endif
        endif
        if GotParam cam_anim_text
            <display_cam_anim_text> = ''
            if GotParam cam_anim_speaker_name
                FormatText textname = display_cam_anim_text '\ca%s :\c0\n' s = <cam_anim_speaker_name>
            else
                if GotParam full_name
                    FormatText textname = display_cam_anim_text '\ca%s :\c0\n' s = <full_name>
                else
                    if GotParam pro
                        FormatText checksumname = pro_checksum '%s' s = <pro>
                        goal_get_last_name pro = <pro>
                        if GetSkaterLastNameString <pro_checksum>
                            FormatText textname = pro_name_text '\ca%s %l :\c0\n' s = <pro> l = <last_name>
                        endif
                    endif
                endif
            endif
            if IsArray <cam_anim_text>
                GetArraySize cam_anim_text
                <index> = 0
                begin 
                FormatText textname = display_cam_anim_text '%s%n' s = <display_cam_anim_text> n = (<cam_anim_text> [ <index> ])
                <index> = (<index> + 1)
                repeat <array_size>
            else
                FormatText textname = display_cam_anim_text '%s%n' s = <display_cam_anim_text> n = <cam_anim_text>
            endif
            if NOT (<skippable> = 0)
                SetSkaterCamAnimSkippable skaterid = <skaterid> name = <anim> skippable = 0
                FormatText textname = display_cam_anim_text '%s\n%p \m0 %c' s = <display_cam_anim_text> p = str_g_u_63 c = str_g_u_66
                <pad_choose_script> = goal_description_and_speech_continue
                <pad_choose_params> = {no_pad_start anim = <anim> skippable = <skippable>}
            endif
            if ScreenElementExists id = speech_box_anchor
                DestroyScreenElement id = speech_box_anchor
            endif
            kill_start_key_binding
            create_speech_box {
                anchor_id = goal_description_anchor
                text = <display_cam_anim_text>
                Pos = <text_anchor_pos>
                style = speech_box_style
                bg_x_scale = 1.300
                pad_choose_script = <pad_choose_script>
                pad_choose_params = <pad_choose_params>
            }
        else
            <pad_choose_script> = goal_description_and_speech_continue
            <pad_choose_params> = {no_pad_start anim = <anim> skippable = <skippable>}
            FormatText textname = continue_text '%p \m0 %c' p = str_g_u_63 c = str_g_u_66
            create_speech_box {
                anchor_id = goal_description_anchor
                text = <continue_text>
                Pos = <text_anchor_pos>
                style = speech_box_style
                bg_x_scale = 1.300
                pad_choose_script = <pad_choose_script>
                pad_choose_params = <pad_choose_params>
            }
        endif
    endif
    begin 
    if SkaterCamAnimFinished skaterid = <skaterid> name = <anim>
        if ScreenElementExists id = goal_description_anchor
            DestroyScreenElement id = goal_description_anchor
        endif
        GoalManager_StopLastStream name = <goal_id>
        GoalManager_UnloadLastFam name = <goal_id>
        Debounce x time = 0.3000
        break 
    endif
    wait 1 gameframe
    repeat 
    if GotParam post_anim_script
        <post_anim_script> goal_id = <goal_id> <post_anim_script_params>
    endif
    DisplayLoadingScreen freeze
    wait 1 gameframe
    hideloadingscreen
endscript

script goal_initialize_skater 
    MakeSkaterGoto SkaterInit
    skater ::runstarted
    if NOT GotParam control_type
        NonVehicleControlType = 1
    else
        if ((<control_type> = skate)|| (<control_type> = walk)|| (<control_type> = bike))
            NonVehicleControlType = 1
        endif
    endif
    if GotParam NonVehicleControlType
        switch <control_type>
            case walk
            if NOT GotParam no_reset
                if GotParam restart_node
                    if IsInNodeArray <restart_node>
                        ResetSkaters node_name = <restart_node> RestartWalking
                    endif
                endif
            endif
            case skate
            if NOT GotParam no_reset
                if GotParam restart_node
                    if IsInNodeArray <restart_node>
                        ResetSkaters node_name = <restart_node>
                    endif
                endif
            endif
            if NOT GotParam start_skater_rolling
                MakeSkaterGoto HandBrake
            endif
            default 
            if NOT GotParam no_reset
                if GotParam restart_node
                    if IsInNodeArray <restart_node>
                        ResetSkaters node_name = <restart_node>
                    endif
                endif
            endif
            if NOT GotParam start_skater_rolling
                MakeSkaterGoto HandBrake
            endif
        endswitch
    else
        GetVehicleSetup control_type = <control_type>
        if NOT GotParam exitable
            if GotParam edited_goal
                MakeSkaterGoto Switch_OnGroundAI params = {NewScript = TransAm VehicleSetup = <VehicleSetup> edited_goal}
            else
                MakeSkaterGoto Switch_OnGroundAI params = {NewScript = TransAm VehicleSetup = <VehicleSetup>}
            endif
        else
            if GotParam edited_goal
                MakeSkaterGoto Switch_OnGroundAI params = {NewScript = TransAm VehicleSetup = <VehicleSetup> exitable edited_goal}
            else
                MakeSkaterGoto Switch_OnGroundAI params = {NewScript = TransAm VehicleSetup = <VehicleSetup> exitable}
            endif
        endif
        if GotParam restart_node
            PlayerVehicle ::Vehicle_MoveToRestart <restart_node>
        endif
        PlayerVehicleCamera ::VehicleCamera_Reset
        SetActiveCamera id = PlayerVehicleCamera
        if GotParam edited_goal
            PlayerVehicle ::Vehicle_Wake
        endif
        if GotParam goal_id
            GoalManager_SetEndRunType name = <goal_id> None
        endif
    endif
endscript

script goal_wait_and_show_key_combo_text 
    Block untilevent = panel_message_goal_done2
    SetScreenElementLock id = current_goal on
    SetScreenElementLock id = current_goal Off
    SetScreenElementLock id = root_window Off
    GetScreenElementPosition id = current_goal
    <screenelementpos> = (<screenelementpos> + (120.0, 0.0))
    GetScreenElementDims id = current_goal
    if ScreenElementExists id = current_goal_key_combo_text
        DestroyScreenElement id = current_goal_key_combo_text
    endif
    CreateScreenElement {
        type = TextBlockElement
        parent = root_window
        id = current_goal_key_combo_text
        dims = (300.0, 0.0)
        allow_expansion
        z_priority = -5
        font = small
        Scale = 1
        rgba = [ 128 128 128 110 ]
        text = <text>
        Pos = (<screenelementpos> + ((0.0, 1.0) * <height> / 0.7800))
        just = [ center top ]
        internal_just = [ center top ]
        Scale = 0.7500
    }
endscript

script hide_key_combo_text 
    if ScreenElementExists \{ id = current_goal_key_combo_text }
        DoScreenElementMorph \{ id = current_goal_key_combo_text time = 0 Scale = 0 }
    endif
endscript

script unhide_key_combo_text 
    if ScreenElementExists \{ id = current_goal_key_combo_text }
        DoScreenElementMorph \{ id = current_goal_key_combo_text time = 0 Scale = 0.7500 }
    endif
endscript

script goal_description_and_speech 
    GoalManager_GetGoalParams name = <goal_id>
    if ScreenElementExists id = current_goal
        DestroyScreenElement id = current_goal
    endif
    if ScreenElementExists id = current_goal_key_combo_text
        DestroyScreenElement id = current_goal_key_combo_text
    endif
    if NOT GotParam null_goal
        SpawnScriptLater goal_wait_for_cam_anim params = <...> 
    endif
    <pro_name_text> = ''
    if GotParam cam_anim_speaker_name
        FormatText textname = pro_name_text '\ca%s :\c0\n' s = <cam_anim_speaker_name>
    else
        if GotParam full_name
            FormatText textname = pro_name_text '\ca%s :\c0\n' s = <full_name>
        else
            if GotParam pro
                FormatText checksumname = pro_checksum '%s' s = <pro>
                if GetSkaterLastNameString <pro_checksum>
                    FormatText textname = pro_name_text '\ca%s %l :\c0\n' s = <pro> l = <last_name>
                endif
            endif
        endif
    endif
    if GotParam goal_description
        if IsArray <goal_description>
            GetArraySize <goal_description>
            <index> = 0
            begin 
            FormatText textname = pro_name_text '%s%n' s = <pro_name_text> n = (<goal_description> [ <index> ])
            <index> = (<index> + 1)
            repeat <array_size>
        else
            FormatText textname = pro_name_text '%s%n' s = <pro_name_text> n = <goal_description>
        endif
        FormatText textname = pro_name_text '%s\n%p \m0 %c' s = <pro_name_text> p = str_g_u_63 c = str_g_u_66
    endif
    if NOT GotParam just_won_goal
        if GotParam goal_description
            GetSkaterId
            if NOT SkaterCamAnimFinished skaterid = <ObjID> name = <anim>
                if ScreenElementExists id = speech_box_anchor
                    DestroyScreenElement id = speech_box_anchor
                endif
                create_speech_box {
                    anchor_id = goal_description_anchor
                    text = <pro_name_text>
                    Pos = <text_anchor_pos>
                    style = speech_box_style
                    bg_x_scale = 1.300
                    pad_choose_script = goal_description_and_speech_continue
                    pad_choose_params = {no_pad_start anim = <anim> skippable = 0}
                }
                goal_description_anchor ::settags anim = <anim>
                AssignAlias id = goal_description_anchor alias = current_goal_description
                wait 60 frame
                if NOT SkaterCamAnimFinished skaterid = <ObjID> name = <anim>
                    GoalManager_PlayGoalStartStream {
                        name = <goal_id>
                        speaker_obj_id = <speaker_obj_id>
                        speaker_name = <speaker_name>
                        last_anim
                    }
                endif
            endif
        endif
    endif
endscript

script goal_description_and_speech_continue 
    Debounce \{ x time = 0.3000 }
    <should_kill_anim> = 1
    if ((GotParam anim)& (<should_kill_anim> = 1))
        GetSkaterId
        KillSkaterCamAnim skaterid = <ObjID> name = <anim>
    endif
    if GotParam \{ no_pad_start }
        speech_box_exit \{ anchor_id = goal_description_anchor no_pad_start }
    else
        speech_box_exit \{ anchor_id = goal_description_anchor }
    endif
    FireEvent \{ broadcast type = goal_description_and_speech_continue }
endscript

script goal_wait_for_cam_anim 
    GetSkaterId
    begin 
    if SkaterCamAnimFinished skaterid = <ObjID> name = <anim>
        SpawnScriptLater goal_show_tips params = { goal_id = <goal_id> }
        if NOT GotParam \{ dont_show_goal_text }
            create_panel_block id = current_goal text = <goal_text> style = panel_message_goal parent = root_window font_face = dialog params = <...> 
            if GotParam \{ key_combo_text }
                SpawnScriptLater goal_wait_and_show_key_combo_text params = { text = <key_combo_text> }
            endif
        endif
        break 
    endif
    wait \{ 10 one_per_frame }
    repeat 
endscript

script goal_description_and_speech2 blink_time = 0.05000
    setprops just = [ center top ] internal_just = [ center center ] rgba = [ 128 128 128 128 ]
    DoMorph Pos = (320.0, 114.0) Scale = 0
    DoMorph Pos = (320.0, 114.0) Scale = 1.200 time = 0.1000
    DoMorph Pos = (320.0, 114.0) Scale = 0.8000 time = 0.1000
    DoMorph Pos = (320.0, 114.0) Scale = 1 time = 0.1000
    DoMorph Pos = (320.0, 114.0) Scale = 0.9000 time = 0.05000
    DoMorph Pos = (321.0, 116.0) time = 0.1000
    DoMorph Pos = (319.0, 113.0) time = 0.1000
    DoMorph Pos = (321.0, 115.0) time = 0.1000
    DoMorph Pos = (318.0, 113.0) time = 0.1000
    DoMorph Pos = (321.0, 115.0) time = 0.1000
    DoMorph Pos = (319.0, 113.0) time = 0.1000
    DoMorph Pos = (321.0, 117.0) time = 0.1000
    DoMorph Pos = (319.0, 113.0) time = 0.1000
    DoMorph Pos = (320.0, 120.0) Scale = 1.250 time = 0.1000
    setprops internal_just = [ center top ] rgba = [ 128 128 128 110 ] just = [ RIGHT top ]
    DoMorph Pos = (625.0, 15.0) Scale = 0.7800 time = 0.05000
    RunScriptOnScreenElement id = current_goal blink_current_goal params = { blink_time = <blink_time> }
endscript

script blink_current_goal 
    begin 
    DoMorph \{ alpha = 0 }
    wait <blink_time> seconds
    DoMorph \{ alpha = 1 }
    wait <blink_time> seconds
    repeat 6
endscript

script GoalManager_InitGoalTrigger 
    GoalManager_GetGoalParams name = <name>
    <goal_id> = <name>
    if NOT IsInNodeArray <trigger_obj_id>
        return not_in_nodearray = 1
    endif
    if NOT IsCreated <trigger_obj_id>
        Create name = <trigger_obj_id>
    endif
    <trigger_obj_id> ::settags goal_id = <goal_id>
    if NOT GotParam quick_start
        goal_add_ped_arrow goal_id = <goal_id>
    endif
    goal_pro_stop_anim_scripts <...> 
    <trigger_obj_id> ::obj_spawnscriptlater goal_set_trigger_exceptions params = { goal_id = <goal_id> }
    if GotParam trigger_wait_script
        <trigger_obj_id> ::obj_spawnscriptlater <trigger_wait_script> params = {goal_id = <goal_id> pro = <pro>}
    else
        <trigger_obj_id> ::obj_spawnscriptlater GenericProWaiting params = {goal_id = <goal_id> type = 'wait' pro = <pro>}
    endif
endscript

script goal_add_ped_arrow 
    return 
endscript

script goal_ped_kill_arrow 
    GoalManager_GetGoalParams name = <goal_id>
    FormatText checksumname = arrow_id '%s_ped_arrow' s = <goal_name>
    if ScreenElementExists id = <arrow_id>
        DestroyScreenElement id = <arrow_id>
    endif
endscript

script goal_trigger_wait_and_set_exceptions 
    wait \{ 20 gameframe }
    goal_set_trigger_exceptions <...> 
endscript

script goal_set_trigger_exceptions trigger_radius = 16
    if ScreenElementExists id = goal_start_dialog
        speech_box_exit anchor_id = goal_start_dialog
    endif
    Obj_ClearException objectoutofradius
    obj_setinnerradius <trigger_radius>
    if NOT GotParam dont_bounce_skater
        obj_getid
        SetEventHandlerOnObject {
            object = <ObjID>
            exception
            Ex = objectinradius
            scr = goal_got_trigger
            params = { goal_id = <goal_id> }
        }
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if NOT InNetGame
        if NOT GotParam dont_bounce_skater
            if NOT InNetGame
                obj_spawnscriptlater goal_trigger_reset_avoid_radius_exception params = { goal_id = <goal_id> }
            endif
        endif
    endif
endscript

script goal_pro_bounce_skater Speed = 88
    if IsTrue igc_playing
        printf '** would have bumped skater, but didn\'t due to IGC **'
        return 
    endif
    if NOT SkaterCamAnimFinished
        return 
    endif
    if InNetGame
        return 
    endif
    if NOT GotParam ped_id
        obj_getid
        <ped_id> = <ObjID>
    endif
    GetSkaterId
    <skaterid> = <ObjID>
    if NOT <skaterid> ::IsLocalSkater
        return 
    endif
    if <skaterid> ::driving
        return 
    endif
    if (cutscene_is_playing = 1)
        return 
    endif
    if NOT SkaterCamAnimFinished
        return 
    endif
    if SkaterCurrentScorePotGreaterThan 0
        return 
    endif
    <skaterid> ::GetSkaterState
    if NOT (<state> = Skater_OnGround)
        return 
    endif
    if <ped_id> ::ishidden
        return 
    endif
    root_window ::gettags
    if GotParam giving_rewards
        if (<giving_rewards> = 1)
            return 
        endif
    endif
    if <skaterid> ::speedgreaterthan 200
        if GotParam goal_id
            GoalManager_PlayGoalStream name = <goal_id> type = 'avoid' play_random
        endif
        if GotParam reset_script
            <ped_id> ::Obj_ClearException objectinavoidradius
            <ped_id> ::obj_spawnscriptlater {
                <reset_script>
                params = <...> 
            }
        endif
        return did_bounce_skater = 0
    endif
    <skaterid> ::gettags
    if GotParam reset_script
        <ped_id> ::Obj_ClearException objectinavoidradius
        <ped_id> ::obj_spawnscriptlater {
            <reset_script>
            params = <...> 
        }
    endif
    <ped_id> ::Ped_Utils_GetVectorToPlayer { playerid = <skaterid> }
    <skaterid> ::SkaterAvoidGoalPed {SetVelDir = <VecToPlayer> SetVelSpeed = 250}
    return did_bounce_skater = 1
endscript

script goal_pro_wait_and_reset_avoid_exception 
    if InNetGame
        return 
    endif
    wait \{ 20 gameframe }
    goal_trigger_reset_avoid_radius_exception <...> 
endscript

script goal_trigger_reset_avoid_radius_exception 
endscript

script goal_check_can_skater_exit_bike 
    <can_exit> = 1
    if NOT ChecksumEquals a = (goal_utility_last_goal_activated)b = null
        if GoalManager_GoalExists name = (goal_utility_last_goal_activated)
            if GoalManager_GoalIsActive name = (goal_utility_last_goal_activated)
                GoalManager_GetGoalParams name = (goal_utility_last_goal_activated)
                if ((GotParam dont_allow_skater_exit_bike)|| (GotParam bike_goal)|| (GotParam bike_training_goal))
                    <can_exit> = 0
                endif
            endif
        endif
    endif
    return can_exit = <can_exit>
endscript

script goal_got_trigger 
    if ((dont_create_speech_boxes = 1)|| (game_progress_block_triggers = 1)|| (sysnotify_wait_in_progress = 1))
        return 
    endif
    GetSkaterId
    <skaterid> = <ObjID>
    if GoalManager_HasWonGoal name = <goal_id>
        GoalManager_GetGoalParams name = <goal_id>
        if NOT GotParam dont_kill_trigger_on_success
            return 
        endif
    endif
    if GoalManager_GoalIsActive name = <goal_id>
        return 
    endif
    if GoalManager_GoalIsLocked name = <goal_id>
        return 
    endif
    if skater ::IsSkaterOnVehicle
        return 
    endif
    if IsTrue igc_playing
        return 
    endif
    if CustomParkMode editing
        return 
    endif
    if ScreenElementExists id = goal_start_dialog
        <should_destroy> = 0
        if <skaterid> ::IsInBail
            <should_destroy> = 1
        endif
        if SkaterCurrentScorePotGreaterThan 0
            <should_destroy> = 1
        endif
        if <skaterid> ::driving
            <should_destroy> = 1
        endif
        if NOT GoalManager_CanStartGoal
            <should_destroy> = 1
        endif
        if (<should_destroy> = 1)
            DestroyScreenElement id = goal_start_dialog
        endif
    else
        if ScreenElementExists id = root_window
            root_window ::gettags
            if GotParam menu_state
                if (<menu_state> = on)
                    return 
                endif
            endif
        endif
        if GoalManager_CanStartGoal name = <goal_id>
            <skater_ready_for_goal> = 0
            if NOT <skaterid> ::driving
                if <skaterid> ::skating
                    if <skaterid> ::OnGround
                        <skater_ready_for_goal> = 1
                    endif
                else
                    if <skaterid> ::walk_ground
                        <skater_ready_for_goal> = 1
                    endif
                endif
            endif
            if (<skater_ready_for_goal> = 1)
                if NOT <skaterid> ::IsInBail
                    if NOT SkaterCurrentScorePotGreaterThan 0
                        GoalManager_GetGoalParams name = <goal_id>
                        <trigger_obj_id> ::obj_setouterradius 20
                        <trigger_obj_id> ::Obj_SetException Ex = objectoutofradius scr = goal_trigger_refuse params = { goal_id = <goal_id> }
                        if (InNetGame)
                            FormatText textname = quick_start_text '\n\m7 %q' q = str_g_u_67
                            <quick_start_text> = <quick_start_text>
                            <pad_option2_script> = goal_accept_trigger
                            <pad_option2_params> = {goal_id = <goal_id> quick_start}
                        else
                            <quick_start_text> = ''
                        endif
                        if NOT GotParam trigger_action_text
                            trigger_action_text = str_g_u_68
                        endif
                        if GotParam full_name
                            FormatText textname = accept_text '%f: \m5 %t %a.%q' f = <full_name> t = str_g_u_69 q = <quick_start_text> a = <trigger_action_text>
                        else
                            if GotParam pro
                                FormatText checksumname = name_checksum '%s' s = <pro>
                                GetSkaterLastNameString <name_checksum>
                                if GotParam last_name
                                    FormatText textname = accept_text '%s %l: \m5 %t %a.%q' s = <pro> l = <last_name> t = str_g_u_69 q = <quick_start_text> a = <trigger_action_text>
                                else
                                    FormatText textname = accept_text '%s: \m5 %t %a.%q' s = <pro> t = str_g_u_69 q = <quick_start_text> a = <trigger_action_text>
                                endif
                            else
                                FormatText textname = accept_text '%p \m5 %t %a.%q' p = str_g_u_63 t = str_g_u_69 q = <quick_start_text> a = <trigger_action_text>
                            endif
                        endif
                        create_speech_box {
                            anchor_id = goal_start_dialog
                            text = <accept_text>
                            no_pad_choose
                            no_pad_start
                            pad_option_script = goal_accept_trigger
                            pad_option_params = { goal_id = <goal_id> }
                            pad_option2_script = <pad_option2_script>
                            pad_option2_params = <pad_option2_params>
                            bg_rgba = [ 100 100 100 128 ]
                            text_rgba = [ 128 128 128 128 ]
                            z_priority = 5
                        }
                    endif
                endif
            endif
        endif
    endif
endscript

script goal_trigger_refuse \{ anchor_id = goal_start_dialog }
    Obj_ClearException \{ objectoutofradius }
    speech_box_exit anchor_id = <anchor_id>
    GoalManager_ResetGoalTrigger name = <goal_id>
endscript

script goal_accept_trigger 
    Debounce x time = 0.5000
    speech_box_exit anchor_id = goal_start_dialog
    GoalManager_GetGoalParams name = <goal_id>
    if NOT SkaterCurrentScorePotGreaterThan 0
        GetSkaterId
        if <ObjID> ::OnGround
            goal_check_goal_already_active
        endif
    endif
    if GotParam check_bike_training_progress
        goal_check_bike_training_progress goal_id = <goal_id>
    endif
    if ((GotParam bike_training_goal)|| (GotParam bike_goal))
        if NOT skater ::IsSkaterOnBike
            goto goal_bike_only_box_create params = { goal_id = <goal_id> }
        endif
    else
        if skater ::IsSkaterOnBike
            goto goal_skate_only_box_create params = { goal_id = <goal_id> }
        endif
    endif
    if GotParam check_stats_progress
        goal_check_stats_progress goal_id = <goal_id>
    endif
    if GotParam check_appearance_before_start
        goal_check_required_appearance {
            goal_id = <goal_id>
            specific_appearance = <specific_appearance>
            wrong_appearance_title_text = <wrong_appearance_title_text>
            wrong_appearance_body_text = <wrong_appearance_body_text>
            wrong_apperance_button_text = <wrong_apperance_button_text>
        }
    endif
    if GotParam check_graffiti_styles_before_start
        goal_check_required_graffiti_styles goal_id = <goal_id>
    endif
    goal_check_for_required_tricks goal_id = <goal_id>
    if GotParam graffiti_goal
        if NOT SkaterCurrentScorePotGreaterThan 0
            GetSkaterId
            if <ObjID> ::OnGround
                if ((goal_graffiti_pre_running)= 1)
                    return 
                endif
                GoalManager_ResetGoalTrigger name = <goal_id> no_new_exceptions
                GoalManager_DeactivateAllGoals force_all
                goal_graffiti_pre_launch goal_id = <goal_id>
                GoalManager_GetGoalParams name = <goal_id>
                if GotParam continue_to
                    if (<continue_to> = 1)
                        if GotParam ped_floater_element
                            RunScriptOnScreenElement id = <ped_floater_element> goal_hide_ped_floater
                        endif
                        Integrated_CAGR_Launch in_menu = 0 goal_id = <goal_id>
                        return 
                    else
                        if (<continue_to> = 2)
                            GoalManager_InitGoalTrigger name = <goal_id>
                            return 
                        endif
                    endif
                endif
            endif
        endif
    endif
    <trigger_exists> = 0
    if GotParam trigger_obj_id
        if IsInNodeArray <trigger_obj_id>
            <trigger_exists> = 1
        endif
    endif
    if GotParam force_start
        if NOT GoalManager_GoalInitialized name = <goal_id>
            GoalManager_InitializeGoal name = <goal_id>
        endif
        if (<trigger_exists> = 1)
            GoalManager_ResetGoalTrigger name = <goal_id> no_new_exceptions
            if IsCreated <trigger_obj_id>
                <trigger_obj_id> ::Obj_ClearException objectinradius
            endif
        endif
        GoalManager_DeactivateAllGoals force_all
        GoalManager_ActivateGoal name = <goal_id> <...> 
        return 
    endif
    if NOT SkaterCurrentScorePotGreaterThan 0
        if GoalManager_CanStartGoal name = <goal_id>
            GetSkaterId
            if <ObjID> ::OnGround
                if SkaterCurrentScorePotLessThan 1
                    if <ObjID> ::OnGround
                        GoalManager_GetGoalParams name = <goal_id>
                        if (<trigger_exists> = 1)
                            GoalManager_ResetGoalTrigger name = <goal_id> no_new_exceptions
                            if IsCreated <trigger_obj_id>
                                <trigger_obj_id> ::Obj_ClearException objectinradius
                            endif
                        endif
                        GoalManager_DeactivateAllGoals force_all
                        if GotParam quick_start
                            GoalManager_QuickStartGoal name = <goal_id>
                        else
                            GoalManager_ActivateGoal name = <goal_id> <...> 
                        endif
                    else
                        if NOT <ObjID> ::rightpressed
                            if NOT <ObjID> ::leftpressed
                                if NOT <ObjID> ::uppressed
                                    if NOT <ObjID> ::downpressed
                                        GoalManager_GetGoalParams name = <goal_id>
                                        if (<trigger_exists> = 1)
                                            GoalManager_ResetGoalTrigger name = <goal_id> no_new_exceptions
                                            if IsCreated <trigger_obj_id>
                                                <trigger_obj_id> ::Obj_ClearException objectinradius
                                            endif
                                        endif
                                        GoalManager_DeactivateAllGoals force_all
                                        if GotParam quick_start
                                            GoalManager_QuickStartGoal name = <goal_id>
                                        else
                                            GoalManager_ActivateGoal name = <goal_id> <...> 
                                        endif
                                    endif
                                endif
                            endif
                        endif
                    endif
                endif
            else
            endif
        endif
    endif
endscript

script GoalManager_ResetGoalTrigger 
    if GotParam \{ goal_id }
        GoalManager_GetGoalParams name = <goal_id>
    else
        GoalManager_GetGoalParams name = <name>
    endif
    if NOT GotParam \{ trigger_obj_id }
        return 
    endif
    if NOT IsInNodeArray <trigger_obj_id>
        return 
    endif
    if IsCreated <trigger_obj_id>
        <trigger_obj_id> ::Obj_ClearException objectinradius
        if NOT GotParam \{ no_new_exceptions }
            if NOT GotParam \{ just_won_goal }
                <trigger_obj_id> ::obj_spawnscriptlater goal_trigger_wait_and_set_exceptions params = { goal_id = <goal_id> }
            endif
        endif
    endif
endscript

script goal_check_for_required_tricks 
    <found_unmapped_trick> = 0
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam required_tricks
        FormatText textname = warning_string '%w' w = str_g_u_70
        GetArraySize required_tricks
        <index> = 0
        begin 
        if NOT GetKeyComboBoundToTrick Trick = (<required_tricks> [ <index> ])
            if NOT GetKeyComboBoundToTrick Trick = (<required_tricks> [ <index> ])special
                <trick_name> = (<required_tricks> [ <index> ])
                <trick_params> = (<trick_name>.params)
                <trick_string> = (<trick_params>.name)
                if (<found_unmapped_trick> = 0)
                    FormatText textname = warning_string '%s\n%t' s = <warning_string> t = <trick_string>
                else
                    FormatText textname = warning_string '%s, %t' s = <warning_string> t = <trick_string>
                endif
                <found_unmapped_trick> = 1
            endif
        endif
        <index> = (<index> + 1)
        repeat <array_size>
    endif
    if (<found_unmapped_trick> = 1)
        goto goal_unmapped_tricks_box_create params = {warning_string = <warning_string> goal_id = <goal_id>}
    endif
    return found_unmapped_trick = <found_unmapped_trick>
endscript

script goal_unmapped_tricks_box_create 
    pausegame
    GoalManager_HidePedFloaters
    create_error_box {Title = str_g_u_71
        text = <warning_string>
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = str_g_u_72 pad_choose_script = goal_unmapped_tricks_box_accept}
            {text = str_g_u_73 pad_choose_script = goal_unmapped_tricks_box_exit pad_choose_params = { goal_id = <goal_id> }}
        ]
    }
endscript

script goal_unmapped_tricks_box_accept 
    Debounce \{ Circle time = 0.3000 }
    dialog_box_exit
    create_edit_tricks_menu
endscript

script goal_unmapped_tricks_box_exit 
    Debounce \{ Circle time = 0.3000 }
    GoalManager_ResetGoalTrigger name = <goal_id>
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
endscript

script goal_check_required_appearance 
    if GotParam \{ specific_appearance }
        GetPlayerAppearance
        if NOT AppearanceChangedSpecific profile = <profile> specific_change = <specific_appearance>
            goto goal_check_required_appearance_box_create params = {
                goal_id = <goal_id>
                wrong_appearance_title_text = <wrong_appearance_title_text>
                wrong_appearance_body_text = <wrong_appearance_body_text>
                wrong_apperance_button_text = <wrong_apperance_button_text>
            }
        endif
    endif
endscript

script goal_check_required_appearance_box_create \{ wrong_appearance_title_text = str_g_u_74 wrong_appearance_body_text = str_g_u_75 wrong_apperance_button_text = str_g_u_76 }
    pausegame
    GoalManager_HidePedFloaters
    GoalManager_PauseAllGoals
    create_error_box {Title = <wrong_appearance_title_text>
        text = <wrong_appearance_body_text>
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = <wrong_apperance_button_text> pad_choose_script = goal_check_required_appearance_box_exit pad_choose_params = { goal_id = <goal_id> }}
        ]
    }
endscript

script goal_check_required_appearance_box_exit 
    Debounce \{ Circle time = 0.3000 }
    GoalManager_ResetGoalTrigger name = <goal_id>
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_check_bike_training_progress 
    CareerFunc \{ func = GetCurrentBikeTrainingGoal }
    if NOT (<current_bike_training_goal> > 2)
        goto goal_check_bike_training_progress_box_create params = { goal_id = <goal_id> }
    endif
endscript

script goal_check_bike_training_progress_box_create 
    pausegame
    GoalManager_HidePedFloaters
    GoalManager_PauseAllGoals
    create_error_box {Title = str_g_u_77
        text = str_g_u_78
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = str_g_u_76 pad_choose_script = goal_check_bike_training_progress_box_exit pad_choose_params = { goal_id = <goal_id> }}
        ]
    }
endscript

script goal_check_bike_training_progress_box_exit 
    Debounce \{ Circle time = 0.3000 }
    GoalManager_ResetGoalTrigger name = <goal_id>
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_check_stats_progress 
    skater ::StatsManager_GetTotalGoalsComplete
    if NOT (<total_goals_complete> > 5)
        goto goal_check_stats_progress_box_create params = { goal_id = <goal_id> }
    endif
endscript

script goal_check_stats_progress_box_create 
    pausegame
    GoalManager_HidePedFloaters
    GoalManager_PauseAllGoals
    create_error_box {Title = str_g_u_79
        text = str_g_u_80
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = str_g_u_76 pad_choose_script = goal_check_stats_progress_box_exit pad_choose_params = { goal_id = <goal_id> }}
        ]
    }
endscript

script goal_check_stats_progress_box_exit 
    Debounce \{ Circle time = 0.3000 }
    GoalManager_ResetGoalTrigger name = <goal_id>
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_unlocked_graffiti_box_create 
    wait \{ 2 seconds }
    pausegame
    GoalManager_PauseAllGoals
    create_error_box {
        Title = str_g_u_81
        text = <text>
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = str_g_u_107 pad_choose_script = goal_unlocked_graffiti_box_exit}
        ]
    }
endscript

script goal_unlocked_graffiti_box_exit 
    Debounce \{ Circle time = 0.3000 }
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_get_num_tag_done_for_zone 
    <counter> = 0
    <index> = 1
    begin 
    FormatText checksumname = node_flag 'NODEFLAG_%z_GRAFFITI_0%n' z = <zone> n = <index>
    if GetNodeFlag <node_flag>
        <counter> = (<counter> + 1)
    endif
    <index> = (<index> + 1)
    repeat 2
    return num_tags = <counter>
endscript

script goal_check_required_graffiti_styles 
    <all_styles_unlocked> = 1
    <using_all_styles> = 0
    <z_ho_unlocked> = 0
    <z_bh_unlocked> = 0
    <z_dt_unlocked> = 0
    <z_sm_unlocked> = 0
    if CareerFunc func = IsZoneGraffitiStyleUnlocked params = { zone = z_ho }
        <z_ho_unlocked> = 1
    else
        <all_styles_unlocked> = 0
        goal_get_num_tag_done_for_zone zone = 'z_ho'
        <ho_tags> = <num_tags>
    endif
    if CareerFunc func = IsZoneGraffitiStyleUnlocked params = { zone = z_bh }
        <z_bh_unlocked> = 1
    else
        <all_styles_unlocked> = 0
        goal_get_num_tag_done_for_zone zone = 'z_bh'
        <bh_tags> = <num_tags>
    endif
    if CareerFunc func = IsZoneGraffitiStyleUnlocked params = { zone = z_dt }
        <z_dt_unlocked> = 1
    else
        <all_styles_unlocked> = 0
        goal_get_num_tag_done_for_zone zone = 'z_dt'
        <dt_tags> = <num_tags>
    endif
    if CareerFunc func = IsZoneGraffitiStyleUnlocked params = { zone = z_sm }
        <z_sm_unlocked> = 1
    else
        <all_styles_unlocked> = 0
        goal_get_num_tag_done_for_zone zone = 'z_sm'
        <sm_tags> = <num_tags>
    endif
    if (<all_styles_unlocked> = 0)
        <title_text> = str_g_u_82
        <body_text> = str_g_u_83
        <button_text> = str_g_u_84
        <progress_msg> = ''
        if GotParam ho_tags
            FormatText textname = ho_msg '\nHollywood: %n %o 3 %t %d' n = <ho_tags> o = str_g_c_2 t = str_z_dt_59 d = str_z_mainmenu_23
        else
            FormatText textname = ho_msg '\n%m' m = str_g_u_95
        endif
        <progress_msg> = (<progress_msg> + <ho_msg>)
        if GotParam bh_tags
            FormatText textname = bh_msg '\nBeverly Hills: %n %o 3 %t %d' n = <bh_tags> o = str_g_c_2 t = str_z_dt_59 d = str_z_mainmenu_23
        else
            FormatText textname = bh_msg '\n%m' m = str_g_u_96
        endif
        <progress_msg> = (<progress_msg> + <bh_msg>)
        if GotParam dt_tags
            FormatText textname = dt_msg '\n%c: %n %o 3 %t %d' c = str_z_el_8 n = <dt_tags> o = str_g_c_2 t = str_z_dt_59 d = str_z_mainmenu_23
        else
            FormatText textname = dt_msg '\n%m' m = str_g_u_97
        endif
        <progress_msg> = (<progress_msg> + <dt_msg>)
        if GotParam sm_tags
            FormatText textname = sm_msg '\nSanta Monica: %n %o 3 %t %d' n = <sm_tags> o = str_g_c_2 t = str_z_dt_59 d = str_z_mainmenu_23
        else
            FormatText textname = sm_msg '\n%m' m = str_g_u_98
        endif
        <progress_msg> = (<progress_msg> + <sm_msg>)
        FormatText textname = new_body_text '%b\n\n%p\n%m' b = <body_text> p = str_z_mainmenu_36 m = <progress_msg>
        <body_text> = <new_body_text>
    else
        <using_ho> = 0
        <using_bh> = 0
        <using_dt> = 0
        <using_sm> = 0
        <cagr_info_index> = 0
        begin 
        <layer_texture_name> = ((edit_graphic_layer_infos)[ <cagr_info_index> ].texture_name)
        if NOT (<layer_texture_name> = '')
            StringToCharArray string = <layer_texture_name>
            if ((<char_array> [ 0 ])= 'g')
                <using_ho> = 1
            else
                if ((<char_array> [ 0 ])= 'i')
                    <using_bh> = 1
                else
                    if ((<char_array> [ 0 ])= 'b')
                        <using_dt> = 1
                    else
                        if ((<char_array> [ 0 ])= 'o')
                            <using_sm> = 1
                        endif
                    endif
                endif
            endif
        endif
        <cagr_info_index> = (<cagr_info_index> + 1)
        repeat 10
        if (<using_ho> = 1)
            if (<using_bh> = 1)
                if (<using_dt> = 1)
                    if (<using_sm> = 1)
                        <using_all_styles> = 1
                    endif
                endif
            endif
        endif
        if (<using_all_styles> = 0)
            <title_text> = str_g_u_85
            <body_text> = str_g_u_86
            <button_text> = str_g_u_87
        endif
    endif
    if ((<all_styles_unlocked> = 0)|| (<using_all_styles> = 0))
        goto goal_check_required_graffiti_styles_box_create params = {
            goal_id = <goal_id>
            title_text = <title_text>
            body_text = <body_text>
            button_text = <button_text>
        }
    endif
endscript

script goal_check_required_graffiti_styles_box_create 
    pausegame
    GoalManager_HidePedFloaters
    GoalManager_PauseAllGoals
    create_snazzy_dialog_box {
        Title = <title_text>
        text = <body_text>
        text_dims = (500.0, 0.0)
        no_bg
        buttons = [
            {
                text = <button_text>
                pad_choose_script = goal_check_required_graffiti_styles_box_exit
                pad_choose_params = { goal_id = <goal_id> }
            }
        ]
    }
endscript

script goal_check_required_graffiti_styles_box_exit 
    Debounce \{ Circle time = 0.3000 }
    GoalManager_ResetGoalTrigger name = <goal_id>
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_skate_only_box_create 
    pausegame
    GoalManager_HidePedFloaters
    GoalManager_PauseAllGoals
    create_error_box {Title = str_g_u_71
        text = str_g_u_88
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = str_g_u_89 pad_choose_script = goal_skate_only_box_exit pad_choose_params = { goal_id = <goal_id> }}
        ]
    }
endscript

script goal_skate_only_box_exit 
    Debounce \{ Circle time = 0.3000 }
    if GotParam \{ goal_id }
        GoalManager_ResetGoalTrigger name = <goal_id>
    endif
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_bike_only_box_create 
    pausegame
    GoalManager_HidePedFloaters
    GoalManager_PauseAllGoals
    create_error_box {Title = str_g_u_71
        text = str_g_u_90
        text_dims = (400.0, 0.0)
        bg_scale = 1.200
        buttons = [
            {text = str_g_u_89 pad_choose_script = goal_bike_only_box_exit pad_choose_params = { goal_id = <goal_id> }}
        ]
    }
endscript

script goal_bike_only_box_exit 
    Debounce \{ Circle time = 0.3000 }
    GoalManager_ResetGoalTrigger name = <goal_id>
    GoalManager_UnHidePedFloaters
    dialog_box_exit
    UnPauseGame
    GoalManager_UnPauseAllGoals
endscript

script goal_got_trickslot 
    create_panel_message \{ id = goal_current_reward text = str_g_u_91 style = goal_message_got_trickslot }
endscript

script goal_got_cash \{ amount = 0 }
    CareerFunc \{ func = GetCash }
    FormatText textname = message '%y $%i!  %t: $%c' y = str_g_u_92 i = <amount> t = str_g_u_93 c = <cash>
    create_panel_message {
        id = goal_current_reward
        text = <message>
        style = goal_message_got_trickslot
    }
endscript

script goal_combo_record 
    create_panel_message \{ id = goal_current_reward text = str_g_u_94 style = goal_message_got_trickslot }
endscript

script goal_got_graffiti text = str_g_u_81
    if GotParam announce_unlocked
        if (<zone> = 'z_ho')
            <text> = str_g_u_95
        else
            if (<zone> = 'z_bh')
                <text> = str_g_u_96
            else
                if (<zone> = 'z_dt')
                    <text> = str_g_u_97
                else
                    if (<zone> = 'z_sm')
                        <text> = str_g_u_98
                    endif
                endif
            endif
        endif
        spawnscriptnow goal_unlocked_graffiti_box_create params = { text = <text> }
    else
        create_panel_message {
            id = goal_current_reward
            text = str_g_u_81
            style = goal_message_got_trickslot
        }
    endif
    goal_got_cash amount = <cash_reward>
endscript

script goal_got_all_goals 
    StopStream
    PlayStream FoundAllGaps vol = 150
    unlock_all_cheat_codes
    unlock_all_gameplay_cheat_codes
    StopStream
    PlayStream FoundAllGaps vol = 150
    FormatText textname = text '%w \n\n%y \c3%n\c0 %t' w = str_g_u_99 y = str_g_u_100 n = str_g_u_101 t = str_g_u_102
    create_dialog_box {Title = str_g_u_103
        text = <text>
        Pos = (310.0, 225.0)
        just = [ center center ]
        text_rgba = [ 88 105 112 128 ]
        text_dims = (400.0, 0.0)
        buttons = [{font = small text = str_g_u_104 pad_choose_script = goal_got_all_goals_accept}]
        delay_input
    }
endscript

script goal_got_all_goals_accept 
    dialog_box_exit
    FireEvent \{ broadcast type = goal_got_all_goals_done }
endscript

script goal_play_stream 
    if GotParam streamId
        begin 
        if PreLoadStreamDone <streamId>
            break 
        endif
        wait 1 frame
        repeat 
    endif
    if GotParam play_anim
        addanimcontroller {
            type = partialanim
            id = jawrotation
            AnimName = <stream_checksum>
            from = start
            to = end
            Speed = 1.0
        }
    endif
    if GotParam streamId
        StartPreLoadedStream {
            streamId = <streamId>
            volume = 190
        }
    else
        obj_playstream {
            <stream_checksum>
            vol = 120
            dropoff = 300
            use_pos_info = <use_pos_info>
        }
    endif
endscript

script goal_init_after_end_of_run 
    if NOT GoalManager_GoalExists name = <goal_id>
        return 
    endif
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam competition
        return 
    endif
    GetSkaterId
    begin 
    if GoalManager_GoalExists name = <goal_id>
        if GoalManager_FinishedEndOfRun name = <goal_id>
            GoalManager_ClearEndRun name = <goal_id>
            if NOT GameModeEquals is_classic
                if <ObjID> ::IsSkaterOnVehicle
                    GetCurrentSkaterProfileIndex
                    GetSkaterProfileInfo player = <currentSkaterProfileIndex>
                    if GotParam vehicle_params
                        Vehicle_Start params = <vehicle_params>
                    endif
                else
                    if <ObjID> ::skating
                        MakeSkaterGoto ongroundai
                    endif
                endif
            endif
            if InNetGame
                <ObjID> ::netenableplayerinput
            else
                if NOT GameModeEquals is_classic
                    <ObjID> ::enableplayerinput
                endif
            endif
            break 
        endif
    else
        break 
    endif
    wait 1 frame
    repeat 
endscript

script goal_save_accept 
    dialog_box_exit
    kill_start_key_binding
    launch_beat_goal_save_game_sequence \{ pad_back_script = goal_save_reject no_cam_anim }
endscript

script goal_save_reject 
    UnPauseGame
    GoalManager_SetCanStartGoal \{ 1 }
    restore_start_key_binding
    dialog_box_exit
    if ScreenElementExists \{ id = current_menu_anchor }
        DestroyScreenElement \{ id = current_menu_anchor }
    endif
    SetScreenElementProps \{id = root_window tags = { menu_state = Off }}
    root_window ::settags \{ menu_state = Off }
    unpause_rain
    unhide_console_window
    unpause_trick_text
    FireEvent \{ broadcast type = goal_wait_for_save }
endscript

script goal_create_counter 
    SetScreenElementLock id = root_window Off
    goal_destroy_counter
    CreateScreenElement {
        type = ContainerElement
        parent = root_window
        id = goal_counter_anchor
        dims = (640.0, 480.0)
        Pos = (305.0, 320.0)
    }
    <root_pos> = (550.0, 90.0)
    Theme_GetUnhighlightedTextColor return_value = rgba_off
    Theme_GetHighlightedTextColor return_value = rgba_on
    CreateScreenElement {
        type = TextElement
        parent = goal_counter_anchor
        id = goal_counter_number_collected
        font = small
        text = '0'
        Pos = <root_pos>
        just = [ center top ]
        Scale = 0.9000
        rgba = <rgba_on>
    }
    if GoalManager_GetNumberOfFlags name = <goal_id>
        <total_number> = <number_of_flags>
    else
        GoalManager_GetGoalParams name = <goal_id>
        if GotParam number
            <total_number> = <number>
        else
            if GotParam num_gaps_to_find
                <total_number> = <num_gaps_to_find>
            else
                script_assert 'Couldn\'t find number param.  Are the params for the hud counter setup?'
            endif
        endif
    endif
    FormatText textname = total_number '%i' i = <total_number>
    CreateScreenElement {
        type = TextElement
        parent = goal_counter_anchor
        id = goal_counter_number_total
        rgba = <rgba_off>
        font = small
        text = <total_number>
        Pos = (<root_pos> + (47.0, 0.0))
        just = [ center top ]
        Scale = 0.9000
    }
    Theme_GetSpeechBoxColor return_value = bg_rgba
    CreateScreenElement {
        type = SpriteElement
        parent = goal_counter_anchor
        id = mini_score_hud_box
        texture = mini_score_hud
        Pos = (<root_pos> - (25.0, 10.0))
        just = [ left top ]
        Scale = (1.4700000286102295, 1.399999976158142)
        rgba = <bg_rgba>
    }
    if GotParam hud_counter_caption
        GetStackedScreenElementPos y id = <id> Offset = (48.0, -16.0)
        CreateScreenElement {
            type = TextBlockElement
            parent = goal_counter_anchor
            id = goal_counter_caption
            font = small
            text = <hud_counter_caption>
            rgba = [ 128 128 128 108 ]
            Pos = <Pos>
            just = [ center top ]
            Scale = 0.8000
            line_spacing = 0.6000
            dims = (117.5, 0.0)
            rot_angle = -2
            allow_expansion
        }
    endif
    goal_update_counter <...> 
endscript

script goal_update_counter 
    GoalManager_GetNumberCollected name = <goal_id>
    if NOT ScreenElementExists id = goal_counter_number_collected
        return 
    endif
    FormatText textname = new_number_collected '%i' i = <number_collected>
    SetScreenElementProps {
        id = goal_counter_number_collected
        text = <new_number_collected>
    }
    GoalManager_GetGoalParams name = <goal_id>
    if GotParam hud_counter_caption
        if ScreenElementExists id = goal_counter_caption
            SetScreenElementProps {
                id = goal_counter_caption
                text = <hud_counter_caption>
            }
        endif
    endif
    KillSpawnedScript name = mini_hud_anim
    RunScriptOnScreenElement id = goal_counter_number_collected mini_hud_anim
endscript

script goal_destroy_counter 
    if ScreenElementExists \{ id = goal_counter_anchor }
        DestroyScreenElement \{ id = goal_counter_anchor }
    endif
endscript

script mini_hud_anim 
    DoMorph \{ time = 0.08000 Scale = 0 alpha = 0 }
    DoMorph \{ time = 0.1200 Scale = 1.300 alpha = 1 }
    DoMorph \{ time = 0.1400 Scale = 0.7000 }
    DoMorph \{ time = 0.1600 Scale = 0.9000 }
endscript

script goal_got_flag_sound 
    playsound \{ GoalMidGood vol = 200 }
endscript

script goal_hide_timer 
    if ScreenElementExists \{ id = the_time }
        SetScreenElementProps \{ id = the_time hide }
    endif
endscript

script goal_unhide_timer 
    if ScreenElementExists \{ id = the_time }
        SetScreenElementProps \{ id = the_time unhide }
    endif
endscript

script adjust_goal_hud_for_telescope_cam 
    <continue> = 0
    if GoalManager_GoalExists name = (goal_utility_last_goal_activated)
        if GoalManager_GoalIsActive name = (goal_utility_last_goal_activated)
            GoalManager_GetGoalParams name = (goal_utility_last_goal_activated)
            <continue> = 1
        endif
    endif
    if (<continue> = 1)
        if GotParam show_goal_timer
            if ScreenElementExists id = the_time
                SetScreenElementProps {
                    id = the_time
                    unhide
                    z_priority = 200
                }
                DoScreenElementMorph id = the_time Pos = (50.0, 400.0)
            endif
        endif
        if ScreenElementExists id = telescope_counter
            DoScreenElementMorph id = telescope_counter alpha = 1
        endif
        if NOT GotParam dont_show_goal_text
            if GotParam goal_text
                begin 
                if ScreenElementExists id = current_goal
                    break 
                endif
                wait 1 gameframe
                repeat 
                KillSpawnedScript name = panel_message_goal
                if IsPAL
                    <text_pos> = (520.0, 390.0)
                else
                    <text_pos> = (520.0, 386.0)
                endif
                if IsXenon
                    <text_scale> = 0.7000
                else
                    <text_scale> = 0.8300
                endif
                DoScreenElementMorph id = current_goal Pos = <text_pos> Scale = <text_scale> alpha = 1
                SetScreenElementProps {
                    id = current_goal
                    z_priority = 200
                }
            endif
        endif
    endif
endscript

script restore_goal_hud_after_telescope_cam 
    if ScreenElementExists id = the_time
        SetScreenElementProps {
            id = the_time
            hide
            z_priority = -1
        }
        DoScreenElementMorph id = the_time Pos = (300.0, 50.0)
    endif
    if ScreenElementExists id = telescope_counter
        DoScreenElementMorph id = telescope_counter alpha = 0
    endif
    if ScreenElementExists id = current_goal
        DoScreenElementMorph id = current_goal Pos = (620.0, 27.0)
        SetScreenElementProps {
            id = current_goal
            z_priority = -5
        }
    endif
endscript
goal_panel_message_ids = [
    goal_complete
    goal_complete_line2
    goal_complete_sprite
    trick_beat_menu_anchor
    goal_description_anchor
    points_message
    current_goal
    goal_message
    GoalFail
    goalfail_sprite
    goalfailedline2
    goal_tip
    new_goal_message
    new_goal_sprite
    tetris_menu_anchor
    current_horse_spot
    goal_counter_anchor
    goal_instruction1
    skater_hint
    death_message
    perfect
    perfect2
    goal_current_reward
    Eric_Text
    race_lap_message
    race_checkpoint_message
    race_time_message
    goal_contest_scoreboard
    goal_transfer_special_anchor
    goal_transfer_special_warning
]

script hide_goal_panel_messages 
    GetArraySize \{ goal_panel_message_ids }
    <index> = 0
    begin 
    if NOT ((goal_panel_message_ids [ <index> ])= current_goal)
        hide_panel_message id = (goal_panel_message_ids [ <index> ])
    endif
    <index> = (<index> + 1)
    repeat <array_size>
endscript

script show_goal_panel_messages 
    GetArraySize \{ goal_panel_message_ids }
    <index> = 0
    begin 
    show_panel_message id = (goal_panel_message_ids [ <index> ])
    <index> = (<index> + 1)
    repeat <array_size>
endscript

script destroy_goal_panel_messages 
    GetArraySize \{ goal_panel_message_ids }
    if GotParam \{ all }
        <index> = 0
    else
        <index> = 4
        <array_size> = (<array_size> - 4)
    endif
    if (<index> < <array_size>)
        begin 
        destroy_panel_message id = (goal_panel_message_ids [ <index> ])
        <index> = (<index> + 1)
        repeat <array_size>
    endif
endscript

script GoalManager_HidePoints 
    DoScreenElementMorph \{ id = the_score_sprite alpha = 0 }
    DoScreenElementMorph \{ id = the_score alpha = 0 }
    if ScreenElementExists \{ id = player2_panel_container }
        DoScreenElementMorph \{ id = player2_panel_container time = 0 Scale = 0 }
    endif
    update_goal_points_display \{ hide }
    update_pager_icon \{ hide }
endscript

script GoalManager_ShowPoints 
    if NOT GetGlobalFlag \{ flag = NO_DISPLAY_HUD }
        if CustomParkMode \{ editing }
        else
            DoScreenElementMorph \{ id = the_score_sprite alpha = 1 }
            DoScreenElementMorph \{ id = the_score alpha = 1 }
            if ScreenElementExists \{ id = player2_panel_container }
                DoScreenElementMorph \{ id = player2_panel_container time = 0 Scale = 1 }
            endif
            update_goal_points_display \{ show }
            update_pager_icon \{ show }
        endif
    endif
endscript

script GoalManager_HideGoalPoints 
    DoScreenElementMorph \{ id = goal_points_text alpha = 0 }
endscript

script GoalManager_ShowGoalPoints 
    if CustomParkMode \{ editing }
        return 
    endif
    if InMultiPlayerGame
        return 
    endif
    if GameModeEquals \{ is_singlesession }
        return 
    endif
    if GameModeEquals \{ is_freeskate }
        return 
    endif
    GoalManager_GetNumberOfGoalPoints \{ total }
    FormatText textname = goal_points '%i' i = <goal_points>
    SetScreenElementProps {
        id = goal_points_text
        text = <goal_points>
    }
    DoScreenElementMorph \{ id = goal_points_text alpha = 1 }
endscript

script goal_show_tips 
    Block untilevent = panel_message_goal_done
    GoalManager_GetGoalParams name = <goal_id>
    <tip_pos> = (320.0, 140.0)
    if NOT GotParam goal_tips
        return 
    endif
    if NOT GotParam goal_tip_interval
        goal_tip_interval = 5
    endif
    GoalManager_GetNumberOfTimesGoalStarted name = <goal_id>
    GetArraySize <goal_tips>
    if (<array_size> = 0)
        return 
    endif
    tips_index = (<array_size> - 1)
    current_multiple = (<goal_tip_interval> * <array_size>)
    if (<times_started> = 0)
        return 
    endif
    if NOT (((<times_started> / <goal_tip_interval>)* <goal_tip_interval>)= <times_started>)
        return 
    endif
    times_started = (<times_started> - (<times_started> / <current_multiple>)* <current_multiple>)
    begin 
    if (((<times_started> / <current_multiple>)* <current_multiple>)= <times_started>)
        create_panel_block id = goal_tip text = (<goal_tips> [ <tips_index> ])Pos = <tip_pos> style = panel_message_tips just = [ center top ]
        break 
    else
        tips_index = (<tips_index> - 1)
        current_multiple = (<current_multiple> - <goal_tip_interval>)
    endif
    repeat <array_size>
endscript

script goal_show_HUD 
    show_panel_messages
    show_goal_panel_messages
    Unpause_Balance_Meter
    GoalManager_ShowPoints
    GoalManager_ShowGoalPoints
    goal_unhide_timer
endscript

script goal_no_valid_key_combos 
    create_panel_message \{ text = str_g_u_105 }
    GoalManager_DeactivateGoal name = <goal_id>
endscript

script GoalManager_enable_flatland_mode 
    if skater ::autokickisoff
        <previous_auto_kick> = 0
    else
        <previous_auto_kick> = 1
    endif
    GoalManager_EditGoal name = <goal_id> params = { previous_auto_kick = <previous_auto_kick> }
    AutokickOff \{ 0 }
    skater ::setrollingfriction \{ 1000.0 }
endscript

script GoalManager_disable_flatland_mode 
    GoalManager_GetGoalParams name = <goal_id>
    if (<previous_auto_kick> = 1)
        AutokickOn \{ 0 }
    endif
    skater ::setrollingfriction \{ default }
endscript

script AddGoal_TrickBeat 
    if GotParam version
        FormatText textname = goal_type 'TrickBeat%v' v = <version>
        if NOT GotParam trigger_obj_id
            FormatText checksumname = trigger_obj_id 'TRG_G_TRICKBEAT%v_Pro' v = <version>
        endif
        if NOT GotParam restart_node
            FormatText checksumname = restart_node 'TRG_G_TRICKBEAT%v_RestartNode' v = <version>
        endif
    else
        <goal_type> = 'TrickBeat'
    endif
    GoalManager_CreateGoalName <...> 
    GoalManager_AddGoal name = <goal_id> {
        params = { Goal_TrickBeat_GenericParams
        <...> 
         }
    }
endscript
goal_show_start_gap_started = 0

script announce_gap_start \{ text = str_g_u_106 }
    if ((goal_show_start_gap_started)= 0)
        change \{ goal_show_start_gap_started = 1 }
        PulseBloom
        create_panel_block {
            id = goal_gap_started_msg
            text = <text>
            time = 500
            rgba = [ 80 80 120 128 ]
            Scale = 1.500
            font_face = dialog
            Pos = (320.0, 100.0)
            style = goal_message_gap_start
        }
        wait \{ 0.2000 seconds }
        EndBloom
        change \{ goal_show_start_gap_started = 0 }
    endif
endscript

script panel_message_goalfail Pos = (320.0, 149.0)
    Theme_GetPauseBarColor return_value = goal_fail_color
    setprops just = [ center bottom ] rgba = <goal_fail_color>
    RunScriptOnScreenElement id = <id> panel_message_wait_and_die params = { time = 4000 }
    DoMorph Pos = <Pos> time = 0 Scale = 0 alpha = 0
    DoMorph Scale = 1.300 time = 0.3000 alpha = 1
    wait 1.300 second
    DoMorph alpha = 1.0 time = 0.2000 Scale = 1.800
    DoMorph alpha = 0 time = 0.1500 Scale = 0
endscript

script panel_message_goalfail_0 
    panel_message_goalfail id = <id> Pos = (170.0, 149.0)
endscript

script panel_message_goalfail_1 
    panel_message_goalfail id = <id> Pos = (470.0, 149.0)
endscript

script panel_sprite_goalfail time = 4000 Pos = (320.0, 195.0)
    setprops just = [ center center ] rgba = [ 100 10 107 108 ]
    RunScriptOnScreenElement id = <id> panel_message_wait_and_die params = { time = <time> }
    DoMorph time = 0 Scale = 0 Pos = <Pos> alpha = 0 rot_angle = -5
    DoMorph time = 0.3000 Scale = (5.300000190734863, 3.5) alpha = 0.5000 rot_angle = 0
    wait 0.4000 second
    DoMorph time = 1 Scale = (5.300000190734863, 7.5) Pos = (<Pos> + (0.0, 105.0))alpha = 0
endscript

script panel_sprite_goalfail_0 
    panel_sprite_goalfail id = <id> Pos = (170.0, 195.0)
endscript

script panel_sprite_goalfail_1 
    panel_sprite_goalfail id = <id> Pos = (470.0, 195.0)
endscript

script panel_message_goalfailline2 time = 4000 Pos = (320.0, 163.0)
    setprops font = testtitle just = [ center center ] rgba = [ 128 30 7 128 ]
    RunScriptOnScreenElement id = <id> panel_message_wait_and_die params = { time = <time> }
    DoMorph Pos = <Pos> time = 0 alpha = 0 Scale = 20
    DoMorph Pos = <Pos> Scale = 2.0 time = 0.3000 alpha = 1 rot_angle = 0
    wait 0.9000 second
    DoMorph time = 0.4000 Pos = (320.0, 663.0) rot_angle = -90 alpha = 0
endscript

script panel_message_goalfailline2_0 
    panel_message_goalfailline2 id = <id> Pos = (170.0, 163.0)
endscript

script panel_message_goalfailline2_1 
    panel_message_goalfailline2 id = <id> Pos = (470.0, 163.0)
endscript

script panel_message_goalcomplete time = 1500
    gettags
    Theme_GetPauseBarColor return_value = goal_color
    RunScriptOnScreenElement id = <id> panel_message_wait_and_die params = { time = <time> }
    setprops just = [ center center ] rgba = <goal_color>
    DoMorph Pos = (320.0, 129.0) time = 0 Scale = 0 alpha = 0
    DoMorph Pos = (320.0, 129.0) Scale = 1.800 time = 0.3000 alpha = 1
    wait 1.200 second
    DoMorph time = 0.1000 Scale = 2.300 alpha = 1
    DoMorph time = 0.1000 DoMorph alpha = 0 time = 0.2000 Scale = 0 rgba = [ 0 0 0 128 ]
endscript

script panel_sprite_goalcomplete time = 1500
    setprops just = [ center center ] rgba = [ 128 128 128 128 ]
    DoMorph Scale = 0 Pos = (320.0, 125.0) alpha = 0 time = 0
    DoMorph Scale = 4 alpha = 0.6000 time = 0.6500 rot_angle = 0
    DoMorph Scale = 3 alpha = 0.5000 time = 0.2500 rot_angle = 0
    DoMorph Scale = 11 Pos = (320.0, 125.0) alpha = 0 time = 0.4500 rot_angle = 180
    FireEvent broadcast type = panel_sprite_goalcomplete_done
endscript

script panel_message_goalcompleteline2 time = 1600
    setprops font = dialog just = [ center center ] rgba = [ 27 123 7 128 ]
    DoMorph Pos = (320.0, 173.0) time = 0 alpha = 0
    DoMorph Pos = (320.0, 583.0) time = 0.3000 alpha = 0 Scale = 0 rot_angle = 0
    DoMorph Pos = (320.0, 183.0) time = 0.05000 alpha = 1 Scale = 2.300
    DoMorph Pos = (315.0, 185.0) time = 0.05000
    DoMorph Pos = (322.0, 181.0) time = 0.05000
    DoMorph Pos = (320.0, 185.0) time = 0.05000
    DoMorph Pos = (318.0, 181.0) time = 0.05000
    DoMorph Pos = (320.0, 183.0) time = 0.05000
    DoMorph Pos = (318.0, 185.0) time = 0.05000
    DoMorph Pos = (322.0, 181.0) time = 0.05000
    DoMorph Pos = (327.0, 185.0) time = 0.05000 Scale = 2.400
    DoMorph Pos = (318.0, 181.0) time = 0.05000
    DoMorph Pos = (320.0, 183.0) time = 0.05000 Scale = 2.300
    DoMorph Pos = (318.0, 185.0) time = 0.05000
    DoMorph Pos = (322.0, 181.0) time = 0.05000 Scale = 2.500
    DoMorph Pos = (320.0, 185.0) time = 0.05000
    DoMorph Pos = (318.0, 175.0) time = 0.05000 Scale = 2.300
    DoMorph Pos = (320.0, 193.0) time = 0.05000
    DoMorph Pos = (314.0, 175.0) time = 0.05000
    DoMorph Pos = (322.0, 181.0) time = 0.05000 Scale = 2.200
    DoMorph Pos = (320.0, 185.0) time = 0.05000
    DoMorph Pos = (318.0, 171.0) time = 0.05000
    DoMorph Pos = (318.0, 189.0) time = 0.05000 Scale = 2.300
    DoMorph Pos = (322.0, 191.0) time = 0.05000
    DoMorph Pos = (320.0, 185.0) time = 0.05000
    DoMorph Pos = (312.0, 181.0) time = 0.05000
    DoMorph Pos = (318.0, 181.0) time = 0.05000
    DoMorph DoMorph Pos = (318.0, 171.0) time = 0.05000 alpha = 1 Scale = 1.600 rot_angle = 3
    DoMorph DoMorph Pos = (318.0, 171.0) alpha = 1 time = 0.08000 Scale = 1.500 rot_angle = 4
    DoMorph Pos = (318.0, 171.0) alpha = 0 time = 0.7500 Scale = 11.50 rot_angle = -40
    Die
    FireEvent broadcast type = panel_message_goalcompleteline2_done
endscript

script panel_message_goal blink_time = 0.1000 final_pos = (620.0, 27.0)
    if NOT GotParam dont_animate
        setprops just = [ center top ] internal_just = [ center center ] rgba = [ 128 128 128 128 ]
        DoMorph Pos = (320.0, 120.0) Scale = 0 alpha = 0
        DoMorph Pos = (320.0, 120.0) Scale = 1.100 time = 0.3000 alpha = 0.3500
        wait 0.2000 second
    endif
    setprops internal_just = [ center top ] rgba = [ 128 128 128 110 ] just = [ RIGHT top ]
    DoMorph Pos = <final_pos> Scale = 0.8300 time = 0.09000 alpha = 1
    FireEvent broadcast type = panel_message_goal_done
    FireEvent broadcast type = panel_message_goal_done2
endscript

script panel_message_generic_loss start_pos = (320.0, 185.0)
    setprops just = [ center center ] rgba = [ 128 128 128 100 ]
    RunScriptOnScreenElement id = <id> panel_message_wait_and_die params = { time = 1500 }
    DoMorph Pos = <start_pos> time = 0 Scale = 0
    DoMorph time = 0.3000 Scale = 1.300
    DoMorph time = 0.2000 Scale = 1.0
    DoMorph Pos = (<start_pos> + (-1.0, -1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (1.0, 1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (-1.0, -1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (2.0, 1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (-1.0, -1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (1.0, 1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (-1.0, -3.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (1.0, 1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (-1.0, -1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (1.0, 1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (-2.0, -1.0))time = 0.1000
    DoMorph Pos = (<start_pos> + (1.0, 2.0))time = 0.1000
endscript

script panel_message_generic_loss0 
    panel_message_generic_loss id = <id> start_pos = (170.0, 185.0)
endscript

script panel_message_generic_loss1 
    panel_message_generic_loss id = <id> start_pos = (470.0, 185.0)
endscript

script panel_message_tips blink_time = 0.05000
    setprops just = [ center top ] internal_just = [ center center ] rgba = [ 127 102 0 100 ]
    DoMorph Scale = 0
    DoMorph Scale = 1.200 time = 0.1000
    DoMorph Scale = 0.8000 time = 0.1000
    DoMorph Scale = 1 time = 0.1000
    DoMorph Scale = 0.9000 time = 0.1000
    DoMorph Pos = { (1.0, 2.0) relative }time = 0.1000
    DoMorph Pos = { (-2.0, -3.0) relative }time = 0.1000
    DoMorph Pos = { (2.0, 2.0) relative }time = 0.1000
    DoMorph Pos = { (-3.0, -2.0) relative }time = 0.1000
    DoMorph Pos = { (3.0, 2.0) relative }time = 0.1000
    DoMorph Pos = { (-2.0, -2.0) relative }time = 0.1000
    DoMorph Pos = { (2.0, 4.0) relative }time = 0.1000
    DoMorph Pos = { (-2.0, -4.0) relative }time = 0.1000
    DoMorph Pos = { (1.0, 7.0) relative }Scale = 1.250 time = 0.1000
    setprops internal_just = [ center top ] rgba = [ 127 102 0 90 ] just = [ RIGHT top ]
    DoMorph Pos = { (155.0, -40.0) relative }Scale = 0.7800 time = 0.05000
    begin 
    DoMorph alpha = 0
    wait <blink_time> seconds
    DoMorph alpha = 1
    wait <blink_time> seconds
    repeat 6
endscript

script clock_morph 
    DoMorph \{ Scale = 0 alpha = 0 time = 0.1000 }
    DoMorph \{ Scale = 1.0 alpha = 1 time = 0.3000 }
endscript

script goal_message_got_trickslot 
    setprops rgba = [ 43 95 53 128 ]
    DoMorph time = 0 Pos = (320.0, 214.0) Scale = 0 alpha = 0
    DoMorph time = 0.5000 alpha = 1
    if GotParam sound
        playsound <sound> vol = 150
    endif
    DoMorph time = 0.1000 Scale = 2.500
    DoMorph time = 0.1000 Scale = 1.500
    DoMorph time = 0.1000 Scale = 2.0
    DoMorph time = 0.1000 Scale = 1.400
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph Pos = (321.0, 215.0) time = 0.1000
    DoMorph Pos = (319.0, 213.0) time = 0.1000
    DoMorph time = 0.1000 Scale = 1.400
    DoMorph time = 0.1500 Scale = 0 alpha = 0
    Die
    FireEvent broadcast type = goal_got_reward_done
endscript

script goal_message_stat_up 
    setprops rgba = [ 33 112 15 128 ]
    DoMorph time = 0 Pos = (320.0, 195.0) Scale = 10 alpha = 0
    if GotParam sound
        playsound <sound> vol = 150
    endif
    DoMorph time = 0.2000 Scale = 1.600 alpha = 1
    DoMorph time = 0.1000 Scale = 1.600
    DoMorph time = 0.3000 Scale = 2.100 alpha = 1
    DoMorph time = 0.2500 Scale = 0 alpha = 0
    Die
endscript

script new_ammo_message_up 
    DoMorph time = 0 Scale = 0 alpha = 0
    DoMorph time = 0.2000 alpha = 1
    if GotParam sound
        playsound <sound> vol = 150
    endif
    DoMorph time = 0.1000 Scale = 2.500
    DoMorph time = 0.1000 Scale = 1.500
    DoMorph time = 0.1000 Scale = 2.0
    DoMorph time = 0.1000 Scale = 1.200
    DoMorph time = 1.200 Scale = 1.200
    DoMorph time = 0.1000 Scale = 1.800
    DoMorph time = 0.1500 Scale = 0 alpha = 0
    Die
endscript

script goal_message_got_gap 
    setprops rgba = [ 20 98 114 108 ]
    DoMorph time = 0.1000 alpha = 1
    DoMorph time = 0.1000 Scale = 1.900
    DoMorph time = 0.1000 Scale = 0.9000
    DoMorph time = 0.1000 Scale = 1.200
    DoMorph time = 0.1000 Scale = 0.9500
    DoMorph time = 0.1000 Scale = 1.0
    DoMorph alpha = 0.4000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000 Scale = 1.0
    DoMorph time = 0.1000 Scale = 1.700
    DoMorph time = 0.1000 Scale = 0 alpha = 0
    Die
endscript

script goal_message_bouncy_blue_midscreen 
    setprops rgba = [ 20 114 98 108 ]
    DoMorph time = 0 Pos = (320.0, 180.0) Scale = 0 alpha = 0
    DoMorph time = 0.1000 alpha = 1
    DoMorph time = 0.1000 Scale = 1.900
    DoMorph time = 0.1000 Scale = 0.9000
    DoMorph time = 0.1000 Scale = 1.200
    DoMorph time = 0.1000 Scale = 0.9500
    DoMorph time = 0.1000 Scale = 1.0
    DoMorph alpha = 0.4000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.3000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000
    DoMorph alpha = 0.6000 time = 0.07000
    DoMorph alpha = 1 time = 0.07000 Scale = 1.0
    DoMorph time = 0.1000 Scale = 1.700
    DoMorph time = 0.1000 Scale = 0 alpha = 0
    Die
endscript

script panel_message_red_big_midscreen time = 4000
    setprops font = testtitle just = [ center center ] rgba = [ 128 30 7 128 ]
    RunScriptOnScreenElement id = <id> panel_message_wait_and_die params = { time = <time> }
    DoMorph Pos = (320.0, 163.0) time = 0 alpha = 0 Scale = 20
    if German
        <Scale> = 1.300
    else
        <Scale> = 1.600
    endif
    DoMorph Pos = (320.0, 163.0) Scale = <Scale> time = 0.3000 alpha = 1 rot_angle = 0
    wait 0.9000 second
    DoMorph time = 0.4000 Pos = (320.0, 663.0) rot_angle = -90 alpha = 0
endscript

script goal_message_gap_start 
    DoMorph time = 0.1000 Scale = (1.600000023841858, 1.600000023841858) alpha = 0.5000
    DoMorph time = 0.1000 Scale = (2.4000000953674316, 2.4000000953674316) alpha = 0.9000
    DoMorph time = 0.1000 Scale = (1.600000023841858, 1.600000023841858) alpha = 0.7000
    DoMorph time = 0.1000 Scale = (2.0, 1.2999999523162842) alpha = 0.6000
    DoMorph time = 0.1000 Scale = (2.4000000953674316, 1.0) alpha = 0.5000
    DoMorph time = 0.1000 Scale = (2.799999952316284, 0.699999988079071) alpha = 0.3000
    DoMorph time = 0.1000 Scale = (3.200000047683716, 0.4000000059604645) alpha = 0.1000
    DoMorph time = 0.1000 Scale = (3.5999999046325684, 0.10000000149011612) alpha = 0.05000
    Die
endscript

script panel_message_landed 
    setprops rgba = [ 33 112 15 128 ]
    DoMorph time = 0 Pos = (320.0, 90.0) Scale = 10 alpha = 0
    if GotParam sound
        playsound <sound> vol = 150
    endif
    DoMorph time = 0.2000 Scale = 1.300 alpha = 1
    wait 1 second
    DoMorph time = 0.3000 Scale = 2.100 alpha = 1
    DoMorph time = 0.2500 Scale = 0 alpha = 0
endscript

script panel_message_countdown blink_time = 0.1000 final_pos = (320.0, 110.0)
    if NOT GotParam dont_animate
        setprops just = [ center top ] internal_just = [ center center ] rgba = [ 128 128 128 128 ]
        DoMorph Pos = (320.0, 110.0) Scale = 0 alpha = 0
        DoMorph Pos = (320.0, 110.0) Scale = 1.100 time = 0.3000 alpha = 1 rot_angle = 0
        wait 0.2000 second
    endif
    setprops internal_just = [ center center ] rgba = [ 128 128 128 110 ]
    DoMorph Scale = 2.300 time = 1.200 alpha = 0 rot_angle = -2
    FireEvent broadcast type = panel_message_goal_done
    FireEvent broadcast type = panel_message_goal_done2
endscript

script spawned_safe_goal_win 
    GoalManager_WinGoal name = <goal_id>
endscript

script unlock_all_special_slots 
    GetCurrentSkaterProfileIndex
    GetSkaterProfileInfo player = <currentSkaterProfileIndex>
    if (<max_specials> < max_number_of_special_trickslots)
        num = (max_number_of_special_trickslots - <max_specials>)
        begin 
        AwardSpecialTrickslot
        repeat <num>
    endif
endscript
